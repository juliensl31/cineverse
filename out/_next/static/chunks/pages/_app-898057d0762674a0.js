(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{6840:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(8703)}])},3301:(e,t,r)=>{"use strict";let n,i;r.d(t,{H:()=>dO,a:()=>dD});var s,a,o,l,u,h,c,d,f,p,m,g,y,v,w,b=r(5893),I=r(7294),_=r(4406);let E=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},T=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},S={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(E(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):T(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new x;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class x extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let C=function(e){let t=E(e);return S.encodeByteArray(t,!0)},A=function(e){return C(e).replace(/\./g,"")},k=function(e){try{return S.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},N=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,D=()=>{if(void 0===_||void 0===_.env)return;let e=_.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},O=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&k(e[1]);return t&&JSON.parse(t)},R=()=>{try{return N()||D()||O()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},P=e=>{var t,r;return null===(r=null===(t=R())||void 0===t?void 0:t.emulatorHosts)||void 0===r?void 0:r[e]},L=e=>{let t=P(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},M=()=>{var e;return null===(e=R())||void 0===e?void 0:e.config},V=e=>{var t;return null===(t=R())||void 0===t?void 0:t[`_${e}`]};class U{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function F(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function j(){return!function(){var e;let t=null===(e=R())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(r.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function B(){try{return"object"==typeof indexedDB}catch(e){return!1}}class q extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,q.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z.prototype.create)}}class z{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?i.replace(K,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`}):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new q(n,a,r)}}let K=/\{\$([^}]+)}/g;function $(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(G(r)&&G(s)){if(!$(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function G(e){return null!==e&&"object"==typeof e}function H(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function W(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function Q(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class J{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=Y),void 0===n.error&&(n.error=Y),void 0===n.complete&&(n.complete=Y);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Y(){}function X(e){return e&&e._delegate?e._delegate:e}class Z{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ee="[DEFAULT]";class et{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new U;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ee})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ee){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ee){return this.instances.has(e)}getOptions(e=ee){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;let n=this.normalizeInstanceIdentifier(t),i=null!==(r=this.onInitCallbacks.get(n))&&void 0!==r?r:new Set;i.add(e),this.onInitCallbacks.set(n,i);let s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:e===ee?void 0:e,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=ee){return this.component?this.component.multipleInstances?e:ee:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class er{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new et(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let en=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));let ei={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},es=s.INFO,ea={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},eo=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=ea[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class el{constructor(e){this.name=e,this._logLevel=es,this._logHandler=eo,this._userLogHandler=null,en.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ei[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}let eu=(e,t)=>t.some(t=>e instanceof t),eh=new WeakMap,ec=new WeakMap,ed=new WeakMap,ef=new WeakMap,ep=new WeakMap,em={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return ec.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ed.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eg(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eg(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eg(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eh.set(t,e)}).catch(()=>{}),ep.set(t,e),t}(e);if(ef.has(e))return ef.get(e);let r="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ey(this),e),eg(eh.get(this))}:function(...e){return eg(t.apply(ey(this),e))}:function(e,...r){let n=t.call(ey(this),e,...r);return ed.set(n,e.sort?e.sort():[e]),eg(n)}:(t instanceof IDBTransaction&&function(e){if(ec.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ec.set(e,t)}(t),eu(t,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,em):t;return r!==e&&(ef.set(e,r),ep.set(r,e)),r}let ey=e=>ep.get(e),ev=["get","getKey","getAll","getAllKeys","count"],ew=["put","add","delete","clear"],eb=new Map;function eI(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eb.get(t))return eb.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=ew.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ev.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eb.set(t,s),s}em=(e=>({...e,get:(t,r,n)=>eI(t,r)||e.get(t,r,n),has:(t,r)=>!!eI(t,r)||e.has(t,r)}))(em);class e_{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eE="@firebase/app",eT="0.10.15",eS=new el("@firebase/app"),ex="[DEFAULT]",eC={[eE]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eA=new Map,ek=new Map,eN=new Map;function eD(e,t){try{e.container.addComponent(t)}catch(r){eS.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eO(e){let t=e.name;if(eN.has(t))return eS.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eN.set(t,e),eA.values()))eD(r,e);for(let t of ek.values())eD(t,e);return!0}function eR(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eP(e){return void 0!==e.settings}let eL=new z("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eM{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Z("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eL.create("app-deleted",{appName:this._name})}}let eV="11.0.1";function eU(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n=Object.assign({name:ex,automaticDataCollectionEnabled:!1},t),i=n.name;if("string"!=typeof i||!i)throw eL.create("bad-app-name",{appName:String(i)});if(r||(r=M()),!r)throw eL.create("no-options");let s=eA.get(i);if(s){if($(r,s.options)&&$(n,s.config))return s;throw eL.create("duplicate-app",{appName:i})}let a=new er(i);for(let e of eN.values())a.addComponent(e);let o=new eM(r,n,a);return eA.set(i,o),o}function eF(e=ex){let t=eA.get(e);if(!t&&e===ex&&M())return eU();if(!t)throw eL.create("no-app",{appName:e});return t}function ej(e,t,r){var n;let i=null!==(n=eC[e])&&void 0!==n?n:e;r&&(i+=`-${r}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eS.warn(e.join(" "));return}eO(new Z(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}let eB="firebase-heartbeat-store",eq=null;function ez(){return eq||(eq=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eg(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eg(a.result),e.oldVersion,e.newVersion,eg(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(eB)}catch(e){console.warn(e)}}}).catch(e=>{throw eL.create("idb-open",{originalErrorMessage:e.message})})),eq}async function eK(e){try{let t=(await ez()).transaction(eB),r=await t.objectStore(eB).get(eG(e));return await t.done,r}catch(e){if(e instanceof q)eS.warn(e.message);else{let t=eL.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eS.warn(t.message)}}}async function e$(e,t){try{let r=(await ez()).transaction(eB,"readwrite"),n=r.objectStore(eB);await n.put(t,eG(e)),await r.done}catch(e){if(e instanceof q)eS.warn(e.message);else{let t=eL.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eS.warn(t.message)}}}function eG(e){return`${e.name}!${e.options.appId}`}class eH{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new eQ(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=eW();if((null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;return this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(e){eS.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=eW(),{heartbeatsToSend:r,unsentEntries:n}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),eJ(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),eJ(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=A(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return eS.warn(e),""}}}function eW(){return new Date().toISOString().substring(0,10)}class eQ{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!B()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await eK(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return e$(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return e$(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function eJ(e){return A(JSON.stringify({version:2,heartbeats:e})).length}function eY(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function eX(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}eO(new Z("platform-logger",e=>new e_(e),"PRIVATE")),eO(new Z("heartbeat",e=>new eH(e),"PRIVATE")),ej(eE,eT,""),ej(eE,eT,"esm2017"),ej("fire-js",""),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;let eZ=new z("auth","Firebase",eX()),e0=new el("@firebase/auth");function e1(e,...t){e0.logLevel<=s.ERROR&&e0.error(`Auth (${eV}): ${e}`,...t)}function e2(e,...t){throw e3(e,...t)}function e5(e,...t){return e3(e,...t)}function e6(e,t,r){return new z("auth","Firebase",Object.assign(Object.assign({},eX()),{[t]:r})).create(t,{appName:e.name})}function e4(e){return e6(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function e3(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return eZ.create(e,...t)}function e8(e,t,...r){if(!e)throw e3(t,...r)}function e7(e){let t="INTERNAL ASSERTION FAILED: "+e;throw e1(t),Error(t)}function e9(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function te(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class tt{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||e7(r),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(F())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===te()||"https:"===te()||function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tr(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||e7(n);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class tn{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void e7("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void e7("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void e7("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let ti={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ts=new tt(3e4,6e4);function ta(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function to(e,t,r,n,i={}){return tl(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=H(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l=Object.assign({method:t,headers:o},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),tn.fetch()(th(e,e.config.apiHost,r,a),l)})}async function tl(e,t,r){e._canInitEmulator=!1;let n=Object.assign(Object.assign({},ti),t);try{let t=new tc(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw td(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw td(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw td(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw td(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw e6(e,a,r);e2(e,a)}}catch(t){if(t instanceof q)throw t;e2(e,"network-request-failed",{message:String(t)})}}async function tu(e,t,r,n,i={}){let s=await to(e,t,r,n,i);return"mfaPendingCredential"in s&&e2(e,"multi-factor-auth-required",{_serverResponse:s}),s}function th(e,t,r,n){let i=`${t}${r}?${n}`;return e.config.emulator?tr(e.config,i):`${e.config.apiScheme}://${i}`}class tc{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(e5(this.auth,"network-request-failed")),ts.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function td(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=e5(e,t,n);return i.customData._tokenResponse=r,i}function tf(e){return void 0!==e&&void 0!==e.enterprise}class tp{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return function(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function tm(e,t){return to(e,"GET","/v2/recaptchaConfig",ta(e,t))}async function tg(e,t){return to(e,"POST","/v1/accounts:delete",t)}async function ty(e,t){return to(e,"POST","/v1/accounts:lookup",t)}function tv(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function tw(e,t=!1){let r=X(e),n=await r.getIdToken(t),i=tI(n);e8(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:tv(tb(i.auth_time)),issuedAtTime:tv(tb(i.iat)),expirationTime:tv(tb(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function tb(e){return 1e3*Number(e)}function tI(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return e1("JWT malformed, contained fewer than 3 sections"),null;try{let e=k(r);if(!e)return e1("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return e1("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function t_(e){let t=tI(e);return e8(t,"internal-error"),e8(void 0!==t.exp,"internal-error"),e8(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function tE(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof q&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tT{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class tS{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tv(this.lastLoginAt),this.creationTime=tv(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tx(e){var t;let r=e.auth,n=await e.getIdToken(),i=await tE(e,ty(r,{idToken:n}));e8(null==i?void 0:i.users.length,r,"internal-error");let s=i.users[0];e._notifyReloadListener(s);let a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?tA(s.providerUserInfo):[],o=[...e.providerData.filter(e=>!a.some(t=>t.providerId===e.providerId)),...a],l=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(null==o?void 0:o.length);Object.assign(e,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new tS(s.createdAt,s.lastLoginAt),isAnonymous:!!l&&u})}async function tC(e){let t=X(e);await tx(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function tA(e){return e.map(e=>{var{providerId:t}=e,r=eY(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function tk(e,t){let r=await tl(e,{},async()=>{let r=H({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=th(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",tn.fetch()(s,{method:"POST",headers:a,body:r})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function tN(e,t){return to(e,"POST","/v2/accounts:revokeToken",ta(e,t))}class tD{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){e8(e.idToken,"internal-error"),e8(void 0!==e.idToken,"internal-error"),e8(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):t_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){e8(0!==e.length,"internal-error");let t=t_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(e8(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await tk(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new tD;return r&&(e8("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(e8("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(e8("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tD,this.toJSON())}_performRefresh(){return e7("not implemented")}}function tO(e,t){e8("string"==typeof e||void 0===e,"internal-error",{appName:t})}class tR{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,i=eY(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tT(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new tS(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await tE(this,this.stsTokenManager.getToken(this.auth,e));return e8(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tw(this,e)}reload(){return tC(this)}_assign(e){this!==e&&(e8(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new tR(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){e8(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await tx(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eP(this.auth.app))return Promise.reject(e4(this.auth));let e=await this.getIdToken();return await tE(this,tg(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,i,s,a,o,l,u;let h=null!==(r=t.displayName)&&void 0!==r?r:void 0,c=null!==(n=t.email)&&void 0!==n?n:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(a=t.tenantId)&&void 0!==a?a:void 0,m=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:I,stsTokenManager:_}=t;e8(v&&_,e,"internal-error");let E=tD.fromJSON(this.name,_);e8("string"==typeof v,e,"internal-error"),tO(h,e.name),tO(c,e.name),e8("boolean"==typeof w,e,"internal-error"),e8("boolean"==typeof b,e,"internal-error"),tO(d,e.name),tO(f,e.name),tO(p,e.name),tO(m,e.name),tO(g,e.name),tO(y,e.name);let T=new tR({uid:v,auth:e,email:c,emailVerified:w,displayName:h,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:y});return I&&Array.isArray(I)&&(T.providerData=I.map(e=>Object.assign({},e))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(e,t,r=!1){let n=new tD;n.updateFromServerResponse(t);let i=new tR({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await tx(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];e8(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?tA(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length),a=new tD;a.updateFromIdToken(r);let o=new tR({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new tS(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length)}),o}}let tP=new Map;function tL(e){var t,r;t="Expected a class definition",e instanceof Function||e7(t);let n=tP.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||e7(r)):(n=new e,tP.set(e,n)),n}class tM{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function tV(e,t,r){return`firebase:${e}:${t}:${r}`}tM.type="NONE";class tU{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:n,name:i}=this.auth;this.fullUserKey=tV(this.userKey,n.apiKey,i),this.fullPersistenceKey=tV("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?tR._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new tU(tL(tM),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||tL(tM),s=tV(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n=tR._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch(e){}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new tU(i,e,r)}}function tF(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(tz(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";{if(t.includes("edge/"))return"Edge";if(tj(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(t$(t))return"Blackberry";if(tG(t))return"Webos";if(tB(t))return"Safari";if((t.includes("chrome/")||tq(t))&&!t.includes("edge/"))return"Chrome";if(tK(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==r?void 0:r.length)===2)return r[1]}return"Other"}function tj(e=F()){return/firefox\//i.test(e)}function tB(e=F()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function tq(e=F()){return/crios\//i.test(e)}function tz(e=F()){return/iemobile/i.test(e)}function tK(e=F()){return/android/i.test(e)}function t$(e=F()){return/blackberry/i.test(e)}function tG(e=F()){return/webos/i.test(e)}function tH(e=F()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function tW(e=F()){return tH(e)||tK(e)||tG(e)||t$(e)||/windows phone/i.test(e)||tz(e)}function tQ(e,t=[]){let r;switch(e){case"Browser":r=tF(F());break;case"Worker":r=`${tF(F())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${eV}/${n}`}class tJ{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function tY(e,t={}){return to(e,"GET","/v2/passwordPolicy",ta(e,t))}class tX{constructor(e){var t,r,n,i;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,i,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(r=o.meetsMaxPasswordLength)||void 0===r||r),o.isValid&&(o.isValid=null===(n=o.containsLowercaseLetter)||void 0===n||n),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsNumericCharacter)||void 0===s||s),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class tZ{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new t0(this),this.idTokenSubscription=new t0(this),this.beforeStateQueue=new tJ(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=eZ,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=tL(t)),this._initializationPromise=this.queue(async()=>{var r,n;if(!this._deleted&&(this.persistenceManager=await tU.create(this,e),!this._deleted)){if(null===(r=this._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(n=this.currentUser)||void 0===n?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await ty(this,{idToken:e}),r=await tR._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(eP(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let r=await this.assertedPersistence.getCurrentUser(),n=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,a=await this.tryRedirectSignIn(e);(!r||r===s)&&(null==a?void 0:a.user)&&(n=a.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(e8(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tx(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eP(this.app))return Promise.reject(e4(this));let t=e?X(e):null;return t&&e8(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&e8(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eP(this.app)?Promise.reject(e4(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eP(this.app)?Promise.reject(e4(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(tL(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new tX(await tY(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new z("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await tN(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&tL(e)||this._popupRedirectResolver;e8(t,this,"argument-error"),this.redirectPersistenceManager=await tU.create(this,[tL(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return(this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e)?this._currentUser:(null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(e8(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return e8(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=tQ(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=await (null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);let n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;let t=await (null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){e0.logLevel<=s.WARN&&e0.warn(`Auth (${eV}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}class t0{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new J(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return e8(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let t1={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function t2(e){return`__${e}${Math.floor(1e6*Math.random())}`}class t5{constructor(){this.enterprise=new t6}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class t6{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let t4="NO_RECAPTCHA";class t3{constructor(e){this.type="recaptcha-enterprise",this.auth=X(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{tm(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new tp(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;tf(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(t4)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new t5().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&tf(window.grecaptcha))n(r,e,i);else{var s;if("undefined"==typeof window){i(Error("RecaptchaVerifier is only supported in browser"));return}let t=t1.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(s=t,t1.loadJS(s)).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function t8(e,t,r,n=!1,i=!1){let s;let a=new t3(e);if(i)s=t4;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function t7(e,t,r,n,i){var s,a;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(s=e._getRecaptchaConfig())||void 0===s||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await t8(e,t,r,"getOobCode"===r);return n(e,i)}});{let i=await t8(e,t,r,"getOobCode"===r);return n(e,i)}}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(null===(a=e._getRecaptchaConfig())||void 0===a?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let i=await t8(e,t,r);return n(e,i).catch(async i=>{var s;if((null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await t8(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await t8(e,t,r,!1,!0);return n(e,i)}}async function t9(e){let t=X(e),r=new tp(await tm(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new t3(t).verify()}function re(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rt(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class rr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return e7("not implemented")}_getIdTokenResponse(e){return e7("not implemented")}_linkToIdToken(e,t){return e7("not implemented")}_getReauthenticationResolver(e){return e7("not implemented")}}async function rn(e,t){return to(e,"POST","/v1/accounts:signUp",t)}async function ri(e,t){return tu(e,"POST","/v1/accounts:signInWithPassword",ta(e,t))}async function rs(e,t){return tu(e,"POST","/v1/accounts:signInWithEmailLink",ta(e,t))}async function ra(e,t){return tu(e,"POST","/v1/accounts:signInWithEmailLink",ta(e,t))}class ro extends rr{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new ro(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ro(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return t7(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",ri,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return rs(e,{email:this._email,oobCode:this._password});default:e2(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return t7(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rn,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ra(e,{idToken:t,email:this._email,oobCode:this._password});default:e2(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function rl(e,t){return tu(e,"POST","/v1/accounts:signInWithIdp",ta(e,t))}class ru extends rr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new ru(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):e2("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,i=eY(t,["providerId","signInMethod"]);if(!r||!n)return null;let s=new ru(r,n);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return rl(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,rl(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,rl(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=H(t)}return e}}async function rh(e,t){return to(e,"POST","/v1/accounts:sendVerificationCode",ta(e,t))}async function rc(e,t){return tu(e,"POST","/v1/accounts:signInWithPhoneNumber",ta(e,t))}async function rd(e,t){let r=await tu(e,"POST","/v1/accounts:signInWithPhoneNumber",ta(e,t));if(r.temporaryProof)throw td(e,"account-exists-with-different-credential",r);return r}let rf={USER_NOT_FOUND:"user-not-found"};async function rp(e,t){return tu(e,"POST","/v1/accounts:signInWithPhoneNumber",ta(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),rf)}class rm extends rr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new rm({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new rm({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return rc(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return rd(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return rp(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new rm({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class rg{constructor(e){var t,r,n,i,s,a;let o=W(Q(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,u=null!==(r=o.oobCode)&&void 0!==r?r:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(n=o.mode)&&void 0!==n?n:null);e8(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=null!==(i=o.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=o.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){let t=function(e){let t=W(Q(e)).link,r=t?W(Q(t)).deep_link_id:null,n=W(Q(e)).deep_link_id;return(n?W(Q(n)).link:null)||n||r||t||e}(e);try{return new rg(t)}catch(e){return null}}}class ry{constructor(){this.providerId=ry.PROVIDER_ID}static credential(e,t){return ro._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=rg.parseLink(t);return e8(r,"argument-error"),ro._fromEmailAndCode(e,r.code,r.tenantId)}}ry.PROVIDER_ID="password",ry.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ry.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class rv{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rw extends rv{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rb extends rw{constructor(){super("facebook.com")}static credential(e){return ru._fromParams({providerId:rb.PROVIDER_ID,signInMethod:rb.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rb.credentialFromTaggedObject(e)}static credentialFromError(e){return rb.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rb.credential(e.oauthAccessToken)}catch(e){return null}}}rb.FACEBOOK_SIGN_IN_METHOD="facebook.com",rb.PROVIDER_ID="facebook.com";class rI extends rw{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ru._fromParams({providerId:rI.PROVIDER_ID,signInMethod:rI.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rI.credentialFromTaggedObject(e)}static credentialFromError(e){return rI.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return rI.credential(t,r)}catch(e){return null}}}rI.GOOGLE_SIGN_IN_METHOD="google.com",rI.PROVIDER_ID="google.com";class r_ extends rw{constructor(){super("github.com")}static credential(e){return ru._fromParams({providerId:r_.PROVIDER_ID,signInMethod:r_.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return r_.credentialFromTaggedObject(e)}static credentialFromError(e){return r_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return r_.credential(e.oauthAccessToken)}catch(e){return null}}}r_.GITHUB_SIGN_IN_METHOD="github.com",r_.PROVIDER_ID="github.com";class rE extends rw{constructor(){super("twitter.com")}static credential(e,t){return ru._fromParams({providerId:rE.PROVIDER_ID,signInMethod:rE.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rE.credentialFromTaggedObject(e)}static credentialFromError(e){return rE.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return rE.credential(t,r)}catch(e){return null}}}async function rT(e,t){return tu(e,"POST","/v1/accounts:signUp",ta(e,t))}rE.TWITTER_SIGN_IN_METHOD="twitter.com",rE.PROVIDER_ID="twitter.com";class rS{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new rS({user:await tR._fromIdTokenResponse(e,r,n),providerId:rx(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new rS({user:e,providerId:rx(r),_tokenResponse:r,operationType:t})}}function rx(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rC extends q{constructor(e,t,r,n){var i;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,rC.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new rC(e,t,r,n)}}function rA(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw rC._fromErrorAndOperation(e,r,t,n);throw r})}async function rk(e,t,r=!1){let n=await tE(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return rS._forOperation(e,"link",n)}async function rN(e,t,r=!1){let{auth:n}=e;if(eP(n.app))return Promise.reject(e4(n));let i="reauthenticate";try{let s=await tE(e,rA(n,i,t,e),r);e8(s.idToken,n,"internal-error");let a=tI(s.idToken);e8(a,n,"internal-error");let{sub:o}=a;return e8(e.uid===o,n,"user-mismatch"),rS._forOperation(e,i,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&e2(n,"user-mismatch"),e}}async function rD(e,t,r=!1){if(eP(e.app))return Promise.reject(e4(e));let n="signIn",i=await rA(e,n,t),s=await rS._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(s.user),s}async function rO(e,t){return rD(X(e),t)}class rR{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?rP._fromServerResponse(e,t):"totpInfo"in t?rL._fromServerResponse(e,t):e2(e,"internal-error")}}class rP extends rR{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new rP(t)}}class rL extends rR{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new rL(t)}}async function rM(e){let t=X(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function rV(e,t,r){if(eP(e.app))return Promise.reject(e4(e));let n=X(e),i=t7(n,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rT,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rM(e),t}),a=await rS._fromIdTokenResponse(n,"signIn",s);return await n._updateCurrentUser(a.user),a}class rU{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class rF{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new rF("enroll",e,t)}static _fromMfaPendingCredential(e){return new rF("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return rF._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(r=e.multiFactorSession)||void 0===r?void 0:r.idToken)return rF._fromIdtoken(e.multiFactorSession.idToken)}return null}}class rj{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){let r=X(e),n=t.customData._serverResponse,i=(n.mfaInfo||[]).map(e=>rR._fromServerResponse(r,e));e8(n.mfaPendingCredential,r,"internal-error");let s=rF._fromMfaPendingCredential(n.mfaPendingCredential);return new rj(s,i,async e=>{let i=await e._process(r,s);delete n.mfaInfo,delete n.mfaPendingCredential;let a=Object.assign(Object.assign({},n),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let o=await rS._fromIdTokenResponse(r,t.operationType,a);return await r._updateCurrentUser(o.user),o;case"reauthenticate":return e8(t.user,r,"internal-error"),rS._forOperation(t.user,t.operationType,a);default:e2(r,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}function rB(e,t){return to(e,"POST","/v2/accounts/mfaEnrollment:start",ta(e,t))}class rq{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>rR._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new rq(e)}async getSession(){return rF._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let r=await this.getSession(),n=await tE(this.user,e._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(n),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,r=await this.user.getIdToken();try{var n,i;let e=await tE(this.user,(n=this.user.auth,i={idToken:r,mfaEnrollmentId:t},to(n,"POST","/v2/accounts/mfaEnrollment:withdraw",ta(n,i))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;let rz="__sak";class rK{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(rz,"1"),this.storage.removeItem(rz),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class r$ extends rK{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tW(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});return}let r=e.key;t?this.detachListener():this.stopPolling();let n=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},i=this.storage.getItem(r);(function(){let e=F();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0})()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}r$.type="LOCAL";class rG extends rK{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rG.type="SESSION";class rH{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new rH(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let s=Array.from(i).map(async t=>t(e.origin,n)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rW(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}rH.receivers=[];class rQ{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,i;let s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=rW("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},r);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),n=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(u),clearTimeout(n),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function rJ(){return window}function rY(){return void 0!==rJ().WorkerGlobalScope&&"function"==typeof rJ().importScripts}async function rX(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let rZ="firebaseLocalStorageDb",r0="firebaseLocalStorage",r1="fbase_key";class r2{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function r5(e,t){return e.transaction([r0],t?"readwrite":"readonly").objectStore(r0)}function r6(){let e=indexedDB.open(rZ,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(r0,{keyPath:r1})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(r0)?t(r):(r.close(),await new r2(indexedDB.deleteDatabase(rZ)).toPromise(),t(await r6()))})})}async function r4(e,t,r){return new r2(r5(e,!0).put({[r1]:t,value:r})).toPromise()}async function r3(e,t){let r=r5(e,!1).get(t),n=await new r2(r).toPromise();return void 0===n?null:n.value}function r8(e,t){return new r2(r5(e,!0).delete(t)).toPromise()}class r7{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await r6()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rY()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rH._getInstance(rY()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await rX(),!this.activeServiceWorker)return;this.sender=new rQ(this.activeServiceWorker);let r=await this.sender._send("ping",{},800);r&&(null===(e=r[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=r[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null==navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await r6();return await r4(e,rz,"1"),await r8(e,rz),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>r4(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>r3(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>r8(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new r2(r5(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:i}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function r9(e,t){return to(e,"POST","/v2/accounts/mfaSignIn:start",ta(e,t))}r7.type="LOCAL",t2("rcb"),new tt(3e4,6e4);let ne="recaptcha";async function nt(e,t,r){var n;if(!e._getRecaptchaConfig())try{await t9(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){e8("enroll"===t.type,e,"internal-error");let n={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===t4){e8((null==r?void 0:r.type)===ne,e,"argument-error");let n=await nr(e,t,r);return rB(e,n)}return rB(e,t)},a=t7(e,n,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{e8("signin"===t.type,e,"internal-error");let s=(null===(n=i.multiFactorHint)||void 0===n?void 0:n.uid)||i.multiFactorUid;e8(s,e,"missing-multi-factor-info");let a={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===t4){e8((null==r?void 0:r.type)===ne,e,"argument-error");let n=await nr(e,t,r);return r9(e,n)}return r9(e,t)},l=t7(e,a,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await l.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},n=async(e,t)=>{if(t.captchaResponse===t4){e8((null==r?void 0:r.type)===ne,e,"argument-error");let n=await nr(e,t,r);return rh(e,n)}return rh(e,t)},s=t7(e,t,"sendVerificationCode",n,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==r||r._reset()}}async function nr(e,t,r){e8(r.type===ne,e,"argument-error");let n=await r.verify();e8("string"==typeof n,e,"argument-error");let i=Object.assign({},t);if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,r=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:n}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,r=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),i}}class nn{constructor(e){this.providerId=nn.PROVIDER_ID,this.auth=X(e)}verifyPhoneNumber(e,t){return nt(this.auth,e,X(t))}static credential(e,t){return rm._fromVerification(e,t)}static credentialFromResult(e){return nn.credentialFromTaggedObject(e)}static credentialFromError(e){return nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?rm._fromTokenResponse(t,r):null}}nn.PROVIDER_ID="phone",nn.PHONE_SIGN_IN_METHOD="phone";class ni extends rr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return rl(e,this._buildIdpRequest())}_linkToIdToken(e,t){return rl(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return rl(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ns(e){return rD(e.auth,new ni(e),e.bypassAuthState)}function na(e){let{auth:t,user:r}=e;return e8(r,t,"internal-error"),rN(r,new ni(e),e.bypassAuthState)}async function no(e){let{auth:t,user:r}=e;return e8(r,t,"internal-error"),rk(r,new ni(e),e.bypassAuthState)}class nl{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s){this.reject(s);return}let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ns;case"linkViaPopup":case"linkViaRedirect":return no;case"reauthViaPopup":case"reauthViaRedirect":return na;default:e2(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||e7(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||e7(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let nu=new tt(2e3,1e4);class nh extends nl{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,nh.currentPopupAction&&nh.currentPopupAction.cancel(),nh.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return e8(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||e7(t);let r=rW();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(e5(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(e5(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nh.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,r;if(null===(r=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===r?void 0:r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(e5(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nu.get())};e()}}nh.currentPopupAction=null;let nc=new Map;class nd extends nl{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=nc.get(this.auth._key());if(!e){try{let t=await nf(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}nc.set(this.auth._key(),e)}return this.bypassAuthState||nc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nf(e,t){let r=ng(t),n=nm(e);if(!await n._isAvailable())return!1;let i=await n._get(r)==="true";return await n._remove(r),i}function np(e,t){nc.set(e._key(),t)}function nm(e){return tL(e._redirectPersistence)}function ng(e){return tV("pendingRedirect",e.config.apiKey,e.name)}async function ny(e,t,r=!1){var n,i;if(eP(e.app))return Promise.reject(e4(e));let s=X(e),a=(n=s,(i=t)?tL(i):(e8(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)),o=new nd(s,a,r),l=await o.execute();return l&&!r&&(delete l.user._redirectEventId,await s._persistUserIfCurrent(l.user),await s._setRedirectUser(null,t)),l}class nv{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nb(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!nb(e)){let n=(null===(r=e.error.code)||void 0===r?void 0:r.split("auth/")[1])||"internal-error";t.onError(e5(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(nw(e))}saveEventToCache(e){this.cachedEventUids.add(nw(e)),this.lastProcessedEventTime=Date.now()}}function nw(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function nb({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function nI(e,t={}){return to(e,"GET","/v1/projects",t)}let n_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nE=/^https?/;async function nT(e){if(e.config.emulator)return;let{authorizedDomains:t}=await nI(e);for(let e of t)try{if(function(e){let t=e9(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&i.hostname===n}if(!nE.test(r))return!1;if(n_.test(e))return n===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}(e))return}catch(e){}e2(e,"unauthorized-domain")}let nS=new tt(3e4,6e4);function nx(){let e=rJ().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let nC=null,nA=new tt(5e3,15e3),nk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function nD(e){let t=await (nC=nC||new Promise((t,r)=>{var n,i,s,a;function o(){nx(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{nx(),r(e5(e,"network-request-failed"))},timeout:nS.get()})}if(null===(i=null===(n=rJ().gapi)||void 0===n?void 0:n.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else if(null===(s=rJ().gapi)||void 0===s?void 0:s.load)o();else{let t=t2("iframefcb");return rJ()[t]=()=>{gapi.load?o():r(e5(e,"network-request-failed"))},(a=`${t1.gapiScript}?onload=${t}`,t1.loadJS(a)).catch(e=>r(e))}}).catch(e=>{throw nC=null,e})),r=rJ().gapi;return e8(r,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;e8(t.authDomain,e,"auth-domain-config-required");let r=t.emulator?tr(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:eV},i=nN.get(e.config.apiHost);i&&(n.eid=i);let s=e._getFrameworks();return s.length&&(n.fw=s.join(",")),`${r}?${H(n).slice(1)}`}(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nk,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let i=e5(e,"network-request-failed"),s=rJ().setTimeout(()=>{n(i)},nA.get());function a(){rJ().clearTimeout(s),r(t)}t.ping(a).then(a,()=>{n(i)})}))}let nO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class nR{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let nP=encodeURIComponent("fac");async function nL(e,t,r,n,i,s){e8(e.config.authDomain,e,"auth-domain-config-required"),e8(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:eV,eventId:i};if(t instanceof rv)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[r]=n;if(t instanceof rw){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${nP}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?tr(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${H(a).slice(1)}${l}`}let nM="webStorageSupport";class nV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rG,this._completeRedirectFn=ny,this._overrideRedirectResult=np}async _openPopup(e,t,r,n){var i,s,a;s=null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,a="_initialize() not called before _openPopup()",s||e7(a);let o=await nL(e,t,r,e9(),n);return function(e,t,r,n=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString(),o="",l=Object.assign(Object.assign({},nO),{width:n.toString(),height:i.toString(),top:s,left:a}),u=F().toLowerCase();r&&(o=tq(u)?"_blank":r),tj(u)&&(t=t||"http://localhost",l.scrollbars="yes");let h=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=F()){var t;return tH(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==o)return function(e,t){let r=document.createElement("a");r.href=e,r.target=t;let n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}(t||"",o),new nR(null);let c=window.open(t||"",o,h);e8(c,e,"popup-blocked");try{c.focus()}catch(e){}return new nR(c)}(e,o,rW())}async _openRedirect(e,t,r,n){var i;return await this._originValidation(e),i=await nL(e,t,r,e9(),n),rJ().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||e7(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await nD(e),r=new nv(e);return t.register("authEvent",t=>(e8(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(nM,{type:nM},r=>{var n;let i=null===(n=null==r?void 0:r[0])||void 0===n?void 0:n[nM];void 0!==i&&t(!!i),e2(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nT(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return tW()||tB()||tH()}}class nU{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return e7("unexpected MultiFactorSessionType")}}}class nF extends nU{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new nF(e)}_finalizeEnroll(e,t,r){return to(e,"POST","/v2/accounts/mfaEnrollment:finalize",ta(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return to(e,"POST","/v2/accounts/mfaSignIn:finalize",ta(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class nj{constructor(){}static assertion(e){return nF._fromCredential(e)}}nj.FACTOR_ID="phone";class nB{static assertionForEnrollment(e,t){return nq._fromSecret(e,t)}static assertionForSignIn(e,t){return nq._fromEnrollmentId(e,t)}static async generateSecret(e){var t,r;e8(void 0!==(null===(t=e.user)||void 0===t?void 0:t.auth),"internal-error");let n=await to(r=e.user.auth,"POST","/v2/accounts/mfaEnrollment:start",ta(r,{idToken:e.credential,totpEnrollmentInfo:{}}));return nz._fromStartTotpMfaEnrollmentResponse(n,e.user.auth)}}nB.FACTOR_ID="totp";class nq extends nU{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new nq(t,void 0,e)}static _fromEnrollmentId(e,t){return new nq(t,e)}async _finalizeEnroll(e,t,r){return e8(void 0!==this.secret,e,"argument-error"),to(e,"POST","/v2/accounts/mfaEnrollment:finalize",ta(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}))}async _finalizeSignIn(e,t){e8(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return to(e,"POST","/v2/accounts/mfaSignIn:finalize",ta(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r}))}}class nz{constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new nz(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let n=!1;return(nK(e)||nK(t))&&(n=!0),n&&(nK(e)&&(e=(null===(r=this.auth.currentUser)||void 0===r?void 0:r.email)||"unknownuser"),nK(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function nK(e){return void 0===e||(null==e?void 0:e.length)===0}var n$="@firebase/auth",nG="1.8.0";class nH{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){e8(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let nW=V("authIdTokenMaxAge")||300,nQ=null,nJ=e=>async t=>{let r=t&&await t.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>nW)return;let i=null==r?void 0:r.token;nQ!==i&&(nQ=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function nY(e=eF()){let t=eR(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=eR(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if($(r.getOptions(),null!=t?t:{}))return e;e2(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:nV,persistence:[r7,r$,rG]}),n=V("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(n,location.origin);if(location.origin===e.origin){var i,s;let t=nJ(e.toString());i=()=>t(r.currentUser),X(r).beforeAuthStateChanged(t,i),s=e=>t(e),X(r).onIdTokenChanged(s,void 0,void 0)}}let a=P("auth");return a&&function(e,t,r){let n=X(e);e8(n._canInitEmulator,n,"emulator-config-failed"),e8(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=re(t),{host:s,port:a}=function(e){let t=re(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:rt(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:rt(t)}}}(t),o=null===a?"":`:${a}`;n.config.emulator={url:`${i}//${s}${o}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})}),function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${a}`),r}t1={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=e5("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document})().appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},function(e){eO(new Z("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;e8(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let l=new tZ(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tQ(e)});return function(e,t){let r=(null==t?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(tL);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),eO(new Z("auth-internal",e=>new nH(X(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),ej(n$,nG,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(e)),ej(n$,nG,"esm2017")}("Browser");var nX="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},nZ={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function t(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;16>i;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^r&(i^s))+n[0]+0xd76aa478&0xffffffff;a=s+(i^(t=r+(a<<7&0xffffffff|a>>>25))&(r^i))+n[1]+0xe8c7b756&0xffffffff,a=i+(r^(s=t+(a<<12&0xffffffff|a>>>20))&(t^r))+n[2]+0x242070db&0xffffffff,a=r+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+n[3]+0xc1bdceee&0xffffffff,a=t+(s^(r=i+(a<<22&0xffffffff|a>>>10))&(i^s))+n[4]+0xf57c0faf&0xffffffff,a=s+(i^(t=r+(a<<7&0xffffffff|a>>>25))&(r^i))+n[5]+0x4787c62a&0xffffffff,a=i+(r^(s=t+(a<<12&0xffffffff|a>>>20))&(t^r))+n[6]+0xa8304613&0xffffffff,a=r+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+n[7]+0xfd469501&0xffffffff,a=t+(s^(r=i+(a<<22&0xffffffff|a>>>10))&(i^s))+n[8]+0x698098d8&0xffffffff,a=s+(i^(t=r+(a<<7&0xffffffff|a>>>25))&(r^i))+n[9]+0x8b44f7af&0xffffffff,a=i+(r^(s=t+(a<<12&0xffffffff|a>>>20))&(t^r))+n[10]+0xffff5bb1&0xffffffff,a=r+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+n[11]+0x895cd7be&0xffffffff,a=t+(s^(r=i+(a<<22&0xffffffff|a>>>10))&(i^s))+n[12]+0x6b901122&0xffffffff,a=s+(i^(t=r+(a<<7&0xffffffff|a>>>25))&(r^i))+n[13]+0xfd987193&0xffffffff,a=i+(r^(s=t+(a<<12&0xffffffff|a>>>20))&(t^r))+n[14]+0xa679438e&0xffffffff,a=r+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+n[15]+0x49b40821&0xffffffff,r=i+(a<<22&0xffffffff|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562&0xffffffff,t=r+(a<<5&0xffffffff|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa&0xffffffff,r=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d&0xffffffff,t=r+(a<<5&0xffffffff|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8&0xffffffff,r=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6&0xffffffff,t=r+(a<<5&0xffffffff|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed&0xffffffff,r=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905&0xffffffff,t=r+(a<<5&0xffffffff|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a&0xffffffff,a=t+((r=i+(a<<20&0xffffffff|a>>>12))^i^s)+n[5]+0xfffa3942&0xffffffff,a=s+((t=r+(a<<4&0xffffffff|a>>>28))^r^i)+n[8]+0x8771f681&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^r)+n[11]+0x6d9d6122&0xffffffff,a=r+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+n[14]+0xfde5380c&0xffffffff,a=t+((r=i+(a<<23&0xffffffff|a>>>9))^i^s)+n[1]+0xa4beea44&0xffffffff,a=s+((t=r+(a<<4&0xffffffff|a>>>28))^r^i)+n[4]+0x4bdecfa9&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^r)+n[7]+0xf6bb4b60&0xffffffff,a=r+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+n[10]+0xbebfbc70&0xffffffff,a=t+((r=i+(a<<23&0xffffffff|a>>>9))^i^s)+n[13]+0x289b7ec6&0xffffffff,a=s+((t=r+(a<<4&0xffffffff|a>>>28))^r^i)+n[0]+0xeaa127fa&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^r)+n[3]+0xd4ef3085&0xffffffff,a=r+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+n[6]+0x4881d05&0xffffffff,a=t+((r=i+(a<<23&0xffffffff|a>>>9))^i^s)+n[9]+0xd9d4d039&0xffffffff,a=s+((t=r+(a<<4&0xffffffff|a>>>28))^r^i)+n[12]+0xe6db99e5&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^r)+n[15]+0x1fa27cf8&0xffffffff,a=r+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+n[2]+0xc4ac5665&0xffffffff,r=i+(a<<23&0xffffffff|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244&0xffffffff,t=r+(a<<6&0xffffffff|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039&0xffffffff,r=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3&0xffffffff,t=r+(a<<6&0xffffffff|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1&0xffffffff,r=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f&0xffffffff,t=r+(a<<6&0xffffffff|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1&0xffffffff,r=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82&0xffffffff,t=r+(a<<6&0xffffffff|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391&0xffffffff,e.g[0]=e.g[0]+t&0xffffffff,e.g[1]=e.g[1]+(i+(a<<21&0xffffffff|a>>>11))&0xffffffff,e.g[2]=e.g[2]+i&0xffffffff,e.g[3]=e.g[3]+s&0xffffffff}function r(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){var s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}!function(e,t){function r(){}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,r){void 0===r&&(r=e.length);for(var n=r-this.blockSize,i=this.B,s=this.h,a=0;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var n,i={};function s(e){var t;return -128<=e&&128>e?(t=function(e){return new r([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(i,e)?i[e]:i[e]=t(e)):new r([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return u;if(0>e)return p(l(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=0x100000000;return new r(t,0)}var u=s(0),h=s(1),c=s(0x1000000);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(h)}function m(e,t){return e.add(p(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function v(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(u,u);if(f(e))return t=v(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=v(e,p(t)),new y(p(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var r=h,n=t;0>=n.l(e);)r=w(r),n=w(n);var i=b(r,1),s=b(n,1);for(n=b(n,2),r=b(r,2);!d(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=b(n,1),r=b(r,1)}return t=m(e,i.j(t)),new y(i,t)}for(i=u;0<=e.l(t);){for(n=48>=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,n-48),a=(s=l(r)).j(t);f(a)||0<a.l(e);)r-=n,a=(s=l(r)).j(t);d(s)&&(s=h),i=i.add(s),e=m(e,a)}return new y(i,e)}function w(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function b(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],a=0;a<i;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new r(s,e.h)}(n=r.prototype).m=function(){if(f(this))return-p(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:0x100000000+n)*t,t*=0x100000000}return e},n.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);for(var t=l(Math.pow(e,6)),r=this,n="";;){var i=v(r,t).g,s=((0<(r=m(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(d(r=i))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},n.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},n.l=function(e){return f(e=m(this,e))?-1:d(e)?0:1},n.abs=function(){return f(this)?p(this):this},n.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var a=i+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new r(n,-0x80000000&n[n.length-1]?-1:0)},n.j=function(e){if(d(this)||d(e))return u;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var a=this.i(i)>>>16,o=65535&this.i(i),h=e.i(s)>>>16,m=65535&e.i(s);n[2*i+2*s]+=o*m,g(n,2*i+2*s),n[2*i+2*s+1]+=a*m,g(n,2*i+2*s+1),n[2*i+2*s+1]+=o*h,g(n,2*i+2*s+1),n[2*i+2*s+2]+=a*h,g(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},n.A=function(e){return v(this,e).h},n.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},n.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},n.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,o=nZ.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=l,r.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if(2>(r=r||10)||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return p(e(t.substring(1),r));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=l(Math.pow(r,8)),i=u,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),r);8>a?(a=l(Math.pow(r,a)),i=i.j(a).add(l(o))):i=(i=i.j(n)).add(l(o))}return i},a=nZ.Integer=r}).apply(void 0!==nX?nX:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var n0="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n1={};(function(){var e,t,r,n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof n0&&n0];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var r=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in r))break e;r=r[a]}(t=t(s=r[e=e[e.length-1]]))!=s&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,r,n,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),r=0,n=!1,(i={next:function(){if(!n&&r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,r){return e.call.apply(e.bind,arguments)}function v(e,t,r){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),e.apply(t,r)}}return function(){return e.apply(t,arguments)}}function w(e,t,r){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function I(e,t){function r(){}r.prototype=t.prototype,e.aa=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Qb=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}function _(e){let t=e.length;if(0<t){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function E(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(o(r)){let t=e.length||0,n=r.length||0;e.length=t+n;for(let i=0;i<n;i++)e[t+i]=r[i]}else e.push(r)}}class T{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function S(e){return/^[\s\xa0]*$/.test(e)}function x(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function C(e){return C[" "](e),e}C[" "]=function(){};var A=-1!=x().indexOf("Gecko")&&!(-1!=x().toLowerCase().indexOf("webkit")&&-1==x().indexOf("Edge"))&&!(-1!=x().indexOf("Trident")||-1!=x().indexOf("MSIE"))&&-1==x().indexOf("Edge");function k(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function N(e){let t={};for(let r in e)t[r]=e[r];return t}let D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<D.length;t++)r=D[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}class R{constructor(){this.h=this.g=null}add(e,t){let r=P.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}}var P=new T(()=>new L,e=>e.reset());class L{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let M,V=!1,U=new R,F=()=>{let e=a.Promise.resolve(void 0);M=()=>{e.then(j)}};var j=()=>{let e;for(var t;e=null,U.g&&(e=U.g,U.g=U.g.next,U.g||(U.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}P.j(t),100>P.h&&(P.h++,t.next=P.g,P.g=t)}V=!1};function B(){this.s=this.s,this.C=this.C}function q(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},q.prototype.h=function(){this.defaultPrevented=!0};var z=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function K(e,t){if(q.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(A){e:{try{C(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement);this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:$[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&K.aa.h.call(this)}}I(K,q);var $={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var G="closure_listenable_"+(1e6*Math.random()|0),H=0;function W(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++H,this.da=this.fa=!1}function Q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function J(e){this.src=e,this.g={},this.h=0}function Y(e,t){var r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=0<=s)&&Array.prototype.splice.call(i,s,1),n&&(Q(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function X(e,t,r,n){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}J.prototype.add=function(e,t,r,n,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=X(e,t,n,i);return -1<a?(t=e[a],r||(t.fa=!1)):((t=new W(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var Z="closure_lm_"+(1e6*Math.random()|0),ee={};function et(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");var a=g(i)?!!i.capture:!!i,o=es(e);if(o||(e[Z]=o=new J(e)),(r=o.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return ei.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)z||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(en(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function er(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[G])Y(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(en(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=es(t))?(Y(r,e),0==r.h&&(r.src=null,t[Z]=null)):Q(e)}}}function en(e){return e in ee?ee[e]:ee[e]="on"+e}function ei(e,t){if(e.da)e=!0;else{t=new K(t,this);var r=e.listener,n=e.ha||e.src;e.fa&&er(e),e=r.call(n,t)}return e}function es(e){return(e=e[Z])instanceof J?e:null}var ea="__closure_events_fn_"+(1e9*Math.random()>>>0);function eo(e){return"function"==typeof e?e:(e[ea]||(e[ea]=function(t){return e.handleEvent(t)}),e[ea])}function el(){B.call(this),this.i=new J(this),this.M=this,this.F=null}function eu(e,t){var r,n=e.F;if(n)for(r=[];n;n=n.F)r.push(n);if(e=e.M,n=t.type||t,"string"==typeof t)t=new q(t,e);else if(t instanceof q)t.target=t.target||e;else{var i=t;O(t=new q(n,e),i)}if(i=!0,r)for(var s=r.length-1;0<=s;s--){var a=t.g=r[s];i=eh(a,n,!0,t)&&i}if(i=eh(a=t.g=e,n,!0,t)&&i,i=eh(a,n,!1,t)&&i,r)for(s=0;s<r.length;s++)i=eh(a=t.g=r[s],n,!1,t)&&i}function eh(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==r){var o=a.listener,l=a.ha||a.src;a.fa&&Y(e.i,a),i=!1!==o.call(l,n)&&i}}return i&&!n.defaultPrevented}function ec(e,t,r){if("function"==typeof e)r&&(e=w(e,r));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:a.setTimeout(e,t||0)}I(el,B),el.prototype[G]=!0,el.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=g(i)?!!i.capture:!!i,n=eo(n),t&&t[G])?(t=t.i,(r=String(r).toString())in t.g&&-1<(n=X(a=t.g[r],n,i,s))&&(Q(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete t.g[r],t.h--))):t&&(t=es(t))&&(r=t.g[r.toString()],t=-1,r&&(t=X(r,n,i,s)),(n=-1<t?r[t]:null)&&er(n))}(this,e,t,r,n)},el.prototype.N=function(){if(el.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var r=t.g[e],n=0;n<r.length;n++)Q(r[n]);delete t.g[e],t.h--}}this.F=null},el.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},el.prototype.L=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ed extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ec(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ef(e){B.call(this),this.h=e,this.g={}}I(ef,B);var ep=[];function em(e){k(e.g,function(e,t){this.g.hasOwnProperty(t)&&er(e)},e),e.g={}}ef.prototype.N=function(){ef.aa.N.call(this),em(this)},ef.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eg=a.JSON.stringify,ey=a.JSON.parse,ev=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ew(){}function eb(e){return e.h||(e.h=e.i())}function eI(){}ew.prototype.h=null;var e_={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eE(){q.call(this,"d")}function eT(){q.call(this,"c")}I(eE,q),I(eT,q);var eS={},ex=null;function eC(){return ex=ex||new el}function eA(e){q.call(this,eS.La,e)}function ek(e){let t=eC();eu(t,new eA(t))}function eN(e,t){q.call(this,eS.STAT_EVENT,e),this.stat=t}function eD(e){let t=eC();eu(t,new eN(t,e))}function eO(e,t){q.call(this,eS.Ma,e),this.size=t}function eR(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eP(){this.g=!0}function eL(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var r=JSON.parse(t);if(r){for(e=0;e<r.length;e++)if(Array.isArray(r[e])){var n=r[e];if(!(2>n.length)){var i=n[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return eg(r)}catch(e){return t}}(e,r)+(n?" "+n:"")})}eS.La="serverreachability",I(eA,q),eS.STAT_EVENT="statevent",I(eN,q),eS.Ma="timingevent",I(eO,q),eP.prototype.xa=function(){this.g=!1},eP.prototype.info=function(){};var eM={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eV={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eU(){}function eF(e,t,r,n){this.j=e,this.i=t,this.l=r,this.R=n||1,this.U=new ef(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ej}function ej(){this.i=null,this.g="",this.h=!1}I(eU,ew),eU.prototype.g=function(){return new XMLHttpRequest},eU.prototype.i=function(){return{}},t=new eU;var eB={},eq={};function ez(e,t,r){e.L=1,e.v=ti(e9(t)),e.m=r,e.P=!0,eK(e,null)}function eK(e,t){e.F=Date.now(),eG(e),e.A=e9(e.v);var r=e.A,n=e.R;Array.isArray(n)||(n=[String(n)]),ty(r.i,"t",n),e.C=0,r=e.j.J,e.h=new ej,e.g=t5(e.j,r?t:null,!e.m),0<e.O&&(e.M=new ed(w(e.Y,e,e.g),e.O)),t=e.U,r=e.g,n=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ep[0]=i.toString()),i=ep);for(var s=0;s<i.length;s++){var a=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=eo(n),t&&t[G]?t.L(r,n,g(i)?!!i.capture:!!i,s):et(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=eo(n),t&&t[G]?t.K(r,n,g(i)?!!i.capture:!!i,s):et(t,r,n,!1,i,s)}(r,i[s],n||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?N(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),ek(),function(e,t,r,n,i,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");a=2<=c.length&&"type"==c[1]?a+(h+"=")+u+"&":a+(h+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+n+") [attempt "+i+"]: "+t+"\n"+r+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function e$(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eG(e){e.S=Date.now()+e.I,eH(e,e.I)}function eH(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eR(w(e.ba,e),t)}function eW(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function eQ(e){0==e.j.G||e.J||tX(e.j,e)}function eJ(e){eW(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,em(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eY(e,t){try{var r=e.j;if(0!=r.G&&(r.g==e||e2(r.h,e))){if(!e.K&&e2(r.h,e)&&3==r.G){try{var n=r.Da.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.u){if(r.g){if(r.g.F+3e3<e.F)tY(r),tB(r);else break e}tW(r),eD(18)}}else r.za=i[1],0<r.za-r.T&&37500>i[2]&&r.F&&0==r.v&&!r.C&&(r.C=eR(w(r.Za,r),6e3));if(1>=e1(r.h)&&r.ca){try{r.ca()}catch(e){}r.ca=void 0}}else t0(r,11)}else if((e.K||r.g==e)&&tY(r),!S(t))for(i=r.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(r.T=o[0],o=o[1],2==r.G){if("c"==o[0]){r.K=o[1],r.ia=o[2];let t=o[3];null!=t&&(r.la=t,r.j.info("VER="+r.la));let i=o[4];null!=i&&(r.Aa=i,r.j.info("SVER="+r.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n=1.5*l,r.L=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e5(s,s.h),s.h=null))}if(n.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.ya=e,tn(n.I,n.D,e))}}if(r.G=3,r.l&&r.l.ua(),r.ba&&(r.R=Date.now()-e.F,r.j.info("Handshake RTT: "+r.R+"ms")),(n=r).qa=t2(n,n.J?n.ia:null,n.W),e.K){e6(n.h,e);var a=n.L;a&&(e.I=a),e.B&&(eW(e),eG(e)),n.g=e}else tH(n);0<r.i.length&&tz(r)}else"stop"!=o[0]&&"close"!=o[0]||t0(r,7)}else 3==r.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t0(r,7):tj(r):"noop"!=o[0]&&r.l&&r.l.ta(o),r.v=0)}}ek(4)}catch(e){}}eF.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tM(e)?t.j():this.Y(e)},eF.prototype.Y=function(e){try{if(e==this.g)e:{let d=tM(this.g);var t=this.g.Ba();let f=this.g.Z();if(!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||tV(this.g)))){this.J||4!=d||7==t||(8==t||0>=f?ek(3):ek(2)),eW(this);var r=this.g.Z();this.X=r;t:if(e$(this)){var n=tV(this.g);e="";var i=n.length,s=4==tM(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eJ(this),eQ(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(n[t],{stream:!(s&&t==i-1)});n.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==r,function(e,t,r,n,i,s,a){e.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+i+"]: "+t+"\n"+r+"\n"+s+" "+a})}(this.i,this.u,this.A,this.l,this.R,d,r),this.o){if(this.T&&!this.K){t:{if(this.g){var l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(l)){var h=l;break t}}h=null}if(r=h)eL(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eY(this,r);else{this.o=!1,this.s=3,eD(12),eJ(this),eQ(this);break e}}if(this.P){let e;for(r=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eq:isNaN(r=Number(t.substring(r,n)))?eB:(n+=1)+r>t.length?eq:(t=t.slice(n,n+r),e.C=n+r,t)}(this,o))==eq){4==d&&(this.s=4,eD(14),r=!1),eL(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eB){this.s=4,eD(15),eL(this.i,this.l,o,"[Invalid Chunk]"),r=!1;break}else eL(this.i,this.l,e,null),eY(this,e);if(e$(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=o.length||this.h.h||(this.s=1,eD(16),r=!1),this.o=this.o&&r,r){if(0<o.length&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.ba&&!c.M&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tQ(c),c.M=!0,eD(11))}}else eL(this.i,this.l,o,"[Invalid Chunked Response]"),eJ(this),eQ(this)}else eL(this.i,this.l,o,null),eY(this,o);4==d&&eJ(this),this.o&&!this.J&&(4==d?tX(this.j,this):(this.o=!1,eG(this)))}else(function(e){let t={};e=(e.g&&2<=tM(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(S(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;0<t&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}!function(e,t){for(let r in e)t.call(void 0,e[r],r,e)}(t,function(e){return e.join(", ")})})(this.g),400==r&&0<o.indexOf("Unknown SID")?(this.s=3,eD(12)):(this.s=0,eD(13)),eJ(this),eQ(this)}}}catch(e){}finally{}},eF.prototype.cancel=function(){this.J=!0,eJ(this)},eF.prototype.ba=function(){this.B=null;let e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(ek(),eD(17)),eJ(this),this.s=2,eQ(this)):eH(this,this.S-e)};var eX=class{constructor(e,t){this.g=e,this.map=t}};function eZ(e){this.l=e||10,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function e0(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e1(e){return e.h?1:e.g?e.g.size:0}function e2(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e5(e,t){e.g?e.g.add(t):e.h=t}function e6(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e4(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.D);return t}return _(e.i)}function e3(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var r=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(o(e)||"string"==typeof e){var t=[];e=e.length;for(var r=0;r<e;r++)t.push(r);return t}for(let n in t=[],r=0,e)t[r++]=n;return t}}}(e),n=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(o(e)){for(var t=[],r=e.length,n=0;n<r;n++)t.push(e[n]);return t}for(n in t=[],r=0,e)t[r++]=e[n];return t}(e),i=n.length,s=0;s<i;s++)t.call(void 0,n[s],r&&r[s],e)}eZ.prototype.cancel=function(){if(this.i=e4(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e8=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e7(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e7){this.h=e.h,te(this,e.j),this.o=e.o,this.g=e.g,tt(this,e.s),this.l=e.l;var t=e.i,r=new tf;r.i=t.i,t.g&&(r.g=new Map(t.g),r.h=t.h),tr(this,r),this.m=e.m}else e&&(t=String(e).match(e8))?(this.h=!1,te(this,t[1]||"",!0),this.o=ts(t[2]||""),this.g=ts(t[3]||"",!0),tt(this,t[4]),this.l=ts(t[5]||"",!0),tr(this,t[6]||"",!0),this.m=ts(t[7]||"")):(this.h=!1,this.i=new tf(null,this.h))}function e9(e){return new e7(e)}function te(e,t,r){e.j=r?ts(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tt(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tr(e,t,r){var n,i;t instanceof tf?(e.i=t,n=e.i,(i=e.h)&&!n.j&&(tp(n),n.i=null,n.g.forEach(function(e,t){var r=t.toLowerCase();t!=r&&(tm(this,t),ty(this,r,e))},n)),n.j=i):(r||(t=ta(t,tc)),e.i=new tf(t,e.h))}function tn(e,t,r){e.i.set(t,r)}function ti(e){return tn(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ts(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ta(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,to),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function to(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e7.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ta(t,tl,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ta(t,tl,!0),"@"),e.push(encodeURIComponent(String(r)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.s)&&e.push(":",String(r))),(r=this.l)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(ta(r,"/"==r.charAt(0)?th:tu,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",ta(r,td)),e.join("")};var tl=/[#\/\?@]/g,tu=/[#\?:]/g,th=/[#\?]/g,tc=/[#\?@]/g,td=/#/g;function tf(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tp(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var r=0;r<e.length;r++){var n=e[r].indexOf("="),i=null;if(0<=n){var s=e[r].substring(0,n);i=e[r].substring(n+1)}else s=e[r];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function tm(e,t){tp(e),t=tv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tg(e,t){return tp(e),t=tv(e,t),e.g.has(t)}function ty(e,t,r){tm(e,t),0<r.length&&(e.i=null,e.g.set(tv(e,t),_(r)),e.h+=r.length)}function tv(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tw(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tb(){this.g=new ev}function tI(e){this.l=e.Ub||null,this.j=e.eb||!1}function t_(e,t){el.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tE(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tT(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tS(e)}function tS(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tx(e){let t="";return k(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tC(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tx(r),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):tn(e,t,r))}function tA(e){el.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=tf.prototype).add=function(e,t){tp(this),this.i=null,e=tv(this,e);var r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},r.forEach=function(e,t){tp(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},r.na=function(){tp(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),r=[];for(let n=0;n<t.length;n++){let i=e[n];for(let e=0;e<i.length;e++)r.push(t[n])}return r},r.V=function(e){tp(this);let t=[];if("string"==typeof e)tg(this,e)&&(t=t.concat(this.g.get(tv(this,e))));else{e=Array.from(this.g.values());for(let r=0;r<e.length;r++)t=t.concat(e[r])}return t},r.set=function(e,t){return tp(this),this.i=null,tg(this,e=tv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var r=0;r<t.length;r++){var n=t[r];let s=encodeURIComponent(String(n)),a=this.V(n);for(n=0;n<a.length;n++){var i=s;""!==a[n]&&(i+="="+encodeURIComponent(String(a[n]))),e.push(i)}}return this.i=e.join("&")},I(tI,ew),tI.prototype.g=function(){return new t_(this.l,this.j)},tI.prototype.i=(e={},function(){return e}),I(t_,el),(r=t_.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tS(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tT(this)),this.readyState=0},r.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tS(this)),this.g&&(this.readyState=3,tS(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tE(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))}},r.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tT(this):tS(this),3==this.readyState&&tE(this)}},r.Ra=function(e){this.g&&(this.response=this.responseText=e,tT(this))},r.Qa=function(e){this.g&&(this.response=e,tT(this))},r.ga=function(){this.g&&tT(this)},r.setRequestHeader=function(e,t){this.u.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(t_.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),I(tA,el);var tk=/^https?$/i,tN=["POST","PUT"];function tD(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tO(e),tP(e)}function tO(e){e.A||(e.A=!0,eu(e,"complete"),eu(e,"error"))}function tR(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tM(e)||2!=e.Z())){if(e.u&&4==tM(e))ec(e.Ea,0,e);else if(eu(e,"readystatechange"),4==tM(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){var i=String(e.D).match(e8)[1]||null;!i&&a.self&&a.self.location&&(i=a.self.location.protocol.slice(0,-1)),r=!tk.test(i?i.toLowerCase():"")}t=r}if(t)eu(e,"complete"),eu(e,"success");else{e.m=6;try{var o=2<tM(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tO(e)}}finally{tP(e)}}}}function tP(e,t){if(e.g){tL(e);let r=e.g,n=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eu(e,"ready");try{r.onreadystatechange=n}catch(e){}}}function tL(e){e.I&&(a.clearTimeout(e.I),e.I=null)}function tM(e){return e.g?e.g.readyState:0}function tV(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tU(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tF(e){this.Aa=0,this.i=[],this.j=new eP,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tU("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tU("baseRetryDelayMs",5e3,e),this.cb=tU("retryDelaySeedMs",1e4,e),this.Wa=tU("forwardChannelMaxRetries",2,e),this.wa=tU("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eZ(e&&e.concurrentRequestLimit),this.Da=new tb,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tj(e){if(tq(e),3==e.G){var t=e.U++,r=e9(e.I);if(tn(r,"SID",e.K),tn(r,"RID",t),tn(r,"TYPE","terminate"),t$(e,r),(t=new eF(e,e.j,t)).L=2,t.v=ti(e9(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.v,r=!0),r||(t.g=t5(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eG(t)}t1(e)}function tB(e){e.g&&(tQ(e),e.g.cancel(),e.g=null)}function tq(e){tB(e),e.u&&(a.clearTimeout(e.u),e.u=null),tY(e),e.h.cancel(),e.s&&("number"==typeof e.s&&a.clearTimeout(e.s),e.s=null)}function tz(e){if(!e0(e.h)&&!e.s){e.s=!0;var t=e.Ga;M||F(),V||(M(),V=!0),U.add(t,e),e.B=0}}function tK(e,t){var r;r=t?t.l:e.U++;let n=e9(e.I);tn(n,"SID",e.K),tn(n,"RID",r),tn(n,"AID",e.T),t$(e,n),e.m&&e.o&&tC(n,e.m,e.o),r=new eF(e,e.j,r,e.B+1),null===e.m&&(r.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tG(e,r,1e3),r.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e5(e.h,r),ez(r,n,t)}function t$(e,t){e.H&&k(e.H,function(e,r){tn(t,r,e)}),e.l&&e3({},function(e,r){tn(t,r,e)})}function tG(e,t,r){r=Math.min(e.i.length,r);var n=e.l?w(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?0<r?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<r;a++){let r=i[a].g,o=i[a].map;if(0>(r-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,r){let n=r||"";try{e3(e,function(e,r){let i=e;g(e)&&(i=eg(e)),t.push(n+r+"="+encodeURIComponent(i))})}catch(e){throw t.push(n+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+r+"_")}catch(e){n&&n(o)}}if(s){n=e.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,n}function tH(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;M||F(),V||(M(),V=!0),U.add(t,e),e.v=0}}function tW(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eR(w(e.Fa,e),tZ(e,e.v)),e.v++,!0)}function tQ(e){null!=e.A&&(a.clearTimeout(e.A),e.A=null)}function tJ(e){e.g=new eF(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e9(e.qa);tn(t,"RID","rpc"),tn(t,"SID",e.K),tn(t,"AID",e.T),tn(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tn(t,"TO",e.ja),tn(t,"TYPE","xmlhttp"),t$(e,t),e.m&&e.o&&tC(t,e.m,e.o),e.L&&(e.g.I=e.L);var r=e.g;e=e.ia,r.L=1,r.v=ti(e9(t)),r.m=null,r.P=!0,eK(r,e)}function tY(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tX(e,t){var r=null;if(e.g==t){tY(e),tQ(e),e.g=null;var n=2}else{if(!e2(e.h,t))return;r=t.D,e6(e.h,t),n=1}if(0!=e.G){if(t.o){if(1==n){r=t.m?t.m.length:0,t=Date.now()-t.F;var i,s=e.B;eu(n=eC(),new eO(n,r)),tz(e)}else tH(e)}else if(3==(s=t.s)||0==s&&0<t.X||!(1==n&&(i=t,!(e1(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=i.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eR(w(e.Ga,e,i),tZ(e,e.B)),e.B++,!0)))||2==n&&tW(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:t0(e,5);break;case 4:t0(e,10);break;case 3:t0(e,6);break;default:t0(e,2)}}}function tZ(e,t){let r=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(r*=2),r*t}function t0(e,t){if(e.j.info("Error code "+t),2==t){var r=w(e.fb,e),n=e.Xa;let t=!n;n=new e7(n||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||te(n,"https"),ti(n),t?function(e,t){let r=new eP;if(a.Image){let n=new Image;n.onload=b(tw,r,"TestLoadImage: loaded",!0,t,n),n.onerror=b(tw,r,"TestLoadImage: error",!1,t,n),n.onabort=b(tw,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=b(tw,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),r):function(e,t){let r=new eP,n=new AbortController,i=setTimeout(()=>{n.abort(),tw(r,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?tw(r,"TestPingServer: ok",!0,t):tw(r,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),tw(r,"TestPingServer: error",!1,t)})}(n.toString(),r)}else eD(2);e.G=0,e.l&&e.l.sa(t),t1(e),tq(e)}function t1(e){if(e.G=0,e.ka=[],e.l){let t=e4(e.h);(0!=t.length||0!=e.i.length)&&(E(e.ka,t),E(e.ka,e.i),e.h.i.length=0,_(e.i),e.i.length=0),e.l.ra()}}function t2(e,t,r){var n=r instanceof e7?e9(r):new e7(r);if(""!=n.g)t&&(n.g=t+"."+n.g),tt(n,n.s);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e7(null);n&&te(s,n),t&&(s.g=t),i&&tt(s,i),r&&(s.l=r),n=s}return r=e.D,t=e.ya,r&&t&&tn(n,r,t),tn(n,"VER",e.la),t$(e,n),n}function t5(e,t,r){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tA(e.Ca&&!e.pa?new tI({eb:r}):e.pa)).Ha(e.J),t}function t6(){}function t4(){}function t3(e,t){el.call(this),this.g=new tF(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!S(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t8(e){eE.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t7(){eT.call(this),this.status=1}function t9(e){this.g=e}(r=tA.prototype).Ha=function(e){this.J=e},r.ea=function(e,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);r=r?r.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?eb(this.o):eb(t),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(r,String(e),!0),this.B=!1}catch(e){tD(this,e);return}if(e=n||"",n=new Map(this.headers),i){if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i))}for(let[t,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&e instanceof a.FormData,!(0<=Array.prototype.indexOf.call(tN,r,void 0))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tL(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tD(this,e)}},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eu(this,"complete"),eu(this,"abort"),tP(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tP(this,!0)),tA.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?tR(this):this.bb())},r.bb=function(){tR(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<tM(this)?this.g.status:-1}catch(e){return -1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ey(t)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=tF.prototype).la=8,r.G=1,r.connect=function(e,t,r,n){eD(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.I=t2(this,null,this.W),tz(this)},r.Ga=function(e){if(this.s){if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eF(this,this.j,e),s=this.o;if(this.S&&(s?O(s=N(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if(4096<(t+=n)){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tG(this,i,t),tn(r=e9(this.I),"RID",e),tn(r,"CVER",22),this.D&&tn(r,"X-HTTP-Session-Id",this.D),t$(this,r),s&&(this.O?t="headers="+encodeURIComponent(String(tx(s)))+"&"+t:this.m&&tC(r,this.m,s)),e5(this.h,i),this.Ua&&tn(r,"TYPE","init"),this.P?(tn(r,"$req",t),tn(r,"SID","null"),i.T=!0,ez(i,r,null)):ez(i,r,t),this.G=2}}else 3==this.G&&(e?tK(this,e):0==this.i.length||e0(this.h)||tK(this))}},r.Fa=function(){if(this.u=null,tJ(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eR(w(this.ab,this),e)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eD(10),tB(this),tJ(this))},r.Za=function(){null!=this.C&&(this.C=null,tB(this),tW(this),eD(19))},r.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eD(2)):(this.j.info("Failed to ping google.com"),eD(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=t6.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},t4.prototype.g=function(e,t){return new t3(e,t)},I(t3,el),t3.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t3.prototype.close=function(){tj(this.g)},t3.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.u&&((r={}).__data__=eg(e),e=r);t.i.push(new eX(t.Ya++,e)),3==t.G&&tz(t)},t3.prototype.N=function(){this.g.l=null,delete this.j,tj(this.g),delete this.g,t3.aa.N.call(this)},I(t8,eE),I(t7,eT),I(t9,t6),t9.prototype.ua=function(){eu(this.g,"a")},t9.prototype.ta=function(e){eu(this.g,new t8(e))},t9.prototype.sa=function(e){eu(this.g,new t7)},t9.prototype.ra=function(){eu(this.g,"b")},t4.prototype.createWebChannel=t4.prototype.g,t3.prototype.send=t3.prototype.o,t3.prototype.open=t3.prototype.m,t3.prototype.close=t3.prototype.close,m=n1.createWebChannelTransport=function(){return new t4},p=n1.getStatEventTarget=function(){return eC()},f=n1.Event=eS,d=n1.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eM.NO_ERROR=0,eM.TIMEOUT=8,eM.HTTP_ERROR=6,c=n1.ErrorCode=eM,eV.COMPLETE="complete",h=n1.EventType=eV,eI.EventType=e_,e_.OPEN="a",e_.CLOSE="b",e_.ERROR="c",e_.MESSAGE="d",el.prototype.listen=el.prototype.K,u=n1.WebChannel=eI,n1.FetchXmlHttpFactory=tI,tA.prototype.listenOnce=tA.prototype.L,tA.prototype.getLastError=tA.prototype.Ka,tA.prototype.getLastErrorCode=tA.prototype.Ba,tA.prototype.getStatus=tA.prototype.Z,tA.prototype.getResponseJson=tA.prototype.Oa,tA.prototype.getResponseText=tA.prototype.oa,tA.prototype.send=tA.prototype.ea,tA.prototype.setWithCredentials=tA.prototype.Ha,l=n1.XhrIo=tA}).apply(void 0!==n0?n0:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var n2=r(4406),n5=r(8834).lW;let n6="@firebase/firestore";class n4{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n4.UNAUTHENTICATED=new n4(null),n4.GOOGLE_CREDENTIALS=new n4("google-credentials-uid"),n4.FIRST_PARTY=new n4("first-party-uid"),n4.MOCK_USER=new n4("mock-user");let n3="11.0.0",n8=new el("@firebase/firestore");function n7(){return n8.logLevel}function n9(e,...t){if(n8.logLevel<=s.DEBUG){let r=t.map(ir);n8.debug(`Firestore (${n3}): ${e}`,...r)}}function ie(e,...t){if(n8.logLevel<=s.ERROR){let r=t.map(ir);n8.error(`Firestore (${n3}): ${e}`,...r)}}function it(e,...t){if(n8.logLevel<=s.WARN){let r=t.map(ir);n8.warn(`Firestore (${n3}): ${e}`,...r)}}function ir(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function ii(e="Unexpected state"){let t=`FIRESTORE (${n3}) INTERNAL ASSERTION FAILED: `+e;throw ie(t),Error(t)}let is={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ia extends q{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class io{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class il{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n4.UNAUTHENTICATED))}shutdown(){}}class ih{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ic{constructor(e){this.t=e,this.currentUser=n4.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){void 0===this.o||ii();let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new io;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new io,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{n9("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(n9("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new io)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(n9("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||ii(),new il(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||ii(),new n4(e)}}class id{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=n4.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ip{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new id(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(n4.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class im{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ig{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){void 0===this.o||ii();let r=e=>{null!=e.error&&n9("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.R;return this.R=e.token,n9("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{n9("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.A.getImmediate({optional:!0});e?n(e):n9("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||ii(),this.R=e.token,new im(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class iy{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let i=0;i<n.length;++i)r.length<20&&n[i]<t&&(r+=e.charAt(n[i]%e.length))}return r}}function iv(e,t){return e<t?-1:e>t?1:0}function iw(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}class ib{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ia(is.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new ia(is.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ib.fromMillis(Date.now())}static fromDate(e){return ib.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new ib(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?iv(this.nanoseconds,e.nanoseconds):iv(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class iI{constructor(e){this.timestamp=e}static fromTimestamp(e){return new iI(e)}static min(){return new iI(new ib(0,0))}static max(){return new iI(new ib(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class i_{constructor(e,t,r){void 0===t?t=0:t>e.length&&ii(),void 0===r?r=e.length-t:r>e.length-t&&ii(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===i_.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i_?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.get(n),i=t.get(n);if(r<i)return -1;if(r>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class iE extends i_{construct(e,t,r){return new iE(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new ia(is.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new iE(t)}static emptyPath(){return new iE([])}}let iT=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class iS extends i_{construct(e,t,r){return new iS(e,t,r)}static isValidIdentifier(e){return iT.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),iS.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new iS(["__name__"])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new ia(is.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new ia(is.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ia(is.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new ia(is.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new iS(t)}static emptyPath(){return new iS([])}}class ix{constructor(e){this.path=e}static fromPath(e){return new ix(iE.fromString(e))}static fromName(e){return new ix(iE.fromString(e).popFirst(5))}static empty(){return new ix(iE.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===iE.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return iE.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ix(new iE(e.slice()))}}class iC{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function iA(e){return e.fields.find(e=>2===e.kind)}function ik(e){return e.fields.filter(e=>2!==e.kind)}iC.UNKNOWN_ID=-1;class iN{constructor(e,t){this.fieldPath=e,this.kind=t}}class iD{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new iD(0,iP.min())}}function iO(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new iP(iI.fromTimestamp(1e9===n?new ib(r+1,0):new ib(r,n)),ix.empty(),t)}function iR(e){return new iP(e.readTime,e.key,-1)}class iP{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new iP(iI.min(),ix.empty(),-1)}static max(){return new iP(iI.max(),ix.empty(),-1)}}function iL(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r?r:0!==(r=ix.comparator(e.documentKey,t.documentKey))?r:iv(e.largestBatchId,t.largestBatchId)}let iM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iV{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function iU(e){if(e.code!==is.FAILED_PRECONDITION||e.message!==iM)throw e;n9("LocalStore","Unexpectedly lost primary lease")}class iF{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ii(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new iF((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof iF?t:iF.resolve(t)}catch(e){return iF.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):iF.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):iF.reject(t)}static resolve(e){return new iF((t,r)=>{t(e)})}static reject(e){return new iF((t,r)=>{r(e)})}static waitFor(e){return new iF((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=iF.resolve(!1);for(let r of e)t=t.next(e=>e?iF.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new iF((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new iF((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}class ij{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new io,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new iK(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{let r=iQ(t.target.error);this.V.reject(new iK(e,r))}}static open(e,t,r,n){try{return new ij(t,e.transaction(n,r))}catch(e){throw new iK(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(n9("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new iG(this.transaction.objectStore(e))}}class iB{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===iB.S(F())&&ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return n9("SimpleDb","Removing database:",e),iH(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!B())return!1;if(iB.v())return!0;let e=F(),t=iB.S(e),r=iq(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static v(){var e;return void 0!==n2&&"YES"===(null===(e=n2.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}async M(e){return this.db||(n9("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new iK(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new ia(is.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new ia(is.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new iK(e,n))},n.onupgradeneeded=e=>{n9("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.p.O(t,n.transaction,e.oldVersion,this.version).next(()=>{n9("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.M(e);let t=ij.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.g(),e)).catch(e=>(t.abort(e),iF.reject(e))).toPromise();return s.catch(()=>{}),await t.m,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(n9("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function iq(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class iz{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return iH(this.B.delete())}}class iK extends ia{constructor(e,t){super(is.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function i$(e){return"IndexedDbTransactionError"===e.name}class iG{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(n9("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(n9("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),iH(r)}add(e){return n9("SimpleDb","ADD",this.store.name,e,e),iH(this.store.add(e))}get(e){return iH(this.store.get(e)).next(t=>(void 0===t&&(t=null),n9("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return n9("SimpleDb","DELETE",this.store.name,e),iH(this.store.delete(e))}count(){return n9("SimpleDb","COUNT",this.store.name),iH(this.store.count())}U(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new iF((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.W(e,(e,r)=>{t.push(r)}).next(()=>t)}}G(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new iF((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}j(e,t){n9("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let n=this.cursor(r);return this.W(n,(e,t,r)=>r.delete())}J(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.W(n,t)}Y(e){let t=this.cursor({});return new iF((r,n)=>{t.onerror=e=>{n(iQ(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}W(e,t){let r=[];return new iF((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new iz(i),a=t(i.primaryKey,i.value,s);if(a instanceof iF){let e=a.catch(e=>(s.done(),iF.reject(e)));r.push(e)}s.isDone?n():null===s.K?i.continue():i.continue(s.K)}}).next(()=>iF.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function iH(e){return new iF((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(iQ(e.target.error))}})}let iW=!1;function iQ(e){let t=iB.S(F());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new ia("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return iW||(iW=!0,setTimeout(()=>{throw e},0)),e}}return e}class iJ{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){n9("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{n9("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(e){i$(e)?n9("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await iU(e)}await this.X(6e4)})}}class iY{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){let r=new Set,n=t,i=!0;return iF.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return n9("IndexBackfiller",`Processing collection: ${t}`),this.ne(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.re(n,r)).next(r=>(n9("IndexBackfiller",`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}re(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=iR(t);iL(n,r)>0&&(r=n)}),new iP(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class iX{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}function iZ(e){return null==e}function i0(e){return 0===e&&1/e==-1/0}function i1(e){return"number"==typeof e&&Number.isInteger(e)&&!i0(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function i2(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}function i5(e){let t=e.length;if(t>=2||ii(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||ii(),iE.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&ii(),e.charAt(t+1)){case"\x01":let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:ii()}s=t+2}return new iE(n)}iX.oe=-1;let i6=["userId","batchId"],i4={},i3=["prefixPath","collectionGroup","readTime","documentId"],i8=["prefixPath","collectionGroup","documentId"],i7=["collectionGroup","readTime","prefixPath","documentId"],i9=["canonicalId","targetId"],se=["targetId","path"],st=["path","targetId"],sr=["collectionId","parent"],sn=["indexId","uid"],si=["uid","sequenceNumber"],ss=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sa=["indexId","uid","orderedDocumentKey"],so=["userId","collectionPath","documentId"],sl=["userId","collectionPath","largestBatchId"],su=["userId","collectionGroup","largestBatchId"],sh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],sc=[...sh,"documentOverlays"],sd=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],sf=[...sd,"indexConfiguration","indexState","indexEntries"],sp=[...sf,"globals"];class sm extends iV{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function sg(e,t){return iB.F(e._e,t)}function sy(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function sv(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function sw(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sb{constructor(e,t){this.comparator=e,this.root=t||s_.EMPTY}insert(e,t){return new sb(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,s_.BLACK,null,null))}remove(e){return new sb(this.comparator,this.root.remove(e,this.comparator).copy(null,null,s_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sI(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sI(this.root,e,this.comparator,!1)}getReverseIterator(){return new sI(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sI(this.root,e,this.comparator,!0)}}class sI{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class s_{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:s_.RED,this.left=null!=n?n:s_.EMPTY,this.right=null!=i?i:s_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new s_(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return s_.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return s_.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,s_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,s_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ii();let e=this.left.check();if(e!==this.right.check())throw ii();return e+(this.isRed()?0:1)}}s_.EMPTY=null,s_.RED=!0,s_.BLACK=!1,s_.EMPTY=new class{constructor(){this.size=0}get key(){throw ii()}get value(){throw ii()}get color(){throw ii()}get left(){throw ii()}get right(){throw ii()}copy(e,t,r,n,i){return this}insert(e,t,r){return new s_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class sE{constructor(e){this.comparator=e,this.data=new sb(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sT(this.data.getIterator())}getIteratorFrom(e){return new sT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sE)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sE(this.comparator);return t.data=e,t}}class sT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sS(e){return e.hasNext()?e.getNext():void 0}class sx{constructor(e){this.fields=e,e.sort(iS.comparator)}static empty(){return new sx([])}unionWith(e){let t=new sE(iS.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new sx(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return iw(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class sC extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sA{constructor(e){this.binaryString=e}static fromBase64String(e){return new sA(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new sC("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new sA(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return iv(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sA.EMPTY_BYTE_STRING=new sA("");let sk=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sN(e){if(e||ii(),"string"==typeof e){let t=0,r=sk.exec(e);if(r||ii(),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sD(e.seconds),nanos:sD(e.nanos)}}function sD(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sO(e){return"string"==typeof e?sA.fromBase64String(e):sA.fromUint8Array(e)}function sR(e){var t,r;return"server_timestamp"===(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===r?void 0:r.stringValue)}function sP(e){let t=e.mapValue.fields.__previous_value__;return sR(t)?sP(t):t}function sL(e){let t=sN(e.mapValue.fields.__local_write_time__.timestampValue);return new ib(t.seconds,t.nanos)}class sM{constructor(e,t,r,n,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class sV{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new sV("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof sV&&e.projectId===this.projectId&&e.database===this.database}}let sU={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},sF={nullValue:"NULL_VALUE"};function sj(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sR(e)?4:s1(e)?0x1fffffffffffff:sZ(e)?10:11:ii()}function sB(e,t){if(e===t)return!0;let r=sj(e);if(r!==sj(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sL(e).isEqual(sL(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=sN(e.timestampValue),n=sN(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return sO(e.bytesValue).isEqual(sO(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return sD(e.geoPointValue.latitude)===sD(t.geoPointValue.latitude)&&sD(e.geoPointValue.longitude)===sD(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return sD(e.integerValue)===sD(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=sD(e.doubleValue),n=sD(t.doubleValue);return r===n?i0(r)===i0(n):isNaN(r)&&isNaN(n)}return!1}(e,t);case 9:return iw(e.arrayValue.values||[],t.arrayValue.values||[],sB);case 10:case 11:return function(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(sy(r)!==sy(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!sB(r[e],n[e])))return!1;return!0}(e,t);default:return ii()}}function sq(e,t){return void 0!==(e.values||[]).find(e=>sB(e,t))}function sz(e,t){if(e===t)return 0;let r=sj(e),n=sj(t);if(r!==n)return iv(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return iv(e.booleanValue,t.booleanValue);case 2:return function(e,t){let r=sD(e.integerValue||e.doubleValue),n=sD(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}(e,t);case 3:return sK(e.timestampValue,t.timestampValue);case 4:return sK(sL(e),sL(t));case 5:return iv(e.stringValue,t.stringValue);case 6:return function(e,t){let r=sO(e),n=sO(t);return r.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=iv(r[e],n[e]);if(0!==t)return t}return iv(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let r=iv(sD(e.latitude),sD(t.latitude));return 0!==r?r:iv(sD(e.longitude),sD(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return s$(e.arrayValue,t.arrayValue);case 10:return function(e,t){var r,n,i,s;let a=e.fields||{},o=t.fields||{},l=null===(r=a.value)||void 0===r?void 0:r.arrayValue,u=null===(n=o.value)||void 0===n?void 0:n.arrayValue,h=iv((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==h?h:s$(l,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===sU.mapValue&&t===sU.mapValue)return 0;if(e===sU.mapValue)return 1;if(t===sU.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=iv(n[e],s[e]);if(0!==t)return t;let a=sz(r[n[e]],i[s[e]]);if(0!==a)return a}return iv(n.length,s.length)}(e.mapValue,t.mapValue);default:throw ii()}}function sK(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return iv(e,t);let r=sN(e),n=sN(t),i=iv(r.seconds,n.seconds);return 0!==i?i:iv(r.nanos,n.nanos)}function s$(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=sz(r[e],n[e]);if(t)return t}return iv(r.length,n.length)}function sG(e){var t,r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=sN(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?sO(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ix.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=sG(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${sG(e.fields[i])}`;return r+"}"}(e.mapValue):ii()}function sH(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function sW(e){return!!e&&"integerValue"in e}function sQ(e){return!!e&&"arrayValue"in e}function sJ(e){return!!e&&"nullValue"in e}function sY(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sX(e){return!!e&&"mapValue"in e}function sZ(e){var t,r;return"__vector__"===(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===r?void 0:r.stringValue)}function s0(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return sv(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=s0(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=s0(e.arrayValue.values[r]);return t}return Object.assign({},e)}function s1(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}let s2={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function s5(e,t){let r=sz(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function s6(e,t){let r=sz(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class s4{constructor(e){this.value=e}static empty(){return new s4({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!sX(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=s0(t)}setAll(e){let t=iS.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=s0(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());sX(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sB(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];sX(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(sv(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new s4(s0(this.value))}}class s3{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new s3(e,0,iI.min(),iI.min(),iI.min(),s4.empty(),0)}static newFoundDocument(e,t,r,n){return new s3(e,1,t,iI.min(),r,n,0)}static newNoDocument(e,t){return new s3(e,2,t,iI.min(),iI.min(),s4.empty(),0)}static newUnknownDocument(e,t){return new s3(e,3,t,iI.min(),iI.min(),s4.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(iI.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=s4.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=s4.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=iI.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof s3&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new s3(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class s8{constructor(e,t){this.position=e,this.inclusive=t}}function s7(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?ix.comparator(ix.fromName(a.referenceValue),r.key):sz(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function s9(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!sB(e.position[r],t.position[r]))return!1;return!0}class ae{constructor(e,t="asc"){this.field=e,this.dir=t}}class at{}class ar extends at{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new au(e,t,r):"array-contains"===t?new af(e,r):"in"===t?new ap(e,r):"not-in"===t?new am(e,r):"array-contains-any"===t?new ag(e,r):new ar(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new ah(e,r):new ac(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(sz(t,this.value)):null!==t&&sj(this.value)===sj(t)&&this.matchesComparison(sz(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ii()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class an extends at{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new an(e,t)}matches(e){return ai(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function ai(e){return"and"===e.op}function as(e){return"or"===e.op}function aa(e){return ao(e)&&ai(e)}function ao(e){for(let t of e.filters)if(t instanceof an)return!1;return!0}function al(e,t){let r=e.filters.concat(t);return an.create(r,e.op)}class au extends ar{constructor(e,t,r){super(e,t,r),this.key=ix.fromName(r.referenceValue)}matches(e){let t=ix.comparator(e.key,this.key);return this.matchesComparison(t)}}class ah extends ar{constructor(e,t){super(e,"in",t),this.keys=ad("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ac extends ar{constructor(e,t){super(e,"not-in",t),this.keys=ad("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ad(e,t){var r;return((null===(r=t.arrayValue)||void 0===r?void 0:r.values)||[]).map(e=>ix.fromName(e.referenceValue))}class af extends ar{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return sQ(t)&&sq(t.arrayValue,this.value)}}class ap extends ar{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sq(this.value.arrayValue,t)}}class am extends ar{constructor(e,t){super(e,"not-in",t)}matches(e){if(sq(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!sq(this.value.arrayValue,t)}}class ag extends ar{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!sQ(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>sq(this.value.arrayValue,e))}}class ay{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.ue=null}}function av(e,t=null,r=[],n=[],i=null,s=null,a=null){return new ay(e,t,r,n,i,s,a)}function aw(e){if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof ar)return t.field.canonicalString()+t.op.toString()+sG(t.value);if(aa(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:"+(e.startAt.inclusive?"b:":"a:"),t+=e.startAt.position.map(e=>sG(e)).join(",")),e.endAt&&(t+="|ub:"+(e.endAt.inclusive?"a:":"b:"),t+=e.endAt.position.map(e=>sG(e)).join(",")),e.ue=t}return e.ue}function ab(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof ar?r instanceof ar&&t.op===r.op&&t.field.isEqual(r.field)&&sB(t.value,r.value):t instanceof an?r instanceof an&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void ii()}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!s9(e.startAt,t.startAt)&&s9(e.endAt,t.endAt)}function aI(e){return ix.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function a_(e,t){return e.filters.filter(e=>e instanceof ar&&e.field.isEqual(t))}function aE(e,t,r){let n=sF,i=!0;for(let r of a_(e,t)){let e=sF,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?sF:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?sH(sV.empty(),ix.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?sZ(s)?s2:{mapValue:{}}:ii();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=sF}0>s5({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>s5({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function aT(e,t,r){let n=sU,i=!0;for(let r of a_(e,t)){let e=sU,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?sH(sV.empty(),ix.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?s2:"mapValue"in s?sZ(s)?{mapValue:{}}:sU:ii(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=sU}s6({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];s6({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class aS{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function ax(e){return new aS(e)}function aC(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function aA(e){return null!==e.collectionGroup}function ak(e){if(null===e.ce){let t;e.ce=[];let r=new Set;for(let t of e.explicitOrderBy)e.ce.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new sE(iS.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.ce.push(new ae(t,n))}),r.has(iS.keyField().canonicalString())||e.ce.push(new ae(iS.keyField(),n))}return e.ce}function aN(e){return e.le||(e.le=function(e,t){if("F"===e.limitType)return av(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ae(e.field,t)});let r=e.endAt?new s8(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new s8(e.startAt.position,e.startAt.inclusive):null;return av(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}(e,ak(e))),e.le}function aD(e,t){let r=e.filters.concat([t]);return new aS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function aO(e,t,r){return new aS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function aR(e,t){return ab(aN(e),aN(t))&&e.limitType===t.limitType}function aP(e){return`${aw(aN(e))}|lt:${e.limitType}`}function aL(e){var t;let r;return`Query(target=${r=(t=aN(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof ar?`${t.field.canonicalString()} ${t.op} ${sG(t.value)}`:t instanceof an?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: "+(t.startAt.inclusive?"b:":"a:"),r+=t.startAt.position.map(e=>sG(e)).join(",")),t.endAt&&(r+=", endAt: "+(t.endAt.inclusive?"a:":"b:"),r+=t.endAt.position.map(e=>sG(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function aM(e,t){return t.isFoundDocument()&&function(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):ix.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(e,t)&&function(e,t){for(let r of ak(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,r){let n=s7(e,t,r);return e.inclusive?n<=0:n<0}(e.startAt,ak(e),t))&&(!e.endAt||!!function(e,t,r){let n=s7(e,t,r);return e.inclusive?n>=0:n>0}(e.endAt,ak(e),t))}function aV(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function aU(e){return(t,r)=>{let n=!1;for(let i of ak(e)){let e=function(e,t,r){let n=e.field.isKeyField()?ix.comparator(t.key,r.key):function(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?sz(n,i):ii()}(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return ii()}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class aF{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){sv(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return sw(this.inner)}size(){return this.innerSize}}let aj=new sb(ix.comparator),aB=new sb(ix.comparator);function aq(...e){let t=aB;for(let r of e)t=t.insert(r.key,r);return t}function az(e){let t=aB;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function aK(){return new aF(e=>e.toString(),(e,t)=>e.isEqual(t))}let a$=new sb(ix.comparator),aG=new sE(ix.comparator);function aH(...e){let t=aG;for(let r of e)t=t.add(r);return t}let aW=new sE(iv);function aQ(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:i0(t)?"-0":t}}function aJ(e){return{integerValue:""+e}}function aY(e,t){return i1(t)?aJ(t):aQ(e,t)}class aX{constructor(){this._=void 0}}function aZ(e,t){return e instanceof a4?sW(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class a0 extends aX{}class a1 extends aX{constructor(e){super(),this.elements=e}}function a2(e,t){let r=a8(t);for(let t of e.elements)r.some(e=>sB(e,t))||r.push(t);return{arrayValue:{values:r}}}class a5 extends aX{constructor(e){super(),this.elements=e}}function a6(e,t){let r=a8(t);for(let t of e.elements)r=r.filter(e=>!sB(e,t));return{arrayValue:{values:r}}}class a4 extends aX{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function a3(e){return sD(e.integerValue||e.doubleValue)}function a8(e){return sQ(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class a7{constructor(e,t){this.field=e,this.transform=t}}class a9{constructor(e,t){this.version=e,this.transformResults=t}}class oe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oe}static exists(e){return new oe(void 0,e)}static updateTime(e){return new oe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ot(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class or{}function on(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new oc(e.key,oe.none()):new oa(e.key,e.data,oe.none());{let r=e.data,n=s4.empty(),i=new sE(iS.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new oo(e.key,n,new sx(i.toArray()),oe.none())}}function oi(e,t,r,n){return e instanceof oa?function(e,t,r,n){if(!ot(e.precondition,t))return r;let i=e.value.clone(),s=oh(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof oo?function(e,t,r,n){if(!ot(e.precondition,t))return r;let i=oh(e.fieldTransforms,n,t),s=t.data;return(s.setAll(ol(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):ot(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function os(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&iw(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof a1&&n instanceof a1||r instanceof a5&&n instanceof a5?iw(r.elements,n.elements,sB):r instanceof a4&&n instanceof a4?sB(r.Pe,n.Pe):r instanceof a0&&n instanceof a0)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class oa extends or{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class oo extends or{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ol(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function ou(e,t,r){var n;let i=new Map;e.length===r.length||ii();for(let s=0;s<r.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(n=r[s],o instanceof a1?a2(o,l):o instanceof a5?a6(o,l):n))}return i}function oh(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,e instanceof a0?function(e,t){let r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&sR(t)&&(t=sP(t)),t&&(r.fields.__previous_value__=t),{mapValue:r}}(t,s):e instanceof a1?a2(e,s):e instanceof a5?a6(e,s):function(e,t){let r=aZ(e,t),n=a3(r)+a3(e.Pe);return sW(r)&&sW(e.Pe)?aJ(n):aQ(e.serializer,n)}(e,s))}return n}class oc extends or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class od extends or{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class of{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let i=this.mutations[t];if(i.key.isEqual(e.key)){var n;n=r[t],i instanceof oa?function(e,t,r){let n=e.value.clone(),i=ou(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(i,e,n):i instanceof oo?function(e,t,r){if(!ot(e.precondition,t))return void t.convertToUnknownDocument(r.version);let n=ou(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(ol(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(i,e,n):function(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}(0,e,n)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=oi(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=oi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=aK();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=on(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(iI.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),aH())}isEqual(e){return this.batchId===e.batchId&&iw(this.mutations,e.mutations,(e,t)=>os(e,t))&&iw(this.baseMutations,e.baseMutations,(e,t)=>os(e,t))}}class op{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){e.mutations.length===r.length||ii();let n=a$,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new op(e,t,r,n)}}class om{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class og{constructor(e,t){this.count=e,this.unchangedNames=t}}function oy(e){if(void 0===e)return ie("GRPC error has no .code"),is.UNKNOWN;switch(e){case g.OK:return is.OK;case g.CANCELLED:return is.CANCELLED;case g.UNKNOWN:return is.UNKNOWN;case g.DEADLINE_EXCEEDED:return is.DEADLINE_EXCEEDED;case g.RESOURCE_EXHAUSTED:return is.RESOURCE_EXHAUSTED;case g.INTERNAL:return is.INTERNAL;case g.UNAVAILABLE:return is.UNAVAILABLE;case g.UNAUTHENTICATED:return is.UNAUTHENTICATED;case g.INVALID_ARGUMENT:return is.INVALID_ARGUMENT;case g.NOT_FOUND:return is.NOT_FOUND;case g.ALREADY_EXISTS:return is.ALREADY_EXISTS;case g.PERMISSION_DENIED:return is.PERMISSION_DENIED;case g.FAILED_PRECONDITION:return is.FAILED_PRECONDITION;case g.ABORTED:return is.ABORTED;case g.OUT_OF_RANGE:return is.OUT_OF_RANGE;case g.UNIMPLEMENTED:return is.UNIMPLEMENTED;case g.DATA_LOSS:return is.DATA_LOSS;default:return ii()}}(y=g||(g={}))[y.OK=0]="OK",y[y.CANCELLED=1]="CANCELLED",y[y.UNKNOWN=2]="UNKNOWN",y[y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",y[y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",y[y.NOT_FOUND=5]="NOT_FOUND",y[y.ALREADY_EXISTS=6]="ALREADY_EXISTS",y[y.PERMISSION_DENIED=7]="PERMISSION_DENIED",y[y.UNAUTHENTICATED=16]="UNAUTHENTICATED",y[y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",y[y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",y[y.ABORTED=10]="ABORTED",y[y.OUT_OF_RANGE=11]="OUT_OF_RANGE",y[y.UNIMPLEMENTED=12]="UNIMPLEMENTED",y[y.INTERNAL=13]="INTERNAL",y[y.UNAVAILABLE=14]="UNAVAILABLE",y[y.DATA_LOSS=15]="DATA_LOSS";let ov=new a([0xffffffff,0xffffffff],0);function ow(e){let t=(new TextEncoder).encode(e),r=new o;return r.update(t),new Uint8Array(r.digest())}function ob(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a([r,n],0),new a([i,s],0)]}class oI{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new o_(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new o_(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new o_(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=a.fromNumber(this.Ie)}Ee(e,t,r){let n=e.add(t.multiply(a.fromNumber(r)));return 1===n.compare(ov)&&(n=new a([n.getBits(0),n.getBits(1)],0)),n.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;let[t,r]=ob(ow(e));for(let e=0;e<this.hashCount;e++){let n=this.Ee(t,r,e);if(!this.de(n))return!1}return!0}static create(e,t,r){let n=new oI(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.Ie)return;let[t,r]=ob(ow(e));for(let e=0;e<this.hashCount;e++){let n=this.Ee(t,r,e);this.Ae(n)}}Ae(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class o_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class oE{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,oT.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new oE(iI.min(),n,new sb(iv),aj,aH())}}class oT{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new oT(r,t,aH(),aH(),aH())}}class oS{constructor(e,t,r,n){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=n}}class ox{constructor(e,t){this.targetId=e,this.me=t}}class oC{constructor(e,t,r=sA.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class oA{constructor(){this.fe=0,this.ge=oD(),this.pe=sA.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=aH(),t=aH(),r=aH();return this.ge.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:ii()}}),new oT(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=oD()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,this.fe>=0||ii()}Ne(){this.we=!0,this.ye=!0}}class ok{constructor(e){this.Le=e,this.Be=new Map,this.ke=aj,this.qe=oN(),this.Qe=new sb(iv)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:ii()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,r)=>{this.ze(r)&&t(r)})}He(e){let t=e.targetId,r=e.me.count,n=this.Je(t);if(n){let i=n.target;if(aI(i)){if(0===r){let e=new ix(i.path);this.Ue(t,e,s3.newNoDocument(e,iI.min()))}else 1===r||ii()}else{let n=this.Ye(t);if(n!==r){let r=this.Ze(e),i=r?this.Xe(r,e,n):1;0!==i&&(this.je(t),this.Qe=this.Qe.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){let t,r;let n=e.me.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=sO(i).toUint8Array()}catch(e){if(e instanceof sC)return it("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new oI(t,s,a)}catch(e){return it(e instanceof o_?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.Ie?null:r}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,r,null),n++)}),n}rt(e){let t=new Map;this.Be.forEach((r,n)=>{let i=this.Je(n);if(i){if(r.current&&aI(i.target)){let t=new ix(i.target.path);null!==this.ke.get(t)||this.it(n,t)||this.Ue(n,t,s3.newNoDocument(t,e))}r.be&&(t.set(n,r.ve()),r.Ce())}});let r=aH();this.qe.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.ke.forEach((t,r)=>r.setReadTime(e));let n=new oE(e,t,this.Qe,this.ke,r);return this.ke=aj,this.qe=oN(),this.Qe=new sb(iv),n}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let n=this.Ge(e);this.it(e,t)?n.Fe(t,1):n.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new oA,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new sE(iv),this.qe=this.qe.insert(e,t)),t}ze(e){let t=null!==this.Je(e);return t||n9("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new oA),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function oN(){return new sb(ix.comparator)}function oD(){return new sb(ix.comparator)}let oO={asc:"ASCENDING",desc:"DESCENDING"},oR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oP={and:"AND",or:"OR"};class oL{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function oM(e,t){return e.useProto3Json||null==t?t:{value:t}}function oV(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function oU(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function oF(e){return e||ii(),iI.fromTimestamp(function(e){let t=sN(e);return new ib(t.seconds,t.nanos)}(e))}function oj(e,t){return oB(e,t).canonicalString()}function oB(e,t){let r=new iE(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function oq(e){let t=iE.fromString(e);return o6(t)||ii(),t}function oz(e,t){return oj(e.databaseId,t.path)}function oK(e,t){let r=oq(t);if(r.get(1)!==e.databaseId.projectId)throw new ia(is.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new ia(is.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new ix(oW(r))}function o$(e,t){return oj(e.databaseId,t)}function oG(e){let t=oq(e);return 4===t.length?iE.emptyPath():oW(t)}function oH(e){return new iE(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function oW(e){return e.length>4&&"documents"===e.get(4)||ii(),e.popFirst(5)}function oQ(e,t,r){return{name:oz(e,t),fields:r.value.mapValue.fields}}function oJ(e,t,r){let n=oK(e,t.name),i=oF(t.updateTime),s=t.createTime?oF(t.createTime):iI.min(),a=new s4({mapValue:{fields:t.fields}}),o=s3.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function oY(e,t){var r;let n;if(t instanceof oa)n={update:oQ(e,t.key,t.value)};else if(t instanceof oc)n={delete:oz(e,t.key)};else if(t instanceof oo)n={update:oQ(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof od))return ii();n={verify:oz(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof a0)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof a1)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof a5)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof a4)return{fieldPath:t.field.canonicalString(),increment:r.Pe};throw ii()})(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:oV(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:ii()),n}function oX(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?oe.updateTime(oF(r.updateTime)):void 0!==r.exists?oe.exists(r.exists):oe.none():oe.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?("REQUEST_TIME"===t.setToServerValue||ii(),r=new a0):"appendMissingElements"in t?r=new a1(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new a5(t.removeAllFromArray.values||[]):"increment"in t?r=new a4(e,t.increment):ii(),new a7(iS.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=oK(e,t.update.name),s=new s4({mapValue:{fields:t.update.fields}});return t.updateMask?new oo(r,s,new sx((t.updateMask.fieldPaths||[]).map(e=>iS.fromServerFormat(e))),n,i):new oa(r,s,n,i)}return t.delete?new oc(oK(e,t.delete),n):t.verify?new od(oK(e,t.verify),n):ii()}function oZ(e,t){return{documents:[o$(e,t.path)]}}function o0(e,t){var r,n;let i;let s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=o$(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof ar?function(e){if("=="===e.op){if(sY(e.value))return{unaryFilter:{field:o2(e.field),op:"IS_NAN"}};if(sJ(e.value))return{unaryFilter:{field:o2(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(sY(e.value))return{unaryFilter:{field:o2(e.field),op:"IS_NOT_NAN"}};if(sJ(e.value))return{unaryFilter:{field:o2(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:o2(e.field),op:oR[e.op],value:e.value}}}(t):t instanceof an?function(t){let r=t.getFilters().map(t=>e(t));return 1===r.length?r[0]:{compositeFilter:{op:oP[t.op],filters:r}}}(t):ii()}(an.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:o2(e.field),direction:oO[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=oM(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{_t:s,parent:i}}function o1(e){var t;let r,n=oG(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){1===s||ii();let e=i.from[0];e.allDescendants?a=e.collectionId:n=n.child(e.collectionId)}let o=[];i.where&&(o=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=o5(e.unaryFilter.field);return ar.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=o5(e.unaryFilter.field);return ar.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=o5(e.unaryFilter.field);return ar.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=o5(e.unaryFilter.field);return ar.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ii()}}(t):void 0!==t.fieldFilter?ar.create(o5(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ii()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?an.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ii()}}(t.compositeFilter.op)):ii()}(e);return t instanceof an&&aa(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new ae(o5(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=null==(r="object"==typeof(t=i.limit)?t.value:t)?null:r);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new s8(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new s8(e.values||[],t)}(i.endAt)),new aS(n,a,l,o,u,"F",h,c)}function o2(e){return{fieldPath:e.canonicalString()}}function o5(e){return iS.fromServerFormat(e.fieldPath)}function o6(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class o4{constructor(e,t,r,n,i=iI.min(),s=iI.min(),a=sA.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new o4(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new o4(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new o4(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new o4(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class o3{constructor(e){this.ct=e}}function o8(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:o7(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:oz(i=e.ct,t.key),fields:t.data.value.mapValue.fields,updateTime:oV(i,t.version.toTimestamp()),createTime:oV(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:o9(t.version)};else{if(!t.isUnknownDocument())return ii();n.unknownDocument={path:r.path.toArray(),version:o9(t.version)}}return n}function o7(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function o9(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function le(e){let t=new ib(e.seconds,e.nanoseconds);return iI.fromTimestamp(t)}function lt(e,t){let r=(t.baseMutations||[]).map(t=>oX(e.ct,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let n=t.mutations[e+1];r.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let n=t.mutations.map(t=>oX(e.ct,t)),i=ib.fromMillis(t.localWriteTimeMs);return new of(t.batchId,i,r,n)}function lr(e){var t;let r=le(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?le(e.lastLimboFreeSnapshotVersion):iI.min();return new o4(void 0!==e.query.documents?(1===(t=e.query).documents.length||ii(),aN(ax(oG(t.documents[0])))):aN(o1(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,sA.fromBase64String(e.resumeToken))}function ln(e,t){let r;let n=o9(t.snapshotVersion),i=o9(t.lastLimboFreeSnapshotVersion);r=aI(t.target)?oZ(e.ct,t.target):o0(e.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:aw(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function li(e){let t=o1({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?aO(t,t.limit,"L"):t}function ls(e,t){return new om(t.largestBatchId,oX(e.ct,t.overlayMutation))}function la(e,t){let r=t.path.lastSegment();return[e,i2(t.path.popLast()),r]}function lo(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:o9(n.readTime),documentKey:i2(n.documentKey.path),largestBatchId:n.largestBatchId}}class ll{getBundleMetadata(e,t){return lu(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:le(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return lu(e).put({bundleId:t.id,createTime:o9(oF(t.createTime)),version:t.version})}getNamedQuery(e,t){return lh(e).get(t).next(e=>{if(e)return{name:e.name,query:li(e.bundledQuery),readTime:le(e.readTime)}})}saveNamedQuery(e,t){return lh(e).put({name:t.name,readTime:o9(oF(t.readTime)),bundledQuery:t.bundledQuery})}}function lu(e){return sg(e,"bundles")}function lh(e){return sg(e,"namedQueries")}class lc{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new lc(e,t.uid||"")}getOverlay(e,t){return ld(e).get(la(this.userId,t)).next(e=>e?ls(this.serializer,e):null)}getOverlays(e,t){let r=aK();return iF.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new om(t,i);n.push(this.ht(e,s))}),iF.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(i2(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(ld(e).j("collectionPathOverlayIndex",n))}),iF.waitFor(i)}getOverlaysForCollection(e,t,r){let n=aK(),i=i2(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ld(e).U("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=ls(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i;let s=aK(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ld(e).J({index:"collectionGroupOverlayIndex",range:a},(e,t,r)=>{let a=ls(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}ht(e,t){return ld(e).put(function(e,t,r){let[n,i,s]=la(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:oY(e.ct,r.mutation)}}(this.serializer,this.userId,t))}}function ld(e){return sg(e,"documentOverlays")}class lf{Pt(e){return sg(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?sA.fromUint8Array(t):sA.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class lp{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(sD(e.integerValue));else if("doubleValue"in e){let r=sD(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),i0(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),"string"==typeof r&&(r=sN(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(sO(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?s1(e)?this.dt(t,Number.MAX_SAFE_INTEGER):sZ(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):ii()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};for(let e of(this.dt(t,55),Object.keys(r)))this.Vt(e,t),this.Tt(r[e],t)}wt(e,t){var r,n;let i=e.fields||{};this.dt(t,53);let s="value",a=(null===(n=null===(r=i[s].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.length)||0;this.dt(t,15),t.At(sD(a)),this.Vt(s,t),this.Tt(i[s],t)}bt(e,t){let r=e.values||[];for(let e of(this.dt(t,50),r))this.Tt(e,t)}yt(e,t){this.dt(t,37),ix.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function lm(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}lp.vt=new lp;class lg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ft(e);else if(e<2048)this.Ft(960|e>>>6),this.Ft(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e);else{let e=t.codePointAt(0);this.Ft(240|e>>>18),this.Ft(128|63&e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e)}}this.Mt()}Bt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ot(e);else if(e<2048)this.Ot(960|e>>>6),this.Ot(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e);else{let e=t.codePointAt(0);this.Ot(240|e>>>18),this.Ot(128|63&e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e)}}this.Nt()}kt(e){let t=this.qt(e),r=lm(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Kt(e){let t=this.qt(e),r=lm(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=r?255:0;return t}Ft(e){let t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class ly{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class lv{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class lw{constructor(){this.jt=new lg,this.Ht=new ly(this.jt),this.Jt=new lv(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class lb{constructor(e,t,r,n){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=n}Zt(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new lb(this.indexId,this.documentKey,this.arrayValue,r)}}function lI(e,t){let r=e.indexId-t.indexId;return 0!==r?r:0!==(r=l_(e.arrayValue,t.arrayValue))?r:0!==(r=l_(e.directionalValue,t.directionalValue))?r:ix.comparator(e.documentKey,t.documentKey)}function l_(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}class lE{constructor(e){for(let t of(this.Xt=new sE((e,t)=>iS.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[],e.filters))t.isInequality()?this.Xt=this.Xt.add(t):this.tn.push(t)}get nn(){return this.Xt.size>1}rn(e){if(e.collectionGroup===this.collectionId||ii(),this.nn)return!1;let t=iA(e);if(void 0!==t&&!this.sn(t))return!1;let r=ik(e),n=new Set,i=0,s=0;for(;i<r.length&&this.sn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){let e=this.Xt.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.on(e,t)||!this._n(this.en[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.en.length||!this._n(this.en[s++],e))return!1}return!0}an(){if(this.nn)return null;let e=new sE(iS.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField()){if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new iN(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new iN(r.field,0))}}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new iN(r.field,"asc"===r.dir?0:1)));return new iC(iC.UNKNOWN_ID,this.collectionId,t,iD.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function lT(e){return e instanceof ar}function lS(e){return e instanceof an&&aa(e)}function lx(e){return lT(e)||lS(e)||function(e){if(e instanceof an&&as(e)){for(let t of e.getFilters())if(!lT(t)&&!lS(t))return!1;return!0}return!1}(e)}function lC(e,t){return e instanceof ar||e instanceof an||ii(),t instanceof ar||t instanceof an||ii(),lk(e instanceof ar?t instanceof ar?an.create([e,t],"and"):lA(e,t):t instanceof ar?lA(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||ii(),ai(e)&&ai(t))return al(e,t.getFilters());let r=as(e)?e:t,n=as(e)?t:e,i=r.filters.map(e=>lC(e,n));return an.create(i,"or")}(e,t))}function lA(e,t){if(ai(t))return al(t,e.getFilters());{let r=t.filters.map(t=>lC(e,t));return an.create(r,"or")}}function lk(e){if(e instanceof ar||e instanceof an||ii(),e instanceof ar)return e;let t=e.getFilters();if(1===t.length)return lk(t[0]);if(ao(e))return e;let r=t.map(e=>lk(e)),n=[];return r.forEach(t=>{t instanceof ar?n.push(t):t instanceof an&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:an.create(n,e.op)}class lN{constructor(){this.un=new lD}addToCollectionParentIndex(e,t){return this.un.add(t),iF.resolve()}getCollectionParents(e,t){return iF.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return iF.resolve()}deleteFieldIndex(e,t){return iF.resolve()}deleteAllFieldIndexes(e){return iF.resolve()}createTargetIndexes(e,t){return iF.resolve()}getDocumentsMatchingTarget(e,t){return iF.resolve(null)}getIndexType(e,t){return iF.resolve(0)}getFieldIndexes(e,t){return iF.resolve([])}getNextCollectionGroupToUpdate(e){return iF.resolve(null)}getMinOffset(e,t){return iF.resolve(iP.min())}getMinOffsetFromCollectionGroup(e,t){return iF.resolve(iP.min())}updateCollectionGroup(e,t,r){return iF.resolve()}updateIndexEntries(e,t){return iF.resolve()}}class lD{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new sE(iE.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new sE(iE.comparator)).toArray()}}let lO=new Uint8Array(0);class lR{constructor(e,t){this.databaseId=t,this.cn=new lD,this.ln=new aF(e=>aw(e),(e,t)=>ab(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let i={collectionId:r,parent:i2(n)};return lP(e).put(i)}return iF.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return lP(e).U(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(i5(n.parent))}return r})}addFieldIndex(e,t){let r=lM(e),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=lV(e);return i.next(e=>{r.put(lo(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=lM(e),n=lV(e),i=lL(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=lM(e),r=lL(e),n=lV(e);return t.j().next(()=>r.j()).next(()=>n.j())}createTargetIndexes(e,t){return iF.forEach(this.hn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new lE(t).an();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=lL(e),n=!0,i=new Map;return iF.forEach(this.hn(t),t=>this.Pn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=aH(),n=[];return iF.forEach(i,(i,s)=>{n9("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${aw(t)}`);let a=function(e,t){let r=iA(t);if(void 0===r)return null;for(let t of a_(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of ik(t))for(let t of a_(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of ik(t)){let t=0===i.kind?aE(e,i.fieldPath,e.startAt):aT(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new s8(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of ik(t)){let t=0===i.kind?aT(e,i.fieldPath,e.endAt):aE(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new s8(r,n)}(s,i),h=this.In(i,s,l),c=this.In(i,s,u),d=this.Tn(i,s,o),f=this.En(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return iF.forEach(f,i=>r.G(i,t.limit).next(t=>{t.forEach(t=>{let r=ix.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return iF.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof ar||t instanceof an||ii(),t instanceof ar)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=an.create(r,t.op);return lx(n=lk(n))?n:(n instanceof an||ii(),ai(n)||ii(),n.filters.length>1||ii(),n.filters.reduce((e,t)=>lC(e,t)))}(function e(t){var r,n;if(t instanceof ar||t instanceof an||ii(),t instanceof ar){if(t instanceof ap){let e=(null===(n=null===(r=t.value.arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.map(e=>ar.create(t.field,"==",e)))||[];return an.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return an.create(i,t.op)}(e));return lx(t)||ii(),lT(t)||lS(t)?[t]:t.getFilters()})(an.create(e.filters,"and")).map(t=>av(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t)),t}En(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.dn(t[h/l]):lO,c=this.An(e,o,r[h%l],n),d=this.Rn(e,o,i[h%l],s),f=a.map(t=>this.An(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}An(e,t,r,n){let i=new lb(e,ix.empty(),t,r);return n?i:i.Zt()}Rn(e,t,r,n){let i=new lb(e,ix.empty(),t,r);return n?i.Zt():i}Pn(e,t){let r=new lE(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.rn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.hn(t);return iF.forEach(n,t=>this.Pn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new sE(iS.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(r?1:0)}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}Vn(e,t){let r=new lw;for(let n of ik(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.Yt(n.kind);lp.vt.It(e,i)}return r.zt()}dn(e){let t=new lw;return lp.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new lw;return lp.vt.It(sH(this.databaseId,t),r.Yt(function(e){let t=ik(e);return 0===t.length?0:t[t.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(null===r)return[];let n=[];n.push(new lw);let i=0;for(let s of ik(e)){let e=r[i++];for(let r of n)if(this.fn(t,s.fieldPath)&&sQ(e))n=this.gn(n,s,e);else{let t=r.Yt(s.kind);lp.vt.It(e,t)}}return this.pn(n)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new lw;n.seed(r.zt()),lp.vt.It(e,n.Yt(t.kind)),i.push(n)}return i}fn(e,t){return!!e.filters.find(e=>e instanceof ar&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=lM(e),n=lV(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(e=>{let t=[];return iF.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(function(e,t){let r=t?new iD(t.sequenceNumber,new iP(le(t.readTime),new ix(i5(t.documentKey)),t.largestBatchId)):iD.empty(),n=e.fields.map(([e,t])=>new iN(iS.fromServerFormat(e),t));return new iC(e.indexId,e.collectionGroup,n,r)}(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:iv(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=lM(e),i=lV(e);return this.yn(e).next(e=>n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>iF.forEach(t,t=>i.put(lo(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return iF.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?iF.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),iF.forEach(i,r=>this.wn(e,t,r).next(t=>{let i=this.Sn(n,r);return t.isEqual(i)?iF.resolve():this.bn(e,n,r,t,i)}))))})}Dn(e,t,r,n){return lL(e).put({indexId:n.indexId,uid:this.uid,arrayValue:n.arrayValue,directionalValue:n.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,n){return lL(e).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let n=lL(e),i=new sE(lI);return n.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(e,n)=>{i=i.add(new lb(r.indexId,t,n.arrayValue,n.directionalValue))}).next(()=>i)}Sn(e,t){let r=new sE(lI),n=this.Vn(t,e);if(null==n)return r;let i=iA(t);if(null!=i){let s=e.data.field(i.fieldPath);if(sQ(s))for(let i of s.arrayValue.values||[])r=r.add(new lb(t.indexId,e.key,this.dn(i),n))}else r=r.add(new lb(t.indexId,e.key,lO,n));return r}bn(e,t,r,n,i){n9("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=sS(s),l=sS(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=sS(a)):t?(i(o),o=sS(s)):(o=sS(s),l=sS(a))}}(n,i,lI,n=>{s.push(this.Dn(e,t,r,n))},n=>{s.push(this.vn(e,t,r,n))}),iF.waitFor(s)}yn(e){let t=1;return lV(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>lI(e,t)).filter((e,t,r)=>!t||0!==lI(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=lI(i,e),s=lI(i,t);if(0===r)n[0]=e.Zt();else if(r>0&&s<0)n.push(i),n.push(i.Zt());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Cn(n[e],n[e+1]))return[];let t=[n[e].indexId,this.uid,n[e].arrayValue,n[e].directionalValue,lO,[]],r=[n[e+1].indexId,this.uid,n[e+1].arrayValue,n[e+1].directionalValue,lO,[]];i.push(IDBKeyRange.bound(t,r))}return i}Cn(e,t){return lI(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lU)}getMinOffset(e,t){return iF.mapArray(this.hn(t),t=>this.Pn(e,t).next(e=>e||ii())).next(lU)}}function lP(e){return sg(e,"collectionParents")}function lL(e){return sg(e,"indexEntries")}function lM(e){return sg(e,"indexConfiguration")}function lV(e){return sg(e,"indexState")}function lU(e){0!==e.length||ii();let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>iL(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new iP(t.readTime,t.documentKey,r)}let lF={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class lj{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new lj(e,lj.DEFAULT_COLLECTION_PERCENTILE,lj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function lB(e,t,r){let n=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.J({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{1===o||ii()}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,i2(h),c]);s.push(i.delete(n)),u.push(e.key)}return iF.waitFor(s).next(()=>u)}function lq(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw ii();t=e.noDocument}return JSON.stringify(t).length}lj.DEFAULT_COLLECTION_PERCENTILE=10,lj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lj.DEFAULT=new lj(0x2800000,lj.DEFAULT_COLLECTION_PERCENTILE,lj.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lj.DISABLED=new lj(-1,0,0);class lz{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Fn={}}static lt(e,t,r,n){return""!==e.uid||ii(),new lz(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return l$(e).J({index:"userMutationsIndex",range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=lG(e),s=l$(e);return s.add({}).next(a=>{"number"==typeof a||ii();let o=new of(a,t,r,n),l=function(e,t,r){let n=r.baseMutations.map(t=>oY(e.ct,t)),i=r.mutations.map(t=>oY(e.ct,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}(this.serializer,this.userId,o),u=[],h=new sE((e,t)=>iv(e.canonicalString(),t.canonicalString()));for(let e of n){let t=[this.userId,i2(e.key.path),a];h=h.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,i4))}return h.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Fn[a]=o.keys()}),iF.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return l$(e).get(t).next(e=>e?(e.userId===this.userId||ii(),lt(this.serializer,e)):null)}Mn(e,t){return this.Fn[t]?iF.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Fn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return l$(e).J({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(t.batchId>=r||ii(),i=lt(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return l$(e).J({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return l$(e).U("userMutationsIndex",t).next(e=>e.map(e=>lt(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,i2(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return lG(e).J({range:n},(r,n,s)=>{let[a,o,l]=r,u=i5(o);if(a===this.userId&&t.path.isEqual(u))return l$(e).get(l).next(e=>{if(!e)throw ii();e.userId===this.userId||ii(),i.push(lt(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sE(iv),n=[];return t.forEach(t=>{let i=[this.userId,i2(t.path)],s=IDBKeyRange.lowerBound(i),a=lG(e).J({range:s},(e,n,i)=>{let[s,a,o]=e,l=i5(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),iF.waitFor(n).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,i2(r)],s=IDBKeyRange.lowerBound(i),a=new sE(iv);return lG(e).J({range:s},(e,t,i)=>{let[s,o,l]=e,u=i5(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.xn(e,a))}xn(e,t){let r=[],n=[];return t.forEach(t=>{n.push(l$(e).get(t).next(e=>{if(null===e)throw ii();e.userId===this.userId||ii(),r.push(lt(this.serializer,e))}))}),iF.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return lB(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),iF.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return iF.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return lG(e).J({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=i5(e[1]);n.push(t)}else r.done()}).next(()=>{0===n.length||ii()})})}containsKey(e,t){return lK(e,this.userId,t)}Nn(e){return lH(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function lK(e,t,r){let n=[t,i2(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return lG(e).J({range:s,H:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function l$(e){return sg(e,"mutations")}function lG(e){return sg(e,"documentMutations")}function lH(e){return sg(e,"mutationQueues")}class lW{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new lW(0)}static kn(){return new lW(-1)}}class lQ{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new lW(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(e=>iI.fromTimestamp(new ib(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.Qn(e,n)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>lJ(e).delete(t.targetId)).next(()=>this.qn(e)).next(t=>(t.targetCount>0||ii(),t.targetCount-=1,this.Qn(e,t)))}removeTargets(e,t,r){let n=0,i=[];return lJ(e).J((s,a)=>{let o=lr(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>iF.waitFor(i)).next(()=>n)}forEachTarget(e,t){return lJ(e).J((e,r)=>{t(lr(r))})}qn(e){return lY(e).get("targetGlobalKey").next(e=>(null!==e||ii(),e))}Qn(e,t){return lY(e).put("targetGlobalKey",t)}Kn(e,t){return lJ(e).put(ln(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(e=>e.targetCount)}getTargetData(e,t){let r=aw(t),n=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return lJ(e).J({range:n,index:"queryTargetsIndex"},(e,r,n)=>{let s=lr(r);ab(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=lX(e);return t.forEach(t=>{let s=i2(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),iF.waitFor(n)}removeMatchingKeys(e,t,r){let n=lX(e);return iF.forEach(t,t=>{let i=i2(t.path);return iF.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=lX(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=lX(e),i=aH();return n.J({range:r,H:!0},(e,t,r)=>{let n=new ix(i5(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=i2(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return lX(e).J({index:"documentTargetsIndex",H:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}ot(e,t){return lJ(e).get(t).next(e=>e?lr(e):null)}}function lJ(e){return sg(e,"targets")}function lY(e){return sg(e,"targetGlobal")}function lX(e){return sg(e,"targetDocuments")}function lZ([e,t],[r,n]){let i=iv(e,r);return 0===i?iv(t,n):i}class l0{constructor(e){this.Un=e,this.buffer=new sE(lZ),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>lZ(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class l1{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){n9("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){i$(e)?n9("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await iU(e)}await this.Hn(3e5)})}}class l2{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return iF.resolve(iX.oe);let r=new l0(t);return this.Jn.forEachTarget(e,e=>r.zn(e.sequenceNumber)).next(()=>this.Jn.Zn(e,e=>r.zn(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(n9("LruGarbageCollector","Garbage collection skipped; disabled"),iF.resolve(lF)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(n9("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lF):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,n,i,a,o,l,u;let h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(n9("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,a=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(u=Date.now(),n7()<=s.DEBUG&&n9("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${n} in `+(o-a)+"ms\n"+`	Removed ${i} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),iF.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class l5{constructor(e,t){this.db=e,this.garbageCollector=new l2(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}er(e){let t=0;return this.Zn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(e,r)=>t(r))}addReference(e,t,r){return l6(e,r)}removeReference(e,t,r){return l6(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return l6(e,t)}nr(e,t){let r;return r=!1,lH(e).Y(n=>lK(e,n,t).next(e=>(e&&(r=!0),iF.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.tr(e,(s,a)=>{if(a<=t){let t=this.nr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,iI.min()),lX(e).delete([0,i2(s.path)])))});n.push(t)}}).next(()=>iF.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return l6(e,t)}tr(e,t){let r=lX(e),n,i=iX.oe;return r.J({index:"documentTargetsIndex"},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==iX.oe&&t(new ix(i5(n)),i),i=a,n=s):i=iX.oe}).next(()=>{i!==iX.oe&&t(new ix(i5(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function l6(e,t){var r;return lX(e).put((r=e.currentSequenceNumber,{targetId:0,path:i2(t.path),sequenceNumber:r}))}class l4{constructor(){this.changes=new aF(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,s3.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?iF.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class l3{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return l9(e).put(r)}removeEntry(e,t,r){return l9(e).delete(function(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],o7(t),r[r.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=s3.newInvalidDocument(t);return l9(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ue(t))},(e,n)=>{r=this.ir(t,n)}).next(()=>r)}sr(e,t){let r={size:0,document:s3.newInvalidDocument(t)};return l9(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ue(t))},(e,n)=>{r={document:this.ir(t,n),size:lq(n)}}).next(()=>r)}getEntries(e,t){let r=aj;return this._r(e,t,(e,t)=>{let n=this.ir(e,t);r=r.insert(e,n)}).next(()=>r)}ar(e,t){let r=aj,n=new sb(ix.comparator);return this._r(e,t,(e,t)=>{let i=this.ir(e,t);r=r.insert(e,i),n=n.insert(e,lq(t))}).next(()=>({documents:r,ur:n}))}_r(e,t,r){if(t.isEmpty())return iF.resolve();let n=new sE(ur);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(ue(n.first()),ue(n.last())),s=n.getIterator(),a=s.getNext();return l9(e).J({index:"documentKeyIndex",range:i},(e,t,n)=>{let i=ix.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>ur(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.$(ue(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),o7(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return l9(e).U(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let r=aj;for(let i of e){let e=this.ir(ix.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(aM(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=aj,s=ut(t,r),a=ut(t,iP.max());return l9(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.ir(ix.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new l8(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return l7(e).get("remoteDocumentGlobalKey").next(e=>(e||ii(),e))}rr(e,t){return l7(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let e=function(e,t){let r;if(t.document)r=oJ(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=ix.fromSegments(t.noDocument.path),n=le(t.noDocument.readTime);r=s3.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return ii();{let e=ix.fromSegments(t.unknownDocument.path),n=le(t.unknownDocument.version);r=s3.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime(function(e){let t=new ib(e[0],e[1]);return iI.fromTimestamp(t)}(t.readTime)),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(iI.min())))return e}return s3.newInvalidDocument(e)}}class l8 extends l4{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new aF(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new sE((e,t)=>iv(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=o8(this.cr.serializer,s);n=n.add(i.path.popLast());let l=lq(o);r+=l-a.size,t.push(this.cr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=o8(this.cr.serializer,s.convertToNoDocument(iI.min()));t.push(this.cr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.cr.updateMetadata(e,r)),iF.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(e=>(this.lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:e,ur:t})=>(t.forEach((t,r)=>{this.lr.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function l7(e){return sg(e,"remoteDocumentGlobal")}function l9(e){return sg(e,"remoteDocumentsV14")}function ue(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ut(e,t){let r=t.documentKey.path.toArray();return[e,o7(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function ur(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=iv(r[e],n[e]))return i;return(i=iv(r.length,n.length))||(i=iv(r[r.length-2],n[n.length-2]))||iv(r[r.length-1],n[n.length-1])}class un{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ui{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&oi(r.mutation,e,sx.empty(),ib.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,aH()).next(()=>t))}getLocalViewOfDocuments(e,t,r=aH()){let n=aK();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=aq();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=aK();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,aH()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=aj,s=aK(),a=aK();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof oo)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),oi(a.mutation,t,a.mutation.getFieldMask(),ib.now())):s.set(t.key,sx.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var r;return a.set(e,new un(t,null!==(r=s.get(e))&&void 0!==r?r:null))}),a))}recalculateAndSaveOverlays(e,t){let r=aK(),n=new sb((e,t)=>e-t),i=aH();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||sx.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||aH()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=aK();l.forEach(e=>{if(!i.has(e)){let n=on(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return iF.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return ix.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):aA(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):iF.resolve(aK()),a=-1,o=i;return s.next(t=>iF.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?iF.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,aH())).next(e=>({batchId:a,changes:az(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ix(t)).next(e=>{let t=aq();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=aq();return this.indexManager.getCollectionParents(e,i).next(a=>iF.forEach(a,a=>{let o=new aS(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,s3.newInvalidDocument(n)))});let r=aq();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&oi(s.mutation,n,sx.empty(),ib.now()),aM(t,n)&&(r=r.insert(e,n))}),r})}}class us{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return iF.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:t.id,version:t.version,createTime:oF(t.createTime)}),iF.resolve()}getNamedQuery(e,t){return iF.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:t.name,query:li(t.bundledQuery),readTime:oF(t.readTime)}),iF.resolve()}}class ua{constructor(){this.overlays=new sb(ix.comparator),this.Ir=new Map}getOverlay(e,t){return iF.resolve(this.overlays.get(t))}getOverlays(e,t){let r=aK();return iF.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.ht(e,t,n)}),iF.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Ir.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Ir.delete(r)),iF.resolve()}getOverlaysForCollection(e,t,r){let n=aK(),i=t.length+1,s=new ix(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return iF.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new sb((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=aK(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=aK(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return iF.resolve(a)}ht(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Ir.get(n.largestBatchId).delete(r.key);this.Ir.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new om(t,r));let i=this.Ir.get(t);void 0===i&&(i=aH(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}class uo{constructor(){this.sessionToken=sA.EMPTY_BYTE_STRING}getSessionToken(e){return iF.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,iF.resolve()}}class ul{constructor(){this.Tr=new sE(uu.Er),this.dr=new sE(uu.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new uu(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Vr(new uu(e,t))}mr(e,t){e.forEach(e=>this.removeReference(e,t))}gr(e){let t=new ix(new iE([])),r=new uu(t,e),n=new uu(t,e+1),i=[];return this.dr.forEachInRange([r,n],e=>{this.Vr(e),i.push(e.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new ix(new iE([])),r=new uu(t,e),n=new uu(t,e+1),i=aH();return this.dr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new uu(e,0),r=this.Tr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class uu{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ix.comparator(e.key,t.key)||iv(e.wr,t.wr)}static Ar(e,t){return iv(e.wr,t.wr)||ix.comparator(e.key,t.key)}}class uh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new sE(uu.Er)}checkEmpty(e){return iF.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new of(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.br=this.br.add(new uu(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return iF.resolve(s)}lookupMutationBatch(e,t){return iF.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.vr(t+1),n=r<0?0:r;return iF.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return iF.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return iF.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new uu(t,0),n=new uu(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,n],e=>{let t=this.Dr(e.wr);i.push(t)}),iF.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new sE(iv);return t.forEach(e=>{let t=new uu(e,0),n=new uu(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,n],e=>{r=r.add(e.wr)})}),iF.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;ix.isDocumentKey(i)||(i=i.child(""));let s=new uu(new ix(i),0),a=new sE(iv);return this.br.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.wr)),!0)},s),iF.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(e=>{let r=this.Dr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){0===this.Fr(t.batchId,"removed")||ii(),this.mutationQueue.shift();let r=this.br;return iF.forEach(t.mutations,n=>{let i=new uu(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new uu(t,0),n=this.br.firstAfterOrEqual(r);return iF.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,iF.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class uc{constructor(e){this.Mr=e,this.docs=new sb(ix.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return iF.resolve(r?r.document.mutableCopy():s3.newInvalidDocument(t))}getEntries(e,t){let r=aj;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():s3.newInvalidDocument(e))}),iF.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=aj,s=t.path,a=new ix(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=iL(iR(a),r)||(n.has(a.key)||aM(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return iF.resolve(i)}getAllFromCollectionGroup(e,t,r,n){ii()}Or(e,t){return iF.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ud(this)}getSize(e){return iF.resolve(this.size)}}class ud extends l4{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.cr.addEntry(e,n)):this.cr.removeEntry(r)}),iF.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class uf{constructor(e){this.persistence=e,this.Nr=new aF(e=>aw(e),ab),this.lastRemoteSnapshotVersion=iI.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ul,this.targetCount=0,this.kr=lW.Bn()}forEachTarget(e,t){return this.Nr.forEach((e,r)=>t(r)),iF.resolve()}getLastRemoteSnapshotVersion(e){return iF.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return iF.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),iF.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),iF.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new lW(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,iF.resolve()}updateTargetData(e,t){return this.Kn(t),iF.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,iF.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.Nr.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Nr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),iF.waitFor(i).next(()=>n)}getTargetCount(e){return iF.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return iF.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),iF.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),iF.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),iF.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return iF.resolve(r)}containsKey(e,t){return iF.resolve(this.Br.containsKey(t))}}class up{constructor(e,t){this.qr={},this.overlays={},this.Qr=new iX(0),this.Kr=!1,this.Kr=!0,this.$r=new uo,this.referenceDelegate=e(this),this.Ur=new uf(this),this.indexManager=new lN,this.remoteDocumentCache=new uc(e=>this.referenceDelegate.Wr(e)),this.serializer=new o3(t),this.Gr=new us(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ua,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new uh(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){n9("MemoryPersistence","Starting transaction:",e);let n=new um(this.Qr.next());return this.referenceDelegate.zr(),r(n).next(e=>this.referenceDelegate.jr(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Hr(e,t){return iF.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class um extends iV{constructor(e){super(),this.currentSequenceNumber=e}}class ug{constructor(e){this.persistence=e,this.Jr=new ul,this.Yr=null}static Zr(e){return new ug(e)}get Xr(){if(this.Yr)return this.Yr;throw ii()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),iF.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),iF.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),iF.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(e=>this.Xr.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Xr.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return iF.forEach(this.Xr,r=>{let n=ix.fromPath(r);return this.ei(e,n).next(e=>{e||t.removeEntry(n,iI.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return iF.or([()=>iF.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class uy{constructor(e,t){this.persistence=e,this.ti=new aF(e=>i2(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new l2(this,t)}static Zr(e,t){return new uy(e,t)}zr(){}jr(e){return iF.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){let t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}er(e){let t=0;return this.Zn(e,e=>{t++}).next(()=>t)}Zn(e,t){return iF.forEach(this.ti,(r,n)=>this.nr(e,r,n).next(e=>e?iF.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.Or(e,n=>this.nr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,iI.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),iF.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),iF.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),iF.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),iF.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(sj(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=sP(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return sO(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,sv(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw ii()}}(e.data.value)),t}nr(e,t,r){return iF.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.ti.get(t);return iF.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class uv{constructor(e){this.serializer=e}O(e,t,r,n){let i=new ij("createOrUpgrade",t);r<1&&n>=1&&(!function(e){e.createObjectStore("owner")}(e),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",i6,{unique:!0}),e.createObjectStore("documentMutations"),uw(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=iF.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),uw(e)),s=s.next(()=>(function(e){let t=e.store("targetGlobal"),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:iI.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",r)})(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store("mutations").U().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",i6,{unique:!0});let r=i.store("mutations"),n=t.map(e=>r.put(e));return iF.waitFor(n)}))),s=s.next(()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&n>=5&&(s=s.next(()=>this.ni(i))),r<6&&n>=6&&(s=s.next(()=>((function(e){e.createObjectStore("remoteDocumentGlobal")})(e),this.ri(i)))),r<7&&n>=7&&(s=s.next(()=>this.ii(i))),r<8&&n>=8&&(s=s.next(()=>this.si(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.oi(i))),r<11&&n>=11&&(s=s.next(()=>{(function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&n>=12&&(s=s.next(()=>{!function(e){let t=e.createObjectStore("documentOverlays",{keyPath:so});t.createIndex("collectionPathOverlayIndex",sl,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",su,{unique:!1})}(e)})),r<13&&n>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore("remoteDocumentsV14",{keyPath:i3});t.createIndex("documentKeyIndex",i8),t.createIndex("collectionGroupIndex",i7)})(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&n>=14&&(s=s.next(()=>this.ai(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:sn}).createIndex("sequenceNumberIndex",si,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ss}).createIndex("documentKeyIndex",sa,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&n>=17&&(s=s.next(()=>{!function(e){e.createObjectStore("globals",{keyPath:"name"})}(e)})),s}ri(e){let t=0;return e.store("remoteDocuments").J((e,r)=>{t+=lq(r)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(t=>iF.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",n).next(r=>iF.forEach(r,r=>{r.userId===t.userId||ii();let n=lt(this.serializer,r);return lB(e,t.userId,n).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let n=[];return r.J((r,i)=>{let s=new iE(r),a=[0,i2(s)];n.push(t.get(a).next(r=>r?iF.resolve():t.put({targetId:0,path:i2(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>iF.waitFor(n))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:sr});let r=t.store("collectionParents"),n=new lD,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:i2(n)})}};return t.store("remoteDocuments").J({H:!0},(e,t)=>i(new iE(e).popLast())).next(()=>t.store("documentMutations").J({H:!0},([e,t,r],n)=>i(i5(t).popLast())))}oi(e){let t=e.store("targets");return t.J((e,r)=>{let n=lr(r),i=ln(this.serializer,n);return t.put(i)})}_i(e,t){let r=t.store("remoteDocuments"),n=[];return r.J((e,r)=>{let i=t.store("remoteDocumentsV14"),s=(r.document?new ix(iE.fromString(r.document.name).popFirst(5)):r.noDocument?ix.fromSegments(r.noDocument.path):r.unknownDocument?ix.fromSegments(r.unknownDocument.path):ii()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>iF.waitFor(n))}ai(e,t){let r=t.store("mutations"),n=new l3(this.serializer),i=new up(ug.Zr,this.serializer.ct);return r.U().next(e=>{let r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:aH();lt(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),iF.forEach(r,(e,r)=>{let s=new n4(r),a=lc.lt(this.serializer,s),o=i.getIndexManager(s);return new ui(n,lz.lt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new sm(t,iX.oe),e).next()})})}}function uw(e){e.createObjectStore("targetDocuments",{keyPath:se}).createIndex("documentTargetsIndex",st,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",i9,{unique:!0}),e.createObjectStore("targetGlobal")}let ub="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class uI{constructor(e,t,r,n,i,s,a,o,l,u,h=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=s,this.document=a,this.ci=l,this.li=u,this.hi=h,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=e=>Promise.resolve(),!uI.D())throw new ia(is.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new l5(this,n),this.Ai=t+"main",this.serializer=new o3(o),this.Ri=new iB(this.Ai,this.hi,new uv(this.serializer)),this.$r=new lf,this.Ur=new lQ(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new l3(this.serializer),this.Gr=new ll,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===u&&ie("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ia(is.FAILED_PRECONDITION,ub);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new iX(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>uE(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(i$(e))return n9("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return n9("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return u_(e).get("owner").next(e=>iF.resolve(this.vi(e)))}Ci(e){return uE(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=sg(e,"clientMetadata");return t.U().next(e=>{let r=this.xi(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return iF.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?iF.resolve(!0):u_(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new ia(is.FAILED_PRECONDITION,ub);return!1}}return!(!this.networkEnabled||!this.inForeground)||uE(e).U().next(e=>void 0===this.xi(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&n9("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new sm(e,iX.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(e=>this.Mi(e.updateTimeMs,t)&&!this.Ni(e.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>uE(e).U().next(e=>this.xi(e,18e5).map(e=>e.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return lz.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new lR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return lc.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){var n;let i;n9("IndexedDbPersistence","Starting transaction:",e);let s=17===(n=this.hi)?sp:16===n?sf:15===n?sf:14===n?sd:13===n?sd:12===n?sc:11===n?sh:void ii();return this.Ri.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new sm(n,this.Qr?this.Qr.next():iX.oe),"readwrite-primary"===t?this.wi(i).next(e=>!!e||this.Si(i)).next(t=>{if(!t)throw ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new ia(is.FAILED_PRECONDITION,iM);return r(i)}).next(e=>this.Di(i).next(()=>e)):this.Ki(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ki(e){return u_(e).get("owner").next(e=>{if(null!==e&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new ia(is.FAILED_PRECONDITION,ub)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return u_(e).put("owner",t)}static D(){return iB.D()}bi(e){let t=u_(e);return t.get("owner").next(e=>this.vi(e)?(n9("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):iF.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ie(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();let e=/(?:Version|Mobile)\/1[456]/;j()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return n9("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(e){return ie("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){ie("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch(e){}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function u_(e){return sg(e,"owner")}function uE(e){return sg(e,"clientMetadata")}function uT(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class uS{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=n}static Wi(e,t){let r=aH(),n=aH();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new uS(e,t.fromCache,r,n)}}class ux{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class uC{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=j()?8:iq(F())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.Yi(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Zi(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new ux;return this.Xi(e,t,r).next(n=>{if(i.result=n,this.zi)return this.es(e,t,r,n.size)})}).next(()=>i.result)}es(e,t,r,n){return r.documentReadCount<this.ji?(n7()<=s.DEBUG&&n9("QueryEngine","SDK will not create cache indexes for query:",aL(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),iF.resolve()):(n7()<=s.DEBUG&&n9("QueryEngine","Query:",aL(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.Hi*n?(n7()<=s.DEBUG&&n9("QueryEngine","The SDK decides to create cache indexes for query:",aL(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,aN(t))):iF.resolve())}Yi(e,t){if(aC(t))return iF.resolve(null);let r=aN(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=aN(t=aO(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=aH(...n);return this.Ji.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.ts(t,n);return this.ns(t,s,i,r.readTime)?this.Yi(e,aO(t,null,"F")):this.rs(e,s,t,r)}))})))}Zi(e,t,r,n){return aC(t)||n.isEqual(iI.min())?iF.resolve(null):this.Ji.getDocuments(e,r).next(i=>{let a=this.ts(t,i);return this.ns(t,a,r,n)?iF.resolve(null):(n7()<=s.DEBUG&&n9("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),aL(t)),this.rs(e,a,t,iO(n,-1)).next(e=>e))})}ts(e,t){let r=new sE(aU(e));return t.forEach((t,n)=>{aM(e,n)&&(r=r.add(n))}),r}ns(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}Xi(e,t,r){return n7()<=s.DEBUG&&n9("QueryEngine","Using full collection scan to execute query:",aL(t)),this.Ji.getDocumentsMatchingQuery(e,t,iP.min(),r)}rs(e,t,r,n){return this.Ji.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class uA{constructor(e,t,r,n){this.persistence=e,this.ss=t,this.serializer=n,this.os=new sb(iv),this._s=new aF(e=>aw(e),ab),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ui(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}async function uk(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.ls(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=aH();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({hs:e,removedBatchIds:i,addedBatchIds:s}))})})}function uN(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function uD(e,t,r){let n=aH(),i=aH();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=aj;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(iI.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):n9("LocalStore","Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Ps:n,Is:i}})}function uO(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.Ur.getTargetData(r,t).next(i=>i?(n=i,iF.resolve(n)):e.Ur.allocateTargetId(r).next(i=>(n=new o4(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.Ur.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.os.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.os=e.os.insert(r.targetId,r),e._s.set(t,r.targetId)),r})}async function uR(e,t,r){let n=e.os.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!i$(e))throw e;n9("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.os=e.os.remove(t),e._s.delete(n.target)}function uP(e,t,r){let n=iI.min(),i=aH();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,r){let n=e._s.get(r);return void 0!==n?iF.resolve(e.os.get(n)):e.Ur.getTargetData(t,r)})(e,s,aN(t)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.Ur.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.ss.getDocumentsMatchingQuery(s,t,r?n:iI.min(),r?i:aH())).next(r=>(uV(e,aV(t),r),{documents:r,Ts:i})))}function uL(e,t){let r=e.Ur,n=e.os.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.ot(e,t).next(e=>e?e.target:null))}function uM(e,t){let r=e.us.get(t)||iI.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.cs.getAllFromCollectionGroup(n,t,iO(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(uV(e,t,r),r))}function uV(e,t,r){let n=e.us.get(t)||iI.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.us.set(t,n)}function uU(e,t){return`firestore_clients_${e}_${t}`}function uF(e,t,r){let n=`firestore_mutations_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function uj(e,t){return`firestore_targets_${e}_${t}`}class uB{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static Rs(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ia(n.error.code,n.error.message)),s?new uB(e,t,n.state,i):(ie("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class uq{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new ia(r.error.code,r.error.message)),i?new uq(e,r.state,n):(ie("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class uz{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=aW;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=i1(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new uz(e,i):(ie("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class uK{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new uK(t.clientId,t.onlineState):(ie("SharedClientState",`Failed to parse online state: ${e}`),null)}}class u${constructor(){this.activeTargetIds=aW}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class uG{constructor(e,t,r,n,i){var s,a,o;this.window=e,this.ui=t,this.persistenceKey=r,this.ps=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new sb(iv),this.started=!1,this.bs=[];let l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=uU(this.persistenceKey,this.ps),this.vs=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.Ss=this.Ss.insert(this.ps,new u$),this.Cs=RegExp(`^firestore_clients_${l}_([^_]*)$`),this.Fs=RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this.Ms=RegExp(`^firestore_targets_${l}_(\\d+)$`),this.xs=(a=this.persistenceKey,`firestore_online_state_${a}`),this.Os=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Qi())){if(e===this.ps)continue;let t=this.getItem(uU(this.persistenceKey,e));if(t){let r=uz.Rs(e,t);r&&(this.Ss=this.Ss.insert(r.clientId,r))}}this.Ns();let e=this.storage.getItem(this.xs);if(e){let t=this.Ls(e);t&&this.Bs(t)}for(let e of this.bs)this.ws(e);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(uj(this.persistenceKey,e));if(t){let n=uq.Rs(e,t);n&&(r=n.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(uj(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.Qs(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return n9("SharedClientState","READ",e,t),t}setItem(e,t){n9("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){n9("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){if(e.storageArea===this.storage){if(n9("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ds)return void ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.Cs.test(e.key)){if(null==e.newValue){let t=this.Gs(e.key);return this.zs(t,null)}{let t=this.js(e.key,e.newValue);if(t)return this.zs(t.clientId,t)}}else if(this.Fs.test(e.key)){if(null!==e.newValue){let t=this.Hs(e.key,e.newValue);if(t)return this.Js(t)}}else if(this.Ms.test(e.key)){if(null!==e.newValue){let t=this.Ys(e.key,e.newValue);if(t)return this.Zs(t)}}else if(e.key===this.xs){if(null!==e.newValue){let t=this.Ls(e.newValue);if(t)return this.Bs(t)}}else if(e.key===this.vs){let t=function(e){let t=iX.oe;if(null!=e)try{let r=JSON.parse(e);"number"==typeof r||ii(),t=r}catch(e){ie("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==iX.oe&&this.sequenceNumberHandler(t)}else if(e.key===this.Os){let t=this.Xs(e.newValue);await Promise.all(t.map(e=>this.syncEngine.eo(e)))}}}else this.bs.push(e)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let n=new uB(this.currentUser,e,t,r),i=uF(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Vs())}Qs(e){let t=uF(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let n=uj(this.persistenceKey,e),i=new uq(e,t,r);this.setItem(n,i.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return uz.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return uB.Rs(new n4(i),n,t)}Ys(e,t){let r=Number(this.Ms.exec(e)[1]);return uq.Rs(r,t)}Ls(e){return uK.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);n9("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),n=this.ks(this.Ss),i=this.ks(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.io(s,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=aW;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class uH{constructor(){this.so=new u$,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new u$,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class uW{_o(e){}shutdown(){}}class uQ{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){for(let e of(n9("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.ho))e(0)}lo(){for(let e of(n9("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.ho))e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let uJ=null;function uY(){return null===uJ?uJ=0x10000000+Math.round(0x80000000*Math.random()):uJ++,"0x"+uJ.toString(16)}let uX={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class uZ{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}let u0="WebChannelConnection";class u1 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${r}/databases/${n}`,this.Co="(default)"===this.databaseId.database?`project_id=${r}`:`project_id=${r}&database_id=${n}`}get Fo(){return!1}Mo(e,t,r,n,i){let s=uY(),a=this.xo(e,t.toUriEncodedString());n9("RestConnection",`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(o,n,i),this.No(e,a,o,r).then(t=>(n9("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw it("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}Lo(e,t,r,n,i,s){return this.Mo(e,t,r,n,i)}Oo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+n3}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}xo(e,t){let r=uX[e];return`${this.Do}/v1/${t}:${r}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,n){let i=uY();return new Promise((s,a)=>{let o=new l;o.setWithCredentials(!0),o.listenOnce(h.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case c.NO_ERROR:let t=o.getResponseJson();n9(u0,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case c.TIMEOUT:n9(u0,`RPC '${e}' ${i} timed out`),a(new ia(is.DEADLINE_EXCEEDED,"Request time out"));break;case c.HTTP_ERROR:let r=o.getStatus();if(n9(u0,`RPC '${e}' ${i} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(is).indexOf(t)>=0?t:is.UNKNOWN}(t.status);a(new ia(e,t.message))}else a(new ia(is.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new ia(is.UNAVAILABLE,"Connection failed."));break;default:ii()}}finally{n9(u0,`RPC '${e}' ${i} completed.`)}});let u=JSON.stringify(n);n9(u0,`RPC '${e}' ${i} sending request:`,n),o.send(t,"POST",u,r,15)})}Bo(e,t,r){let n=uY(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=m(),a=p(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let h=i.join("");n9(u0,`Creating RPC '${e}' stream ${n}: ${h}`,o);let c=s.createWebChannel(h,o),y=!1,v=!1,w=new uZ({Io:t=>{v?n9(u0,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(y||(n9(u0,`Opening RPC '${e}' stream ${n} transport.`),c.open(),y=!0),n9(u0,`RPC '${e}' stream ${n} sending:`,t),c.send(t))},To:()=>c.close()}),b=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(c,u.EventType.OPEN,()=>{v||(n9(u0,`RPC '${e}' stream ${n} transport opened.`),w.yo())}),b(c,u.EventType.CLOSE,()=>{v||(v=!0,n9(u0,`RPC '${e}' stream ${n} transport closed`),w.So())}),b(c,u.EventType.ERROR,t=>{v||(v=!0,it(u0,`RPC '${e}' stream ${n} transport errored:`,t),w.So(new ia(is.UNAVAILABLE,"The operation could not be completed")))}),b(c,u.EventType.MESSAGE,t=>{var r;if(!v){let i=t.data[0];i||ii();let s=i.error||(null===(r=i[0])||void 0===r?void 0:r.error);if(s){n9(u0,`RPC '${e}' stream ${n} received error:`,s);let t=s.status,r=function(e){let t=g[e];if(void 0!==t)return oy(t)}(t),i=s.message;void 0===r&&(r=is.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),v=!0,w.So(new ia(r,i)),c.close()}else n9(u0,`RPC '${e}' stream ${n} received:`,i),w.bo(i)}}),b(a,f.STAT_EVENT,t=>{t.stat===d.PROXY?n9(u0,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===d.NOPROXY&&n9(u0,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{w.wo()},0),w}}function u2(){return"undefined"!=typeof window?window:null}function u5(){return"undefined"!=typeof document?document:null}function u6(e){return new oL(e,!0)}class u4{constructor(e,t,r=1e3,n=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=n,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),n=Math.max(0,t-r);n>0&&n9("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,n,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class u3{constructor(e,t,r,n,i,s,a,o){this.ui=e,this.Ho=r,this.Jo=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new u4(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===is.RESOURCE_EXHAUSTED?(ie(t.toString()),ie("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===is.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.Yo===t&&this.P_(e,r)},t=>{e(()=>{let e=new ia(is.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(e=>{r(()=>this.I_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.e_?this.E_(e):this.onNext(e))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return n9("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(n9("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class u8 extends u3{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:ii(),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||ii(),sA.fromBase64String(i||"")):(void 0===i||i instanceof n5||i instanceof Uint8Array||ii(),sA.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new oC(s,a,o,l&&new ia(void 0===l.code?is.UNKNOWN:oy(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=oK(e,n.document.name),s=oF(n.document.updateTime),a=n.document.createTime?oF(n.document.createTime):iI.min(),o=new s4({mapValue:{fields:n.document.fields}}),l=s3.newFoundDocument(i,s,a,o);r=new oS(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=oK(e,n.document),s=n.readTime?oF(n.readTime):iI.min(),a=s3.newNoDocument(i,s);r=new oS([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=oK(e,n.document);r=new oS([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return ii();{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new og(n,i);r=new ox(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return iI.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?iI.min():t.readTime?oF(t.readTime):iI.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=oH(this.serializer),t.addTarget=function(e,t){let r;let n=t.target;if((r=aI(n)?{documents:oZ(e,n)}:{query:o0(e,n)._t}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=oU(e,t.resumeToken);let n=oM(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(iI.min())>0){r.readTime=oV(e,t.snapshotVersion.toTimestamp());let n=oM(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let r=function(e,t){let r=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ii()}}(t.purpose);return null==r?null:{"goog-listen-tags":r}}(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=oH(this.serializer),t.removeTarget=e,this.a_(t)}}class u7 extends u3{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return e.streamToken||ii(),this.lastStreamToken=e.streamToken,e.writeResults&&0!==e.writeResults.length&&ii(),this.listener.f_()}onNext(e){var t,r;e.streamToken||ii(),this.lastStreamToken=e.streamToken,this.t_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(void 0!==r||ii(),t.map(e=>{let t;return(t=e.updateTime?oF(e.updateTime):oF(r)).isEqual(iI.min())&&(t=oF(r)),new a9(t,e.transformResults||[])})):[]),i=oF(e.commitTime);return this.listener.g_(i,n)}p_(){let e={};e.database=oH(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>oY(this.serializer,e))};this.a_(t)}}class u9 extends class{}{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.y_=!1}w_(){if(this.y_)throw new ia(is.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,n){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Mo(e,oB(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===is.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ia(is.UNKNOWN,e.toString())})}Lo(e,t,r,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Lo(e,oB(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===is.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ia(is.UNKNOWN,e.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class he{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ie(t),this.D_=!1):n9("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class ht{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(e=>{r.enqueueAndForget(async()=>{hh(this)&&(n9("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.L_.add(4),await hn(e),e.q_.set("Unknown"),e.L_.delete(4),await hr(e)}(this))})}),this.q_=new he(r,n)}}async function hr(e){if(hh(e))for(let t of e.B_)await t(!0)}async function hn(e){for(let t of e.B_)await t(!1)}function hi(e,t){e.N_.has(t.targetId)||(e.N_.set(t.targetId,t),hu(e)?hl(e):hx(e).r_()&&ha(e,t))}function hs(e,t){let r=hx(e);e.N_.delete(t),r.r_()&&ho(e,t),0===e.N_.size&&(r.r_()?r.o_():hh(e)&&e.q_.set("Unknown"))}function ha(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(iI.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}hx(e).A_(t)}function ho(e,t){e.Q_.xe(t),hx(e).R_(t)}function hl(e){e.Q_=new ok({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),hx(e).start(),e.q_.v_()}function hu(e){return hh(e)&&!hx(e).n_()&&e.N_.size>0}function hh(e){return 0===e.L_.size}async function hc(e){e.q_.set("Online")}async function hd(e){e.N_.forEach((t,r)=>{ha(e,t)})}async function hf(e,t){e.Q_=void 0,hu(e)?(e.q_.M_(t),hl(e)):e.q_.set("Unknown")}async function hp(e,t,r){if(e.q_.set("Online"),t instanceof oC&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.N_.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.N_.delete(n),e.Q_.removeTarget(n))}(e,t)}catch(r){n9("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),await hm(e,r)}else if(t instanceof oS?e.Q_.Ke(t):t instanceof ox?e.Q_.He(t):e.Q_.We(t),!r.isEqual(iI.min()))try{let t=await uN(e.localStore);r.compareTo(t)>=0&&await function(e,t){let r=e.Q_.rt(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.N_.get(n);i&&e.N_.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.N_.get(t);if(!n)return;e.N_.set(t,n.withResumeToken(sA.EMPTY_BYTE_STRING,n.snapshotVersion)),ho(e,t);let i=new o4(n.target,t,r,n.sequenceNumber);ha(e,i)}),e.remoteSyncer.applyRemoteEvent(r)}(e,r)}catch(t){n9("RemoteStore","Failed to raise snapshot:",t),await hm(e,t)}}async function hm(e,t,r){if(!i$(t))throw t;e.L_.add(1),await hn(e),e.q_.set("Offline"),r||(r=()=>uN(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{n9("RemoteStore","Retrying IndexedDB access"),await r(),e.L_.delete(1),await hr(e)})}function hg(e,t){return t().catch(r=>hm(e,r,t))}async function hy(e){let t=hC(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;hh(e)&&e.O_.length<10;)try{let n=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,r);if(null===n){0===e.O_.length&&t.o_();break}r=n.batchId,function(e,t){e.O_.push(t);let r=hC(e);r.r_()&&r.V_&&r.m_(t.mutations)}(e,n)}catch(t){await hm(e,t)}hv(e)&&hw(e)}function hv(e){return hh(e)&&!hC(e).n_()&&e.O_.length>0}function hw(e){hC(e).start()}async function hb(e){hC(e).p_()}async function hI(e){let t=hC(e);for(let r of e.O_)t.m_(r.mutations)}async function h_(e,t,r){let n=e.O_.shift(),i=op.from(n,t,r);await hg(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await hy(e)}async function hE(e,t){t&&hC(e).V_&&await async function(e,t){var r;if(function(e){switch(e){default:return ii();case is.CANCELLED:case is.UNKNOWN:case is.DEADLINE_EXCEEDED:case is.RESOURCE_EXHAUSTED:case is.INTERNAL:case is.UNAVAILABLE:case is.UNAUTHENTICATED:return!1;case is.INVALID_ARGUMENT:case is.NOT_FOUND:case is.ALREADY_EXISTS:case is.PERMISSION_DENIED:case is.FAILED_PRECONDITION:case is.ABORTED:case is.OUT_OF_RANGE:case is.UNIMPLEMENTED:case is.DATA_LOSS:return!0}}(r=t.code)&&r!==is.ABORTED){let r=e.O_.shift();hC(e).s_(),await hg(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await hy(e)}}(e,t),hv(e)&&hw(e)}async function hT(e,t){e.asyncQueue.verifyOperationInProgress(),n9("RemoteStore","RemoteStore received new credentials");let r=hh(e);e.L_.add(3),await hn(e),r&&e.q_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.L_.delete(3),await hr(e)}async function hS(e,t){t?(e.L_.delete(2),await hr(e)):t||(e.L_.add(2),await hn(e),e.q_.set("Unknown"))}function hx(e){var t,r,n;return e.K_||(e.K_=(t=e.datastore,r=e.asyncQueue,n={Eo:hc.bind(null,e),Ro:hd.bind(null,e),mo:hf.bind(null,e),d_:hp.bind(null,e)},t.w_(),new u8(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n)),e.B_.push(async t=>{t?(e.K_.s_(),hu(e)?hl(e):e.q_.set("Unknown")):(await e.K_.stop(),e.Q_=void 0)})),e.K_}function hC(e){var t,r,n;return e.U_||(e.U_=(t=e.datastore,r=e.asyncQueue,n={Eo:()=>Promise.resolve(),Ro:hb.bind(null,e),mo:hE.bind(null,e),f_:hI.bind(null,e),g_:h_.bind(null,e)},t.w_(),new u7(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n)),e.B_.push(async t=>{t?(e.U_.s_(),await hy(e)):(await e.U_.stop(),e.O_.length>0&&(n9("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))})),e.U_}class hA{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new io,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new hA(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ia(is.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hk(e,t){if(ie("AsyncQueue",`${t}: ${e}`),i$(e))return new ia(is.UNAVAILABLE,`${t}: ${e}`);throw e}class hN{constructor(e){this.comparator=e?(t,r)=>e(t,r)||ix.comparator(t.key,r.key):(e,t)=>ix.comparator(e.key,t.key),this.keyedMap=aq(),this.sortedSet=new sb(this.comparator)}static emptySet(e){return new hN(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hN)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new hN;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class hD{constructor(){this.W_=new sb(ix.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?0!==e.type&&3===r.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==r.type?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.W_=this.W_.remove(t):1===e.type&&2===r.type?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):ii():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class hO{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new hO(e,t,hN.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&aR(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class hR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class hP{constructor(){this.queries=hL(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){let r=e.queries;e.queries=hL(),r.forEach((e,r)=>{for(let e of r.j_)e.onError(t)})}(this,new ia(is.ABORTED,"Firestore shutting down"))}}function hL(){return new aF(e=>aP(e),aR)}async function hM(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.H_()&&t.J_()&&(r=2):(i=new hR,r=t.J_()?0:1);try{switch(r){case 0:i.z_=await e.onListen(n,!0);break;case 1:i.z_=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=hk(r,`Initialization of query '${aL(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.j_.push(t),t.Z_(e.onlineState),i.z_&&t.X_(i.z_)&&hj(e)}async function hV(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.j_.indexOf(t);e>=0&&(i.j_.splice(e,1),0===i.j_.length?n=t.J_()?0:1:!i.H_()&&t.J_()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function hU(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.j_)e.X_(n)&&(r=!0);i.z_=n}}r&&hj(e)}function hF(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.j_)e.onError(r);e.queries.delete(t)}function hj(e){e.Y_.forEach(e=>{e.next()})}(w=v||(v={})).ea="default",w.Cache="cache";class hB{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new hO(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!(e.fromCache&&this.J_())||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=hO.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==v.Cache}}class hq{constructor(e){this.key=e}}class hz{constructor(e){this.key=e}}class hK{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=aH(),this.mutatedKeys=aH(),this.Aa=aU(e),this.Ra=new hN(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new hD,n=t?t.Ra:this.Ra,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=aM(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.ga(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.Aa(h,o)>0||l&&0>this.Aa(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{Ra:s,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let s=e.fa.G_();s.sort((e,t)=>(function(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ii()}};return r(e)-r(t)})(e.type,t.type)||this.Aa(e.doc,t.doc)),this.pa(r),n=null!=n&&n;let a=t&&!n?this.ya():[],o=0===this.da.size&&this.current&&!n?1:0,l=o!==this.Ea;return(this.Ea=o,0!==s.length||l)?{snapshot:new hO(this.query,e.Ra,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new hD,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=aH(),this.Ra.forEach(e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))});let t=[];return e.forEach(e=>{this.da.has(e)||t.push(new hz(e))}),this.da.forEach(r=>{e.has(r)||t.push(new hq(r))}),t}ba(e){this.Ta=e.Ts,this.da=aH();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return hO.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class h${constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class hG{constructor(e){this.key=e,this.va=!1}}class hH{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new aF(e=>aP(e),aR),this.Ma=new Map,this.xa=new Set,this.Oa=new sb(ix.comparator),this.Na=new Map,this.La=new ul,this.Ba={},this.ka=new Map,this.qa=lW.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function hW(e,t,r=!0){let n;let i=cp(e),s=i.Fa.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.Da()):n=await hJ(i,t,r,!0),n}async function hQ(e,t){let r=cp(e);await hJ(r,t,!0,!1)}async function hJ(e,t,r,n){let i;let s=await uO(e.localStore,aN(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await hY(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&hi(e.remoteStore,s),i}async function hY(e,t,r,n,i){e.Ka=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ma(r);i.ns&&(i=await uP(e.localStore,t.query,!1).then(({documents:e})=>t.view.ma(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return ce(e,t.targetId,o.wa),o.snapshot})(e,t,r,n);let s=await uP(e.localStore,t,!0),a=new hK(t,s.Ts),o=a.ma(s.documents),l=oT.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);ce(e,r,u.wa);let h=new h$(t,r,a);return e.Fa.set(t,h),e.Ma.has(r)?e.Ma.get(r).push(t):e.Ma.set(r,[t]),u.snapshot}async function hX(e,t,r){let n=e.Fa.get(t),i=e.Ma.get(n.targetId);if(i.length>1)return e.Ma.set(n.targetId,i.filter(e=>!aR(e,t))),void e.Fa.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await uR(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&hs(e.remoteStore,n.targetId),h7(e,n.targetId)}).catch(iU)):(h7(e,n.targetId),await uR(e.localStore,n.targetId,!0))}async function hZ(e,t){let r=e.Fa.get(t),n=e.Ma.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),hs(e.remoteStore,r.targetId))}async function h0(e,t,r){let n=cm(e);try{var i;let e;let s=await function(e,t){let r,n;let i=ib.now(),s=t.reduce((e,t)=>e.add(t.key),aH());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=aj,l=aH();return e.cs.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(n=>{r=n;let s=[];for(let e of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=aZ(n.transform,e||null);null!=i&&(null===r&&(r=s4.empty()),r.set(n.field,i))}return r||null}(e,r.get(e.key).overlayedDocument);null!=t&&s.push(new oo(e.key,t,function e(t){let r=[];return sv(t.fields,(t,n)=>{let i=new iS([t]);if(sX(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new sx(r)}(t.value.mapValue),oe.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{n=t;let i=t.applyToLocalDocumentSet(r,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:n.batchId,changes:az(r)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=n.Ba[n.currentUser.toKey()])||(e=new sb(iv)),e=e.insert(i,r),n.Ba[n.currentUser.toKey()]=e,await cr(n,s.changes),await hy(n.remoteStore)}catch(t){let e=hk(t,"Failed to persist write");r.reject(e)}}async function h1(e,t){try{let r=await function(e,t){let r=t.snapshotVersion,n=e.os;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let s=e.cs.newChangeBuffer({trackRemovals:!0});n=e.os;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=n.get(o);if(!u)return;a.push(e.Ur.removeMatchingKeys(i,s.removedDocuments,o).next(()=>e.Ur.addMatchingKeys(i,s.addedDocuments,o)));let h=u.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(sA.EMPTY_BYTE_STRING,iI.min()).withLastLimboFreeSnapshotVersion(iI.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),n=n.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(e.Ur.updateTargetData(i,h))});let o=aj,l=aH();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,r))}),a.push(uD(i,s,t.documentUpdates).next(e=>{o=e.Ps,l=e.Is})),!r.isEqual(iI.min())){let t=e.Ur.getLastRemoteSnapshotVersion(i).next(t=>e.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(t)}return iF.waitFor(a).next(()=>s.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,o,l)).next(()=>o)}).then(t=>(e.os=n,t))}(e.localStore,t);t.targetChanges.forEach((t,r)=>{let n=e.Na.get(r);n&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||ii(),t.addedDocuments.size>0?n.va=!0:t.modifiedDocuments.size>0?n.va||ii():t.removedDocuments.size>0&&(n.va||ii(),n.va=!1))}),await cr(e,r,t)}catch(e){await iU(e)}}function h2(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r;let i=[];e.Fa.forEach((e,r)=>{let n=r.view.Z_(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.j_)e.Z_(t)&&(r=!0)}),r&&hj(n),i.length&&e.Ca.d_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function h5(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Na.get(t),i=n&&n.key;if(i){let r=new sb(ix.comparator);r=r.insert(i,s3.newNoDocument(i,iI.min()));let n=aH().add(i),s=new oE(iI.min(),new Map,new sb(iv),r,n);await h1(e,s),e.Oa=e.Oa.remove(i),e.Na.delete(t),ct(e)}else await uR(e.localStore,t,!1).then(()=>h7(e,t,r)).catch(iU)}async function h6(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.cs.newChangeBuffer({trackRemovals:!0});return(function(e,t,r,n){let i=r.batch,s=i.keys(),a=iF.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);null!==s||ii(),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=aH();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,n))});h8(e,n,null),h3(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await cr(e,i)}catch(e){await iU(e)}}async function h4(e,t,r){var n;try{let i=await (n=e.localStore).persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||ii(),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))});h8(e,t,r),h3(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await cr(e,i)}catch(e){await iU(e)}}function h3(e,t){(e.ka.get(t)||[]).forEach(e=>{e.resolve()}),e.ka.delete(t)}function h8(e,t,r){let n=e.Ba[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.Ba[e.currentUser.toKey()]=n}}function h7(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Ma.get(t)))e.Fa.delete(n),r&&e.Ca.$a(n,r);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(t=>{e.La.containsKey(t)||h9(e,t)})}function h9(e,t){e.xa.delete(t.path.canonicalString());let r=e.Oa.get(t);null!==r&&(hs(e.remoteStore,r),e.Oa=e.Oa.remove(t),e.Na.delete(r),ct(e))}function ce(e,t,r){for(let n of r)n instanceof hq?(e.La.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Oa.get(r)||e.xa.has(n)||(n9("SyncEngine","New document in limbo: "+r),e.xa.add(n),ct(e))}(e,n)):n instanceof hz?(n9("SyncEngine","Document no longer in limbo: "+n.key),e.La.removeReference(n.key,t),e.La.containsKey(n.key)||h9(e,n.key)):ii()}function ct(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){let t=e.xa.values().next().value;e.xa.delete(t);let r=new ix(iE.fromString(t)),n=e.qa.next();e.Na.set(n,new hG(r)),e.Oa=e.Oa.insert(r,n),hi(e.remoteStore,new o4(aN(ax(r.path)),n,"TargetPurposeLimboResolution",iX.oe))}}async function cr(e,t,r){let n=[],i=[],s=[];e.Fa.isEmpty()||(e.Fa.forEach((a,o)=>{s.push(e.Ka(o,t,r).then(t=>{var s;if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:null===(s=null==r?void 0:r.targetChanges.get(o.targetId))||void 0===s?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=uS.Wi(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Ca.d_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>iF.forEach(t,t=>iF.forEach(t.$i,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>iF.forEach(t.Ui,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!i$(e))throw e;n9("LocalStore","Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.os.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.os=e.os.insert(t,i)}}}(e.localStore,i))}async function cn(e,t){var r;if(!e.currentUser.isEqual(t)){n9("SyncEngine","User change. New user:",t.toKey());let n=await uk(e.localStore,t);e.currentUser=t,r="'waitForPendingWrites' promise is rejected due to a user change.",e.ka.forEach(e=>{e.forEach(e=>{e.reject(new ia(is.CANCELLED,r))})}),e.ka.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await cr(e,n.hs)}}function ci(e,t){let r=e.Na.get(t);if(r&&r.va)return aH().add(r.key);{let r=aH(),n=e.Ma.get(t);if(!n)return r;for(let t of n){let n=e.Fa.get(t);r=r.unionWith(n.view.Va)}return r}}async function cs(e,t){let r=await uP(e.localStore,t.query,!0),n=t.view.ba(r);return e.isPrimaryClient&&ce(e,t.targetId,n.wa),n}async function ca(e,t){return uM(e.localStore,t).then(t=>cr(e,t))}async function co(e,t,r,n){let i=await function(e,t){let r=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",n=>r.Mn(n,t).next(t=>t?e.localDocuments.getDocuments(n,t):iF.resolve(null)))}(e.localStore,t);null!==i?("pending"===r?await hy(e.remoteStore):"acknowledged"===r||"rejected"===r?(h8(e,t,n||null),h3(e,t),function(e,t){e.mutationQueue.On(t)}(e.localStore,t)):ii(),await cr(e,i)):n9("SyncEngine","Cannot apply mutation batch with id: "+t)}async function cl(e,t){if(cp(e),cm(e),!0===t&&!0!==e.Qa){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await cu(e,t.toArray());for(let t of(e.Qa=!0,await hS(e.remoteStore,!0),r))hi(e.remoteStore,t)}else if(!1===t&&!1!==e.Qa){let t=[],r=Promise.resolve();e.Ma.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(h7(e,i),uR(e.localStore,i,!0))),hs(e.remoteStore,i)}),await r,await cu(e,t),e.Na.forEach((t,r)=>{hs(e.remoteStore,r)}),e.La.pr(),e.Na=new Map,e.Oa=new sb(ix.comparator),e.Qa=!1,await hS(e.remoteStore,!1)}}async function cu(e,t,r){let n=[],i=[];for(let r of t){let t;let s=e.Ma.get(r);if(s&&0!==s.length)for(let r of(t=await uO(e.localStore,aN(s[0])),s)){let t=e.Fa.get(r),n=await cs(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await uL(e.localStore,r);t=await uO(e.localStore,n),await hY(e,ch(n),r,!1,t.resumeToken)}n.push(t)}return e.Ca.d_(i),n}function ch(e){var t,r,n,i;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,new aS(t,r,n,i,e.limit,"F",e.startAt,e.endAt)}function cc(e){return e.localStore.persistence.Qi()}async function cd(e,t,r,n){if(e.Qa)return void n9("SyncEngine","Ignoring unexpected query state notification.");let i=e.Ma.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await uM(e.localStore,aV(i[0])),s=oE.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,sA.EMPTY_BYTE_STRING);await cr(e,n,s);break}case"rejected":await uR(e.localStore,t,!0),h7(e,t,n);break;default:ii()}}async function cf(e,t,r){let n=cp(e);if(n.Qa){for(let e of t){if(n.Ma.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){n9("SyncEngine","Adding an already active target "+e);continue}let t=await uL(n.localStore,e),r=await uO(n.localStore,t);await hY(n,ch(t),r.targetId,!1,r.resumeToken),hi(n.remoteStore,r)}for(let e of r)n.Ma.has(e)&&await uR(n.localStore,e,!1).then(()=>{hs(n.remoteStore,e),h7(n,e)}).catch(iU)}}function cp(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=h1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ci.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=h5.bind(null,e),e.Ca.d_=hU.bind(null,e.eventManager),e.Ca.$a=hF.bind(null,e.eventManager),e}function cm(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=h6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=h4.bind(null,e),e}class cg{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=u6(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){var t;return t=this.persistence,new uA(t,new uC,e.initialUser,this.serializer)}Ga(e){return new up(ug.Zr,this.serializer)}Wa(e){return new uH}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cg.provider={build:()=>new cg};class cy extends cg{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){return this.persistence.referenceDelegate instanceof uy||ii(),new l1(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ga(e){let t=void 0!==this.cacheSizeBytes?lj.withCacheSize(this.cacheSizeBytes):lj.DEFAULT;return new up(e=>uy.Zr(e,t),this.serializer)}}class cv extends cg{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await cm(this.Ja.syncEngine),await hy(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){var t;return t=this.persistence,new uA(t,new uC,e.initialUser,this.serializer)}ja(e,t){return new l1(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ha(e,t){let r=new iY(t,this.persistence);return new iJ(e.asyncQueue,r)}Ga(e){let t=uT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?lj.withCacheSize(this.cacheSizeBytes):lj.DEFAULT;return new uI(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,u2(),u5(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new uH}}class cw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>h2(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=cn.bind(null,this.syncEngine),await hS(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hP}createDatastore(e){let t=u6(e.databaseInfo.databaseId),r=new u1(e.databaseInfo);return new u9(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){var t;return t=this.localStore,new ht(t,this.datastore,e.asyncQueue,e=>h2(this.syncEngine,e,0),uQ.D()?new uQ:new uW)}createSyncEngine(e,t){return function(e,t,r,n,i,s,a){let o=new hH(e,t,r,n,i,s);return a&&(o.Qa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){n9("RemoteStore","RemoteStore shutting down."),e.L_.add(5),await hn(e),e.k_.shutdown(),e.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}cw.provider={build:()=>new cw};class cb{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ie("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class cI{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=n4.UNAUTHENTICATED,this.clientId=iy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{n9("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(n9("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new io;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=hk(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function c_(e,t){e.asyncQueue.verifyOperationInProgress(),n9("FirestoreClient","Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await uk(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function cE(e,t){e.asyncQueue.verifyOperationInProgress();let r=await cT(e);n9("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>hT(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>hT(t.remoteStore,r)),e._onlineComponents=t}async function cT(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){n9("FirestoreClient","Using user provided OfflineComponentProvider");try{await c_(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===is.FAILED_PRECONDITION||t.code===is.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;it("Error using user provided cache. Falling back to memory cache: "+t),await c_(e,new cg)}}else n9("FirestoreClient","Using default OfflineComponentProvider"),await c_(e,new cy(void 0))}return e._offlineComponents}async function cS(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(n9("FirestoreClient","Using user provided OnlineComponentProvider"),await cE(e,e._uninitializedComponentsProvider._online)):(n9("FirestoreClient","Using default OnlineComponentProvider"),await cE(e,new cw))),e._onlineComponents}async function cx(e){let t=await cS(e),r=t.eventManager;return r.onListen=hW.bind(null,t.syncEngine),r.onUnlisten=hX.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=hQ.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=hZ.bind(null,t.syncEngine),r}function cC(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let cA=new Map;function ck(e){if(!ix.isDocumentKey(e))throw new ia(is.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function cN(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":ii()}function cD(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ia(is.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=cN(e);throw new ia(is.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}class cO{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new ia(is.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ia(is.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new ia(is.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cC(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ia(is.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ia(is.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ia(is.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cR{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cO({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ia(is.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ia(is.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cO(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new iu;switch(e.type){case"firstParty":return new ip(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ia(is.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=cA.get(e);t&&(n9("ComponentProvider","Removing Datastore"),cA.delete(e),t.terminate())}(this),Promise.resolve()}}class cP{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new cP(this.firestore,e,this._query)}}class cL{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cM(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cL(this.firestore,e,this._key)}}class cM extends cP{constructor(e,t,r){super(e,t,ax(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new cL(this.firestore,null,new ix(e))}withConverter(e){return new cM(this.firestore,e,this._path)}}function cV(e,t,...r){if(e=X(e),1==arguments.length&&(t=iy.newId()),function(e,t,r){if(!r)throw new ia(is.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof cR){let n=iE.fromString(t,...r);return ck(n),new cL(e,null,new ix(n))}{if(!(e instanceof cL||e instanceof cM))throw new ia(is.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(iE.fromString(t,...r));return ck(n),new cL(e.firestore,e instanceof cM?e.converter:null,new ix(n))}}class cU{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new u4(this,"async_queue_retry"),this.Vu=()=>{let e=u5();e&&n9("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;let t=u5();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=u5();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new io;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!i$(e))throw e;n9("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(e=>{let t;throw this.Eu=e,this.du=!1,ie("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.du=!1,e))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let n=hA.createAndSchedule(this,e,t,r,e=>this.yu(e));return this.Tu.push(n),n}fu(){this.Eu&&ii()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{for(let t of(this.Tu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Tu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class cF extends cR{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new cU,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new cU(e),this._firestoreClient=void 0,await e}}}function cj(e,t){let r=eR("object"==typeof e?e:eF(),"firestore").getImmediate({identifier:"string"==typeof e?e:t||"(default)"});if(!r._initialized){let e=L("firestore");e&&function(e,t,r,n={}){var i;let s=(e=cD(e,cR))._getSettings(),a=`${t}:${r}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&it("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=n4.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[A(JSON.stringify({alg:"none",type:"JWT"})),A(JSON.stringify(s)),""].join(".")}(n.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=n.mockUserToken.sub||n.mockUserToken.user_id;if(!s)throw new ia(is.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new n4(s)}e._authCredentials=new ih(new il(t,r))}}(r,...e)}return r}function cB(e){if(e._terminated)throw new ia(is.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i;let s=e._freezeSettings(),a=(i=e._databaseId,new sM(i,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,cC(s.experimentalLongPollingOptions),s.useFetchStreams));e._componentsProvider||(null===(r=s.localCache)||void 0===r?void 0:r._offlineComponentProvider)&&(null===(n=s.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new cI(e._authCredentials,e._appCheckCredentials,e._queue,a,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class cq{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cq(sA.fromBase64String(e))}catch(e){throw new ia(is.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cq(sA.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class cz{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ia(is.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new iS(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cK{constructor(e){this._methodName=e}}class c${constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ia(is.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ia(is.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return iv(this._lat,e._lat)||iv(this._long,e._long)}}class cG{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}}let cH=/^__.*__$/;class cW{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new oo(e,this.data,this.fieldMask,t,this.fieldTransforms):new oa(e,this.data,t,this.fieldTransforms)}}class cQ{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new oo(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cJ(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ii()}}class cY{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new cY(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.Fu({path:r,xu:!1});return n.Ou(e),n}Nu(e){var t;let r=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.Fu({path:r,xu:!1});return n.vu(),n}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return di(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(cJ(this.Cu)&&cH.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class cX{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||u6(e)}Qu(e,t,r,n=!1){return new cY({Cu:e,methodName:t,qu:r,path:iS.emptyPath(),xu:!1,ku:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cZ(e){let t=e._freezeSettings(),r=u6(e._databaseId);return new cX(e._databaseId,!!t.ignoreUndefinedProperties,r)}class c0 extends cK{_toFieldTransform(e){if(2!==e.Cu)throw 1===e.Cu?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof c0}}function c1(e,t,r){return new cY({Cu:3,qu:t.settings.qu,methodName:e._methodName,xu:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class c2 extends null{_toFieldTransform(e){return new a7(e.path,new a0)}isEqual(e){return e instanceof c2}}class c5 extends cK{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=c1(this,e,!0),r=new a1(this.Ku.map(e=>c8(e,t)));return new a7(e.path,r)}isEqual(e){return e instanceof c5&&$(this.Ku,e.Ku)}}class c6 extends cK{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=c1(this,e,!0),r=new a5(this.Ku.map(e=>c8(e,t)));return new a7(e.path,r)}isEqual(e){return e instanceof c6&&$(this.Ku,e.Ku)}}class c4 extends cK{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new a4(e.serializer,aY(e.serializer,this.$u));return new a7(e.path,t)}isEqual(e){return e instanceof c4&&this.$u===e.$u}}function c3(e,t,r,n=!1){return c8(r,e.Qu(n?4:3,t))}function c8(e,t){if(c9(e=X(e)))return de("Unsupported field value:",t,e),c7(e,t);if(e instanceof cK)return function(e,t){if(!cJ(t.Cu))throw t.Bu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Bu(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){let r=[],n=0;for(let i of e){let e=c8(i,t.Lu(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=X(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return aY(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=ib.fromDate(e);return{timestampValue:oV(t.serializer,r)}}if(e instanceof ib){let r=new ib(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:oV(t.serializer,r)}}if(e instanceof c$)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof cq)return{bytesValue:oU(t.serializer,e._byteString)};if(e instanceof cL){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.Bu(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:oj(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof cG)return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return aQ(t.serializer,e)})}}}}};throw t.Bu(`Unsupported field value: ${cN(e)}`)}(e,t)}function c7(e,t){let r={};return sw(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sv(e,(e,n)=>{let i=c8(n,t.Mu(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function c9(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ib||e instanceof c$||e instanceof cq||e instanceof cL||e instanceof cK||e instanceof cG)}function de(e,t,r){if(!c9(r)||!("object"==typeof r&&null!==r&&(Object.getPrototypeOf(r)===Object.prototype||null===Object.getPrototypeOf(r)))){let n=cN(r);throw"an object"===n?t.Bu(e+" a custom object"):t.Bu(e+" "+n)}}function dt(e,t,r){if((t=X(t))instanceof cz)return t._internalPath;if("string"==typeof t)return dn(e,t);throw di("Field path arguments must be of type string or ",e,!1,void 0,r)}let dr=RegExp("[~\\*/\\[\\]]");function dn(e,t,r){if(t.search(dr)>=0)throw di(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new cz(...t.split("."))._internalPath}catch(n){throw di(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function di(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new ia(is.INVALID_ARGUMENT,o+e+l)}function ds(e,t){return e.some(e=>e.isEqual(t))}class da{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new cL(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new dl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(du("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class dl extends da{data(){return super.data()}}function du(e,t){return"string"==typeof t?dn(e,t):t instanceof cz?t._internalPath:t._delegate._internalPath}class dh{}class dc extends dh{}class dd extends dc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new dd(e,t,r)}_apply(e){let t=this._parse(e);return dI(e._query,t),new cP(e.firestore,e.converter,aD(e._query,t))}_parse(e){let t=cZ(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ia(is.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){db(a,s);let t=[];for(let r of a)t.push(dw(n,e,r));o={arrayValue:{values:t}}}else o=dw(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||db(a,s),o=c3(r,t,a,"in"===s||"not-in"===s);return ar.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class df extends dh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new df(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:an.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())dI(r,e),r=aD(r,e)}(e._query,t),new cP(e.firestore,e.converter,aD(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class dp extends dc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new dp(e,t)}_apply(e){let t=function(e,t,r){if(null!==e.startAt)throw new ia(is.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ia(is.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ae(t,r)}(e._query,this._field,this._direction);return new cP(e.firestore,e.converter,function(e,t){let r=e.explicitOrderBy.concat([t]);return new aS(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class dm extends dc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new dm(e,t,r)}_apply(e){return new cP(e.firestore,e.converter,aO(e._query,this._limit,this._limitType))}}class dg extends dc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new dg(e,t,r)}_apply(e){var t;let r=dv(e,this.type,this._docOrFields,this._inclusive);return new cP(e.firestore,e.converter,new aS((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt))}}class dy extends dc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new dy(e,t,r)}_apply(e){var t;let r=dv(e,this.type,this._docOrFields,this._inclusive);return new cP(e.firestore,e.converter,new aS((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r))}}function dv(e,t,r,n){if(r[0]=X(r[0]),r[0]instanceof da)return function(e,t,r,n,i){if(!n)throw new ia(is.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of ak(e))if(r.field.isKeyField())s.push(sH(t,n.key));else{let e=n.data.field(r.field);if(sR(e))throw new ia(is.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new ia(is.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new s8(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=cZ(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new ia(is.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new ia(is.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!aA(e)&&-1!==l.indexOf("/"))throw new ia(is.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(iE.fromString(l));if(!ix.isDocumentKey(r))throw new ia(is.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new ix(r);o.push(sH(t,i))}else{let e=c3(r,n,l);o.push(e)}}return new s8(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function dw(e,t,r){if("string"==typeof(r=X(r))){if(""===r)throw new ia(is.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aA(t)&&-1!==r.indexOf("/"))throw new ia(is.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(iE.fromString(r));if(!ix.isDocumentKey(n))throw new ia(is.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return sH(e,new ix(n))}if(r instanceof cL)return sH(e,r._key);throw new ia(is.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${cN(r)}.`)}function db(e,t){if(!Array.isArray(e)||0===e.length)throw new ia(is.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function dI(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new ia(is.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ia(is.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}class d_{convertValue(e,t="none"){switch(sj(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sD(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sO(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ii()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return sv(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;return new cG(null===(n=null===(r=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.map(e=>sD(e.doubleValue)))}convertGeoPoint(e){return new c$(sD(e.latitude),sD(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=sP(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(sL(e));default:return null}}convertTimestamp(e){let t=sN(e);return new ib(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=iE.fromString(e);o6(r)||ii();let n=new sV(r.get(1),r.get(3)),i=new ix(r.popFirst(5));return n.isEqual(t)||ie(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class dE{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class dT extends da{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new dS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(du("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class dS extends dT{data(e={}){return super.data(e)}}class dx extends d_{constructor(e){super(),this.firestore=e}convertBytes(e){return new cq(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new cL(this.firestore,null,t)}}new WeakMap,function(e=!0){n3=eV,eO(new Z("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new cF(new ic(t.getProvider("auth-internal")),new ig(t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ia(is.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sV(e.options.projectId,t)}(i,r),i);return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),ej(n6,"4.7.4",void 0),ej(n6,"4.7.4","esm2017")}(),ej("firebase","11.0.1","app");let dC=Array.from(eA.values()).length?eF():eU({apiKey:"AIzaSyCkjQfxC0k9CpHmX341FeSu5S3X2Qe4yvo",authDomain:"cineverse-78d77.firebaseapp.com",projectId:"cineverse-78d77",storageBucket:"cineverse-78d77.firebasestorage.app",messagingSenderId:"81171746608",appId:"1:81171746608:web:52dbde26f3a75cea0cc2f5"});nY(dC),cj(dC);let dA=nY(dC),dk=cj(dC),dN=(0,I.createContext)(void 0);function dD(){let e=(0,I.useContext)(dN);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans un AuthProvider");return e}function dO(e){let{children:t}=e,[r,n]=(0,I.useState)(null),[i,s]=(0,I.useState)(null),[a,o]=(0,I.useState)(!0);(0,I.useEffect)(()=>{var e;let t=(e=async e=>{if(n(e),e){let t=cV(dk,"users",e.uid),r=await function(e){e=cD(e,cL);let t=cD(e.firestore,cF);return(function(e,t,r={}){let n=new io;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,r,n,i){let s=new cb({next:o=>{s.Za(),t.enqueueAndForget(()=>hV(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new ia(is.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new ia(is.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new hB(ax(r.path),s,{includeMetadataChanges:!0,_a:!0});return hM(e,a)})(await cx(e),e.asyncQueue,t,r,n)),n.promise})(cB(t),e._key).then(r=>(function(e,t,r){let n=r.docs.get(t._key),i=new dx(e);return new dT(e,i,t._key,n,new dE(r.hasPendingWrites,r.fromCache),t.converter)})(t,e,r))}(t);r.exists()&&s(r.data())}else s(null);o(!1)},X(dA).onAuthStateChanged(e,void 0,void 0));return()=>t()},[]);let l=async(e,t)=>eP(dA.app)?Promise.reject(e4(dA)):rO(X(dA),ry.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&rM(dA),e}),u=async(e,t,r)=>{try{let n=await rV(dA,e,t),i=cV(dk,"users",n.user.uid);return await function(e,t,r){var n,i,s,a;e=cD(e,cL);let o=cD(e.firestore,cF),l=(i=e.converter,s=t,a=void 0,i?a&&(a.merge||a.mergeFields)?i.toFirestore(s,a):i.toFirestore(s):s);return n=[(function(e,t,r,n,i,s={}){let a,o;let l=e.Qu(s.merge||s.mergeFields?2:0,t,r,i);de("Data must be an object, but it was:",l,n);let u=c7(n,l);if(s.merge)a=new sx(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=dt(t,n,r);if(!l.contains(i))throw new ia(is.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);ds(e,i)||e.push(i)}a=new sx(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new cW(new s4(u),a,o)})(cZ(o),"setDoc",e._key,l,null!==e.converter,void 0).toMutation(e._key,oe.none())],function(e,t){let r=new io;return e.asyncQueue.enqueueAndForget(async()=>h0(await cS(e).then(e=>e.syncEngine),t,r)),r.promise}(cB(o),n)}(i,{username:r,email:e,createdAt:new Date().toISOString()}),n}catch(e){throw console.error("Erreur lors de l'inscription:",e),e}},h=async()=>X(dA).signOut();return(0,b.jsx)(dN.Provider,{value:{user:r,userData:i,loading:a,login:l,signup:u,logout:h},children:!a&&t})}},8199:(e,t)=>{"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ACTION_HMR_REFRESH:function(){return u},ACTION_NAVIGATE:function(){return s},ACTION_PREFETCH:function(){return l},ACTION_REFRESH:function(){return i},ACTION_RESTORE:function(){return a},ACTION_SERVER_ACTION:function(){return h},ACTION_SERVER_PATCH:function(){return o},PrefetchCacheEntryStatus:function(){return n},PrefetchKind:function(){return r}});let i="refresh",s="navigate",a="restore",o="server-patch",l="prefetch",u="hmr-refresh",h="server-action";!function(e){e.AUTO="auto",e.FULL="full",e.TEMPORARY="temporary"}(r||(r={})),function(e){e.fresh="fresh",e.reusable="reusable",e.expired="expired",e.stale="stale"}(n||(n={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7195:(e,t,r)=>{"use strict";function n(e,t,r,n){return!1}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getDomainLocale",{enumerable:!0,get:function(){return n}}),r(8337),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8342:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return I}});let n=r(8754),i=r(5893),s=n._(r(7294)),a=r(6075),o=r(3955),l=r(8041),u=r(9903),h=r(5490),c=r(1928),d=r(257),f=r(4229),p=r(7195),m=r(9470),g=r(8199),y=r(2145),v=new Set;function w(e,t,r,n,i,s){if(s||(0,o.isLocalURL)(t)){if(!n.bypassPrefetchedCheck&&!s){let i=t+"%"+r+"%"+(void 0!==n.locale?n.locale:"locale"in e?e.locale:void 0);if(v.has(i))return;v.add(i)}(async()=>s?e.prefetch(t,i):e.prefetch(t,r,n))().catch(e=>{})}}function b(e){return"string"==typeof e?e:(0,l.formatUrl)(e)}let I=s.default.forwardRef(function(e,t){let r,n;let{href:l,as:v,children:I,prefetch:_=null,passHref:E,replace:T,shallow:S,scroll:x,locale:C,onClick:A,onMouseEnter:k,onTouchStart:N,legacyBehavior:D=!1,...O}=e;r=I,D&&("string"==typeof r||"number"==typeof r)&&(r=(0,i.jsx)("a",{children:r}));let R=s.default.useContext(c.RouterContext),P=s.default.useContext(d.AppRouterContext),L=null!=R?R:P,M=!R,V=!1!==_,U=null===_?g.PrefetchKind.AUTO:g.PrefetchKind.FULL,{href:F,as:j}=s.default.useMemo(()=>{if(!R){let e=b(l);return{href:e,as:v?b(v):e}}let[e,t]=(0,a.resolveHref)(R,l,!0);return{href:e,as:v?(0,a.resolveHref)(R,v):t||e}},[R,l,v]),B=s.default.useRef(F),q=s.default.useRef(j);D&&(n=s.default.Children.only(r));let z=D?n&&"object"==typeof n&&n.ref:t,[K,$,G]=(0,f.useIntersection)({rootMargin:"200px"}),H=s.default.useCallback(e=>{(q.current!==j||B.current!==F)&&(G(),q.current=j,B.current=F),K(e)},[j,F,G,K]),W=(0,y.useMergedRef)(H,z);s.default.useEffect(()=>{L&&$&&V&&w(L,F,j,{locale:C},{kind:U},M)},[j,F,$,C,V,null==R?void 0:R.locale,L,M,U]);let Q={ref:W,onClick(e){D||"function"!=typeof A||A(e),D&&n.props&&"function"==typeof n.props.onClick&&n.props.onClick(e),L&&!e.defaultPrevented&&function(e,t,r,n,i,a,l,u,h){let{nodeName:c}=e.currentTarget;if("A"===c.toUpperCase()&&(function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)||!h&&!(0,o.isLocalURL)(r)))return;e.preventDefault();let d=()=>{let e=null==l||l;"beforePopState"in t?t[i?"replace":"push"](r,n,{shallow:a,locale:u,scroll:e}):t[i?"replace":"push"](n||r,{scroll:e})};h?s.default.startTransition(d):d()}(e,L,F,j,T,S,x,C,M)},onMouseEnter(e){D||"function"!=typeof k||k(e),D&&n.props&&"function"==typeof n.props.onMouseEnter&&n.props.onMouseEnter(e),L&&(V||!M)&&w(L,F,j,{locale:C,priority:!0,bypassPrefetchedCheck:!0},{kind:U},M)},onTouchStart:function(e){D||"function"!=typeof N||N(e),D&&n.props&&"function"==typeof n.props.onTouchStart&&n.props.onTouchStart(e),L&&(V||!M)&&w(L,F,j,{locale:C,priority:!0,bypassPrefetchedCheck:!0},{kind:U},M)}};if((0,u.isAbsoluteUrl)(j))Q.href=j;else if(!D||E||"a"===n.type&&!("href"in n.props)){let e=void 0!==C?C:null==R?void 0:R.locale,t=(null==R?void 0:R.isLocaleDomain)&&(0,p.getDomainLocale)(j,e,null==R?void 0:R.locales,null==R?void 0:R.domainLocales);Q.href=t||(0,m.addBasePath)((0,h.addLocale)(j,e,null==R?void 0:R.defaultLocale))}return D?s.default.cloneElement(n,Q):(0,i.jsx)("a",{...O,...Q,children:r})});("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useIntersection",{enumerable:!0,get:function(){return l}});let n=r(7294),i=r(4474),s="function"==typeof IntersectionObserver,a=new Map,o=[];function l(e){let{rootRef:t,rootMargin:r,disabled:l}=e,u=l||!s,[h,c]=(0,n.useState)(!1),d=(0,n.useRef)(null),f=(0,n.useCallback)(e=>{d.current=e},[]);return(0,n.useEffect)(()=>{if(s){if(u||h)return;let e=d.current;if(e&&e.tagName)return function(e,t,r){let{id:n,observer:i,elements:s}=function(e){let t;let r={root:e.root||null,margin:e.rootMargin||""},n=o.find(e=>e.root===r.root&&e.margin===r.margin);if(n&&(t=a.get(n)))return t;let i=new Map;return t={id:r,observer:new IntersectionObserver(e=>{e.forEach(e=>{let t=i.get(e.target),r=e.isIntersecting||e.intersectionRatio>0;t&&r&&t(r)})},e),elements:i},o.push(r),a.set(r,t),t}(r);return s.set(e,t),i.observe(e),function(){if(s.delete(e),i.unobserve(e),0===s.size){i.disconnect(),a.delete(n);let e=o.findIndex(e=>e.root===n.root&&e.margin===n.margin);e>-1&&o.splice(e,1)}}}(e,e=>e&&c(e),{root:null==t?void 0:t.current,rootMargin:r})}else if(!h){let e=(0,i.requestIdleCallback)(()=>c(!0));return()=>(0,i.cancelIdleCallback)(e)}},[u,r,t,h,d.current]),[f,h,(0,n.useCallback)(()=>{c(!1)},[])]}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2145:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return i}});let n=r(7294);function i(e,t){let r=(0,n.useRef)(()=>{}),i=(0,n.useRef)(()=>{});return(0,n.useMemo)(()=>e&&t?n=>{null===n?(r.current(),i.current()):(r.current=s(e,n),i.current=s(t,n))}:e||t,[e,t])}function s(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8703:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(5893);r(5060),r(7294);let i=()=>(0,n.jsx)("footer",{className:"bg-black py-4 pt-10",children:(0,n.jsx)("div",{className:"container mx-auto text-center text-white text-sm",children:(0,n.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," CineVerse. Tous droits r\xe9serv\xe9s | Site r\xe9alis\xe9 par"," ",(0,n.jsx)("a",{href:"https://jslcode.com",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline font-bold",children:"JSL Code"})]})})});var s=r(1163),a=r(1664),o=r.n(a),l=r(3301);function u(){let e=(0,s.useRouter)(),t="/"===e.pathname,{user:r,userData:i,logout:a}=(0,l.a)(),u=async()=>{try{await a(),e.push("/")}catch(e){console.error("Erreur de d\xe9connexion:",e)}};return(0,n.jsx)("nav",{className:"fixed top-0 left-0 right-0 z-50 backdrop-blur-md",children:(0,n.jsxs)("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between",children:[(0,n.jsx)("div",{className:"flex items-center gap-3",children:t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o(),{href:"/movies",className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"Films"})]}),(0,n.jsxs)(o(),{href:"/series",className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"S\xe9ries"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{onClick:()=>e.back(),className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl","aria-label":"Retour",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M15 19l-7-7 7-7"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"Retour"})]}),(0,n.jsxs)(o(),{href:"/",className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"Accueil"})]}),e.pathname.includes("/movies")&&(0,n.jsxs)(o(),{href:"/series",className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"S\xe9ries"})]}),e.pathname.includes("/series")&&(0,n.jsxs)(o(),{href:"/movies",className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"Films"})]})]})}),(0,n.jsx)("div",{className:"flex items-center gap-3",children:r?(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("button",{onClick:()=>e.push("/profile"),className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),i?.username||"Utilisateur"]}),(0,n.jsxs)("button",{onClick:u,className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"D\xe9connexion"})]})]}):!e.pathname.includes("/auth")&&(0,n.jsxs)(o(),{href:"/auth",className:"btn-gradient flex items-center justify-center gap-2 px-4 h-10 rounded-xl",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,n.jsx)("span",{className:"text-white text-sm font-medium",children:"Connexion"})]})})]})})}var h=r(5301),c=r.n(h),d=r(7796);function f(e){return(0,d.w_)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 217.9L383 345c9.4 9.4 24.6 9.4 33.9 0 9.4-9.4 9.3-24.6 0-34L273 167c-9.1-9.1-23.7-9.3-33.1-.7L95 310.9c-4.7 4.7-7 10.9-7 17s2.3 12.3 7 17c9.4 9.4 24.6 9.4 33.9 0l127.1-127z"},child:[]}]})(e)}function p(){return(0,n.jsx)(c(),{smooth:!0,component:(0,n.jsx)(f,{className:"h-6 w-6 text-white"}),className:"flex items-center justify-center btn-gradient !rounded-full !p-3"})}let m=e=>{let{children:t}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,n.jsx)(u,{}),(0,n.jsxs)("main",{className:"flex-1 bg-gradient-to-b from-gray-900 to-black text-white",children:[t,(0,n.jsx)(p,{})]}),(0,n.jsx)(i,{})]})})},g=function(e){let{Component:t,pageProps:r}=e;return(0,n.jsx)(l.H,{children:(0,n.jsx)(m,{children:(0,n.jsx)(t,{...r})})})}},5060:()=>{},1664:(e,t,r)=>{e.exports=r(8342)},1163:(e,t,r)=>{e.exports=r(3079)},5301:(e,t,r)=>{"use strict";var n=r(7294),i=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(n),s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".scroll-to-top {\n  background-color: white;\n  right: 40px;\n  bottom: 40px;\n  position: fixed;\n  z-index: 2;\n  cursor: pointer;\n  border-radius: 7px;\n  width: 40px;\n  height: 40px;\n  box-shadow: 0 9px 25px 0 rgba(132, 128, 177, 0.28);\n  border: none;\n}\n\n.scroll-to-top:active {\n  transform: matrix(0.95, 0, 0, 0.95, 0, 0);\n}\n"),e.exports=function(e){var t=e.top,r=void 0===t?20:t,a=e.className,o=e.color,l=e.smooth,u=void 0!==l&&l,h=e.component,c=e.viewBox,d=e.svgPath,f=e.width,p=e.height,m=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}(e,["top","className","color","smooth","component","viewBox","svgPath","width","height"]),g=n.useState(!1),y=g[0],v=g[1];return n.useEffect(function(){var e=function(){v(document.documentElement.scrollTop>=r)};return e(),document.addEventListener("scroll",e),function(){return document.removeEventListener("scroll",e)}},[r]),i.createElement(i.Fragment,null,y&&i.createElement("button",s({className:"scroll-to-top "+(void 0===a?"":a),onClick:function(){var e;void 0===(e=u)&&(e=!1),e?window.scrollTo({top:0,behavior:"smooth"}):document.documentElement.scrollTop=0},"aria-label":"Scroll to top"},m),(void 0===h?"":h)||i.createElement("svg",{width:void 0===f?"28":f,height:void 0===p?"28":p,fill:void 0===o?"black":o,viewBox:void 0===c?"0 0 256 256":c},i.createElement("path",{d:void 0===d?"M222.138,91.475l-89.6-89.6c-2.5-2.5-6.551-2.5-9.051,0l-89.6,89.6c-2.5,2.5-2.5,6.551,0,9.051s6.744,2.5,9.244,0L122,21.85  V249.6c0,3.535,2.466,6.4,6,6.4s6-2.865,6-6.4V21.85l78.881,78.676c1.25,1.25,2.992,1.875,4.629,1.875s3.326-0.625,4.576-1.875  C224.586,98.025,224.638,93.975,222.138,91.475z":d}))))}},5766:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)s.push(r[(i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},8834:(e,t,r)=>{"use strict";var n=r(5766),i=r(2333),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!o.isEncoding(t))throw TypeError("Unknown encoding: "+t);var r=0|p(e,t),n=a(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(k(e,Uint8Array)){var t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return c(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(k(e,ArrayBuffer)||e&&k(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(k(e,SharedArrayBuffer)||e&&k(e.buffer,SharedArrayBuffer)))return d(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);var i=function(e){if(o.isBuffer(e)){var t,r=0|f(e.length),n=a(r);return 0===n.length||e.copy(n,0,0,r),n}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|f(e))}function c(e){for(var t=e.length<0?0:0|f(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function d(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}function f(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function p(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||k(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return x(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(i)return n?-1:x(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){var i,s,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=N[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=t,s=r,0===i&&s===this.length?n.fromByteArray(this):n.fromByteArray(this.slice(i,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(a)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r=+r)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return -1;r=e.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}function b(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function I(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function _(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function E(e,t,r,n,s){return t=+t,r>>>=0,s||_(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function T(e,t,r,n,s){return t=+t,r>>>=0,s||_(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}t.lW=o,t.h2=50,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(k(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),k(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(k(s,Uint8Array))i+s.length>n.length?o.from(s).copy(n,i):Uint8Array.prototype.set.call(n,s,i);else if(o.isBuffer(s))s.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=s.length}return n},o.byteLength=p,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):m.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.h2;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(k(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(t.substr(2*a,2),16);if(o!=o)break;e[r+a]=o}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,A(x(e,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return a=t,o=r,A(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(e),this,a,o);case"base64":return l=t,u=r,A(C(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,A(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||b(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||b(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||b(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||b(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||b(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||b(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||b(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;I(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;I(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);I(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||I(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return T(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return T(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var S=/[^+/0-9A-Za-z-_]/g;function x(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function C(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(S,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function k(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},2333:(e,t)=>{t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=23===i?5960464477539062e-23:0,f=n?0:s-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=p,a/=256,u-=8);e[r+f-p]|=128*m}},7796:(e,t,r)=>{"use strict";r.d(t,{w_:()=>h});var n=r(7294),i={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},s=n.createContext&&n.createContext(i),a=["attr","size","title"];function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){var n,i;n=t,i=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(e){return t=>n.createElement(c,o({attr:u({},e.attr)},t),function e(t){return t&&t.map((t,r)=>n.createElement(t.tag,u({key:r},t.attr),e(t.child)))}(e.child))}function c(e){var t=t=>{var r,{attr:i,size:s,title:l}=e,h=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,a),c=s||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",o({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,h,{className:r,style:u(u({color:e.color||t.color},t.style),e.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),l&&n.createElement("title",null,l),e.children)};return void 0!==s?n.createElement(s.Consumer,null,e=>t(e)):t(i)}}},e=>{var t=t=>e(e.s=t);e.O(0,[774,179],()=>(t(6840),t(3079))),_N_E=e.O()}]);